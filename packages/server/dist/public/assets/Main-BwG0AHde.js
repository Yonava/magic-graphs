import{L as X,c as z,u as G,b as J,_ as Y}from"./Graph.vue_vue_type_script_setup_true_lang-BJk8tGhB.js";import{c as _,i as Z}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-DXnk11q6.js";import{f as S,d as $,s as A,o as b,c as I,C,w as y,v as L,B as m,A as H,J as h,x as q,y as Q,a as B,t as ee,e as T}from"./index-jkibzGI-.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-C5cPFZO3.js";import{g as te}from"./useAdjacencyList-DZ7PKXnn.js";import{_ as se}from"./SimulationPlaybackControls.vue_vue_type_script_setup_true_lang-B8ynU4H3.js";import{b as oe}from"./CollabControls.vue_vue_type_script_setup_true_lang-Lr4pHrIx.js";import"./mdi-BxJysLth.js";const x="S",F="T",ne=X.filter(e=>e!==x&&e!==F),M=e=>z(e.nodes,ne),le=e=>{const{setTheme:r}=G(e,"flow"),a=M(e);e.subscribe("onEdgeAdded",t=>{if(t.to===t.from||e.edges.value.some(v=>v.from===t.to&&v.to===t.from))return e.removeEdge(t.id)});const c=t=>l=>{const{offsetX:v,offsetY:E}=l,g=e.getNodeByCoordinates(v,E);g&&t(g)},s=async()=>{e.settings.value.userEditable=!1,e.settings.value.focusable=!1;let t;const l=await new Promise(v=>{t=c(v),e.subscribe("onClick",t)});return t&&e.unsubscribe("onClick",t),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,l},d=S(!1),o=async()=>{d.value=!0;const t=await s();e.nodes.value.forEach(l=>{l.label===x&&(l.label=a())}),t.label=x,e.trackGraphState(),d.value=!1},i=S(!1),n=async()=>{i.value=!0;const t=await s();e.nodes.value.forEach(l=>{l.label===F&&(l.label=a())}),t.label=F,e.trackGraphState(),i.value=!1},u=t=>{if(e.isHighlighted(t.id))return;const l=t.label===x,v=t.label===F;if(l)return _.BLUE_600;if(v)return _.RED_600};return r("nodeBorderColor",u),r("nodeAnchorColor",u),{makeSource:o,makeSink:n,makingSource:d,makingSink:i}},ae={class:"flex gap-3"},ie={key:2,class:"flex gap-3"},re=$({__name:"SourceSinkControls",props:{simControls:{},controls:{}},setup(e){const r=e,a=A(()=>r.simControls.isActive.value);return(c,s)=>(b(),I("div",ae,[a.value?(b(),C(N,{key:1,style:L({backgroundColor:m(_).RED_600,color:m(_).WHITE}),onClick:c.simControls.stop},{default:y(()=>s[1]||(s[1]=[h(" Stop Simulation ")])),_:1},8,["style","onClick"])):(b(),C(N,{key:0,style:L({backgroundColor:m(_).BLUE_500,color:m(_).WHITE}),onClick:c.simControls.start},{default:y(()=>s[0]||(s[0]=[h(" Run Flow Simulation ")])),_:1},8,["style","onClick"])),a.value?H("",!0):(b(),I("div",ie,[c.controls.makingSource.value?(b(),C(N,{key:1,style:L({backgroundColor:m(_).RED_500,color:m(_).WHITE})},{default:y(()=>s[3]||(s[3]=[h(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:0,onClick:c.controls.makeSource},{default:y(()=>s[2]||(s[2]=[h(" Switch Source ")])),_:1},8,["onClick"])),c.controls.makingSink.value?(b(),C(N,{key:3,style:L({backgroundColor:m(_).RED_500,color:m(_).WHITE})},{default:y(()=>s[5]||(s[5]=[h(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:2,onClick:c.controls.makeSink},{default:y(()=>s[4]||(s[4]=[h(" Switch Sink ")])),_:1},8,["onClick"]))]))]))}}),ce="edge-thickener",W=5,D=25,ue=3,de=e=>{const{setTheme:r,removeAllThemes:a}=G(e,ce),c=o=>{const i=Number(o.label);if(isNaN(i))return;if(i===0)return ue;const u=(i*2-W)/(D-W),t=Math.min(1,Math.max(0,u));return(D-W)*t+W},s=()=>r("edgeWidth",c),d=()=>a();return q(d),s(),{activate:s,deactivate:d}},fe={persistent:!0,persistentStorageKey:"network-flow",userEditableAddedEdgeLabel:"5",edgeInputToLabel:e=>{const r=Number(e);return!isNaN(r)&&r>=0&&r<100?e:void 0}},ve=(e,r,a)=>{const c=e.edges.value.reduce((n,u)=>(n[u.id]=Number(u.label),n),{}),s=[],d=te(e),o=(n,u,t=void 0,l=void 0)=>{if(l===void 0&&(l=[]),t===void 0&&(t=new Set),t.add(n),l.push(n),n===u)return l;const v=d[n];for(const E of v){const g=e.edges.value.find(f=>f.from===n&&f.to===E);if(!g)throw"the adj list must be wrong! 1";if(c[g.id]>0&&!t.has(E)){const f=o(E,u,t,[...l]);if(f)return f}}};return{maxFlow:(()=>{let n=0,u=o(r,a);for(;u;){let t=1/0;for(let l=0;l<u.length-1;l++){const v=u[l],E=u[l+1],g=e.edges.value.find(f=>f.from===v&&f.to===E);if(!g)throw"the adj list must be wrong! 2";const k=c[g.id];t=Math.min(t,k)}for(let l=0;l<u.length-1;l++){const v=u[l],E=u[l+1],g=e.edges.value.find(f=>f.from===v&&f.to===E),k=e.edges.value.find(f=>f.from===E&&f.to===v);if(!g||!k)throw"the adj list must be wrong! 3";c[g.id]-=t,c[k.id]+=t,s.push({[g.id]:c[g.id],[k.id]:c[k.id]})}n+=t,u=o(r,a)}return n})(),trace:s}},R="residual",V=e=>{const r=o=>o.startsWith(R),a=o=>o.split("-")[1],c=o=>`${R}-${o}`;return{cleanupResidualEdges:()=>{for(const o of e.edges.value){if(!r(o.id))continue;const i=a(o.id),n=e.getEdge(i);if(!n)throw"big oopsie";const u=Number(n.label),t=Number(o.label);n.label=(u+t).toString()}e.edges.value=e.edges.value.filter(o=>!o.id.startsWith(R))},createResidualEdges:()=>{if(e.edges.value.some(n=>n.id.startsWith(R)))return;const i=e.edges.value.map(n=>({...n,to:n.from,from:n.to,label:"0",id:c(n.id)}));e.edges.value.push(...i)},isResidual:r,getIdFromResidual:a,getResidualId:c}},P=e=>{const r=S([]),a=S(0),{createResidualEdges:c,cleanupResidualEdges:s}=V(e),d=()=>{const o=e.nodes.value.find(t=>t.label===x),i=e.nodes.value.find(t=>t.label===F);if(!o||!i)return r.value=[];c();const{maxFlow:n,trace:u}=ve(e,o.id,i.id);r.value=u,a.value=n,s()};return e.subscribe("onEdgeLabelChange",d),e.subscribe("onStructureChange",d),e.subscribe("onGraphReset",d),{maxFlow:a,trace:r,update:d}},me=e=>{const{maxFlow:r}=P(e);return{maxFlow:Q(r)}},ge={class:"flex gap-3"},Ee={class:"font-bold text-xl"},be=$({__name:"NetworkFlowStats",props:{graph:{}},setup(e){const r=e,{maxFlow:a}=me(r.graph);return(c,s)=>(b(),I("div",ge,[B("span",Ee,"Max Flow: "+ee(m(a)??"N/A"),1)]))}}),_e=e=>{const{setTheme:r}=G(e,"flow"),{createResidualEdges:a,cleanupResidualEdges:c}=V(e),{trace:s}=P(e),d=S(!1),o=S([]),i=S(0),n=S(null),u=S(!1),t=S(1500),l=A(()=>i.value===s.value.length),v=A(()=>i.value>-1),E=()=>{u.value||l.value||f()},g=()=>{i.value=-1,e.settings.value.userEditable=!1,e.settings.value.focusable=!1,d.value=!0,u.value=!1,a(),n.value=setInterval(E,t.value),e.repaint("flow-simulation/start-simulation")()},k=()=>{c(),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,o.value=[],d.value=!1,n.value&&clearInterval(n.value),e.repaint("flow-simulation/stop-simulation")()},f=()=>{if(i.value===s.value.length)return;if(i.value++,i.value===s.value.length){o.value=[],e.repaint("flow-simulation/next-step")();return}const w=s.value[i.value];o.value=Object.keys(w);const[p,j]=o.value,O=e.getEdge(p),U=e.getEdge(j);if(!O||!U)throw"this is all wrong!";O.label=w[p].toString(),U.label=w[j].toString(),e.repaint("flow-simulation/next-step")()},K=()=>{if(i.value<-1)return;if(i.value--,i.value===-1){o.value=[],e.repaint("flow-simulation/prev-step")();return}const w=i.value;k(),g();for(let p=0;p<w+1;p++)f()};return r("edgeColor",w=>{if(o.value.includes(w.id))return Z(e.theme.value.edgeFocusColor,w);if(w.id.startsWith(R))return _.ORANGE_400}),{nextStep:f,prevStep:K,setStep:()=>{throw"setStep not implemented"},trace:A(()=>s.value),step:A(()=>i.value),start:g,stop:k,paused:u,playbackSpeed:t,isOver:l,hasBegun:v,isActive:A(()=>d.value)}},Se={class:"w-full h-full relative"},ke={class:"absolute w-full h-full"},we={class:"absolute top-0 p-3"},pe={class:"absolute top-0 right-0 p-3 text-white flex gap-3"},Ce={key:0,class:"absolute bottom-8 w-full flex justify-center items-center p-3"},ye={key:1,class:"absolute right-0 p-3 h-14 flex gap-3 bottom-0"},We=$({__name:"Main",setup(e){const r=S(),a=J(r,{settings:fe});a.settings.value.newNodeLabelGetter=M(a),de(a);const c=le(a),s=_e(a);return(d,o)=>(b(),I("div",Se,[B("div",ke,[T(Y,{onGraphRef:o[0]||(o[0]=i=>r.value=i),graph:m(a)},null,8,["graph"])]),B("div",we,[T(re,{controls:m(c),"sim-controls":m(s)},null,8,["controls","sim-controls"])]),B("div",pe,[T(be,{graph:m(a)},null,8,["graph"])]),m(s).isActive.value?(b(),I("div",Ce,[T(se,{controls:m(s)},null,8,["controls"])])):H("",!0),m(s).isActive.value?H("",!0):(b(),I("div",ye,[T(oe,{graph:m(a)},null,8,["graph"])]))]))}});export{We as default};
