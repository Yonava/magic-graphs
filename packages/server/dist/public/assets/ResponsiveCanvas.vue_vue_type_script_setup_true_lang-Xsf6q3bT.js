import{bH as b,bI as Y,bJ as H,bK as k,bL as N,bM as F,bN as O,bO as z,ah as p,bP as vt,bQ as at,bR as rt,bS as Kt,bT as Vt,bU as bt,bV as At,bW as G,bX as nt,bY as Qt,bZ as te,b_ as T,b$ as dt,c0 as Tt,c1 as mt,c2 as ee,c3 as Et,c4 as ne,c5 as ae,c6 as re,c7 as oe,E as U,g as m,an as ot,ak as st,L as D,O as X,N as Q,bs as se,d as ie,c8 as ce,c9 as le,c as ht,Z as xt,C as ue,a as ft,I as tt,o as wt}from"./index-ChF9fs9q.js";const it=t=>{const{pointA:e,pointB:n,pointC:a,textArea:r}={...pt,...t};if(!r)throw new Error("no text area provided");const{text:o}=r,{fontSize:s}={...N,...o},i=(e.x+n.x+a.x)/3,l=(e.y+n.y+a.y)/3;return{x:i-s,y:l-s}},de=t=>{if(!t.textArea)return;const e=it(t),n=b(t.textArea,e),{width:a,height:r}=Y(n),o=H({at:n.at,width:a,height:r});return s=>o(s)},St=t=>{if(!t.textArea)return;const e=it(t),n=b(t.textArea,e),a=k(n);return r=>a(r)},Ht=t=>{if(!t.textArea)return;const e=it(t),n=b(t.textArea,e),a=F(n);return r=>a(r)},he=t=>{const e=St(t),n=Ht(t);if(!(!e||!n))return a=>{e(a),n(a)}},Lt=t=>e=>{const{pointA:n,pointB:a,pointC:r,stroke:o}=t;if(o){const d={start:n,end:a,width:o.width},g={start:a,end:r,width:o.width},y={start:r,end:n,width:o.width};return O(d)(e)||O(g)(e)||O(y)(e)}const{x:s,y:i}=e,l=.5*(-a.y*r.x+n.y*(-a.x+r.x)+n.x*(a.y-r.y)+a.x*r.y),c=1/(2*l)*(n.y*r.x-n.x*r.y+(r.y-n.y)*s+(n.x-r.x)*i),u=1/(2*l)*(n.x*a.y-n.y*a.x+(n.y-a.y)*s+(a.x-n.x)*i);return c>0&&u>0&&1-c-u>0},Mt=t=>()=>{const{pointA:e,pointB:n,pointC:a}=t,r=Math.min(e.x,n.x,a.x),o=Math.min(e.y,n.y,a.y),s=Math.max(e.x,n.x,a.x),i=Math.max(e.y,n.y,a.y);return{at:{x:r,y:o},width:s-r,height:i-o}},Ct=t=>{const e=Mt(t)(),n=z(e);return a=>n(a)},pt={color:"black"},xe=t=>{const e=Bt(t),n=Lt(t),a=de(t),r=Ct(t),o=h=>n(h),s=Mt(t),i=he(t),l=St(t),c=Ht(t),u=h=>{e(h),i==null||i(h)};return{id:t.id??p(),name:"triangle",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s}},Bt=t=>e=>{const{pointA:n,pointB:a,pointC:r,color:o,stroke:s,gradientStops:i}={...pt,...t};if(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.lineTo(r.x,r.y),i&&i.length>=2){const l={x:(a.x+r.x)/2,y:(a.y+r.y)/2},c=e.createLinearGradient(l.x,l.y,n.x,n.y);i.forEach(({offset:u,color:h})=>{c.addColorStop(u,h)}),e.fillStyle=c}else e.fillStyle=o;e.fill(),e.closePath(),s&&(e.lineWidth=s.width,e.strokeStyle=s.color,s.dash?e.setLineDash(s.dash):e.setLineDash([]),e.stroke(),e.setLineDash([]))},It=t=>{var P;const{start:e,end:n,width:a,color:r,dash:o,gradientStops:s,arrowHeadSize:i,arrowHeadShape:l}={...j,...t},c=Math.atan2(n.y-e.y,n.x-e.x),{arrowHeadHeight:u,perpLineLength:h}=i(a),d={x:n.x-u*Math.cos(c),y:n.y-u*Math.sin(c)},g={start:e,end:{x:d.x+Math.cos(c),y:d.y+Math.sin(c)},width:a,color:r,dash:o,gradientStops:s},y=vt(g),x=n,L={x:d.x+h*Math.cos(c+Math.PI/2),y:d.y+h*Math.sin(c+Math.PI/2)},B={x:d.x-h*Math.cos(c+Math.PI/2),y:d.y-h*Math.sin(c+Math.PI/2)},I=l?l(n,u,h).draw:Bt({pointA:x,pointB:L,pointC:B,color:s&&s.length?(P=s.at(-1))==null?void 0:P.color:r});return S=>{y(S),I(S)}},Pt=t=>{const{start:e,end:n,width:a,arrowHeadSize:r,arrowHeadShape:o}={...j,...t},s=O(t),{arrowHeadHeight:i,perpLineLength:l}=r(a),c=at({start:e,end:n,width:a,arrowHeadSize:r}),u=o?o(n,i,l).hitbox:Lt(c);return h=>s(h)||u(h)},fe=t=>()=>{const{at:e,width:n,height:a}=Kt(t)(),r={x:e.x,y:e.y},o={x:e.x+n,y:e.y+a},{start:s,end:i,width:l,arrowHeadSize:c}={...j,...t},u=at({start:s,end:i,width:l,arrowHeadSize:c}),h=Math.min(r.x,u.pointA.x,u.pointB.x,u.pointC.x),d=Math.max(r.x,u.pointA.x,u.pointB.x,u.pointC.x),g=Math.min(o.y,u.pointA.y,u.pointB.y,u.pointC.y),y=Math.max(o.y,u.pointA.y,u.pointB.y,u.pointC.y);return{at:{x:h,y:g},width:d-h,height:y-g}},we=t=>{const e=rt(t),{start:n,end:a,width:r,arrowHeadSize:o}={...j,...t},s=at({start:n,end:a,width:r,arrowHeadSize:o}),i=Ct(s);return l=>e(l)||i(l)},Z=t=>{const{textArea:e}=t;if(!e)throw new Error("no text area provided");return Vt(t)},ge=t=>{if(!t.textArea)return;const e=Z(t),n=b(t.textArea,e),{width:a,height:r}=Y(n),o=H({at:n.at,width:a,height:r});return s=>o(s)},Wt=t=>{if(!t.textArea)return;const e=Z(t),n=b(t.textArea,e),a=k(n);return r=>a(r)},Dt=t=>{if(!t.textArea)return;const e=Z(t),n=b(t.textArea,e),a=F(n);return r=>a(r)},ye=t=>{const e=Wt(t),n=Dt(t);if(!(!e||!n))return a=>{e(a),n(a)}},j={...bt,arrowHeadSize:At},ve=t=>{if(t.width&&t.width<0)throw new Error("width must be positive");const e=It(t),n=Pt(t),a=ge(t),r=we(t),o=d=>(a==null?void 0:a(d))||n(d),s=fe(t),i=ye(t),l=Wt(t),c=Dt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=Z(t),x=b(t.textArea,y);G(d,x,g)};return{id:t.id??p(),name:"arrow",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},be=t=>{const e=nt({width:t.size,height:t.size,...t});return n=>e(n)},q=t=>{const{at:e,size:n,textArea:a}=t;if(!a)throw new Error("no text area provided");const{text:r}=a,{fontSize:o}={...N,...r},s=e.x+n/2,i=e.y+n/2;return{x:s-o,y:i-o}},Ae=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),{width:a,height:r}=Y(n),o=H({at:n.at,width:a,height:r});return s=>o(s)},zt=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),a=k(n);return r=>a(r)},Rt=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),a=F(n);return r=>a(r)},Te=t=>{const e=zt(t),n=Rt(t);if(!(!e||!n))return a=>{e(a),n(a)}},me=t=>{const{at:e,size:n,borderRadius:a,rotation:r,stroke:o}={...He,...t},s=H({at:e,width:n,height:n,borderRadius:a,rotation:r,stroke:o});return i=>s(i)},Ee=t=>Qt({at:t.at,width:t.size,height:t.size}),Se=t=>{const e=z({at:t.at,width:t.size,height:t.size});return n=>e(n)},He=te,Le=t=>{const e=be(t),n=me(t),a=Ae(t),r=Se(t),o=d=>(a==null?void 0:a(d))||n(d),s=Ee(t),i=Te(t),l=zt(t),c=Rt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=q(t),x=b(t.textArea,y);G(d,x,g)};return{id:t.id??p(),name:"square",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},Me=t=>{const{spacing:e,at:n,upDistance:a,downDistance:r,rotation:o,lineWidth:s,color:i,arrowHeadShape:l,arrowHeadSize:c,gradientStops:u}={...Xt,...t},h=T({x:n.x,y:n.y-e},n,o),d=T({x:n.x+a,y:n.y-e},n,o),g=T({x:n.x+a,y:n.y+e},n,o),y=T({x:n.x+a-r,y:n.y+e},n,o),x=T({x:n.x+a,y:n.y},n,o);let L=[],B=[],I=[];if(u.length>=2){const f=a+r+Math.PI*e,M=dt(u,a/f),W=dt(u,(f-r)/f);L=[...u.filter(v=>v.offset<=a/f),{offset:1,color:M}],B=[{offset:0,color:M},...u.filter(v=>v.offset>=a/f&&v.offset<=(f-r)/f).map(v=>({offset:(v.offset-a/f)/(Math.PI*e/f),color:v.color})),{offset:1,color:W}],I=[{offset:0,color:W},...u.filter(v=>v.offset>=(f-r)/f).map(v=>({offset:(v.offset-(f-r)/f)/(r/f),color:v.color}))]}const P=vt({start:h,end:d,width:s,color:i,gradientStops:L}),S=It({start:g,end:y,width:s,color:i,arrowHeadSize:c,arrowHeadShape:l,gradientStops:I});return f=>{if(P(f),S(f),f.beginPath(),f.strokeStyle=i,B.length>=2){const M=Math.PI/2+o+.01,W=-Math.PI/2+o-.01,v=x.x+Math.cos(M)*e,V=x.y+Math.sin(M)*e,ut=x.x+Math.cos(W)*e,$=x.y+Math.sin(W)*e,w=f.createLinearGradient(ut,$,v,V);for(const A of B)w.addColorStop(A.offset,A.color);f.strokeStyle=w}f.arc(x.x,x.y,e,Math.PI/2+o+.01,-Math.PI/2+o-.01,!0),f.lineWidth=s,f.stroke(),f.closePath()}},Ce=t=>{const{spacing:e,at:n,downDistance:a,upDistance:r,lineWidth:o,rotation:s}=t,i=T({x:n.x,y:n.y-e},n,s),l=T({x:n.x+r,y:n.y-e},n,s),c=T({x:n.x+r,y:n.y+e},n,s),u=T({x:n.x+r-a,y:n.y+e},n,s),h=T({x:n.x+r,y:n.y},n,s),d=O({start:i,end:l,width:o}),g=Pt({start:c,end:u,width:o}),y=Tt({at:h,radius:e+o/2});return x=>d(x)||g(x)||y(x)},_t=t=>()=>{const{spacing:e,at:n,upDistance:a,rotation:r,lineWidth:o}=t,s=T({x:n.x+a,y:n.y},n,r),i=Math.min(n.x,s.x)-o/2-e,l=Math.min(n.y,s.y)-o/2-e,c=Math.max(n.x,s.x)+o/2+e,u=Math.max(n.y,s.y)+o/2+e;return{at:{x:i,y:l},width:c-i,height:u-l}},pe=t=>{const e=_t(t)(),n=z(e);return a=>n(a)},J=t=>{const{at:e,upDistance:n,rotation:a,textArea:r,spacing:o,lineWidth:s}={...Xt,...t};if(!r)throw new Error("no text area provided");const{text:i}=r,{fontSize:l}={...N,...i},c=T({x:e.x+n+o+s/2,y:e.y},e,a);return{x:c.x-l+Math.cos(a)*15,y:c.y-l+Math.sin(a)*15}},Be=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),{width:a,height:r}=Y(n),o=H({at:n.at,width:a,height:r});return s=>o(s)},Ot=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),a=k(n);return r=>a(r)},Ut=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),a=F(n);return r=>a(r)},Ie=t=>{const e=Ot(t),n=Ut(t);if(!(!e||!n))return a=>{e(a),n(a)}},Xt={color:"black",arrowHeadSize:At,gradientStops:[]},Pe=t=>{if(t.downDistance<0)throw new Error("downDistance must be positive");if(t.upDistance<0)throw new Error("upDistance must be positive");const e=Me(t),n=Ce(t),a=Be(t),r=pe(t),o=d=>(a==null?void 0:a(d))||n(d),s=_t(t),i=Ie(t),l=Ot(t),c=Ut(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=J(t),x=b(t.textArea,y);G(d,x,g)};return{id:t.id??p(),name:"uturn",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},We=t=>{const{at:e,size:n,rotation:a,lineWidth:r,borderRadius:o}={...kt,...t},s=r/2,i=H({at:{x:e.x-n/2,y:e.y-s},width:n,height:r,rotation:a,borderRadius:o}),l=H({at:{x:e.x-s,y:e.y-n/2},width:r,height:n,rotation:a,borderRadius:o});return c=>i(c)||l(c)},Yt=t=>()=>{const{at:e,size:n}=t;return{at:{x:e.x-n/2,y:e.y-n/2},width:n,height:n}},De=t=>{const e=Yt(t)(),n=z(e);return a=>n(a)},ze=t=>{const{at:e,size:n,rotation:a,color:r,lineWidth:o,borderRadius:s}={...kt,...t},i=o/2;return l=>{nt({at:{x:e.x-i,y:e.y-n/2},width:o,height:n,color:r,borderRadius:s,rotation:a})(l),nt({at:{x:e.x-n/2,y:e.y-i},width:n,height:o,color:r,borderRadius:s,rotation:a})(l)}},kt={rotation:0,color:"black",lineWidth:bt.width,borderRadius:0},Re=t=>{if(t.lineWidth&&t.lineWidth<0)throw new Error("lineWidth must be positive");const e=ze(t),n=We(t),a=De(t),r=i=>n(i),o=Yt(t),s=i=>{e(i)};return{id:t.id??p(),name:"cross",draw:s,drawShape:e,shapeHitbox:n,hitbox:r,efficientHitbox:a,getBoundingBox:o}},_e=t=>e=>{const{type:n,color:a,brushWeight:r,points:o}={...lt,...t};n==="draw"?(()=>{if(o.length===1){mt({at:o[0],radius:r/2,color:a}).draw(e);return}e.strokeStyle=a,e.lineCap="round",e.lineJoin="round",e.lineWidth=r,e.beginPath();const[l,...c]=o;e.moveTo(l.x,l.y),c.forEach(({x:u,y:h})=>e.lineTo(u,h)),e.stroke()})():(()=>{e.globalCompositeOperation="destination-out",e.lineWidth=et;for(let l=0;l<o.length-1;l++){const c=o[l],u=o[l+1],h=Math.pow(u.x-c.x,2)+Math.pow(u.y-c.y,2),d=Math.sqrt(h),g=Math.ceil(d/et);for(let y=0;y<=g;y++){const x=c.x+y/g*(u.x-c.x),L=c.y+y/g*(u.y-c.y);e.beginPath(),e.arc(x,L,et,0,Math.PI*2),e.fill()}}e.globalCompositeOperation="source-over"})(),e.lineCap="butt",e.lineJoin="miter"},Oe=t=>e=>{const{type:n,points:a,brushWeight:r}={...lt,...t};if(n==="erase")return!1;const{at:o,width:s,height:i}=ct(t)();if(!H({at:o,width:Math.max(s,10),height:Math.max(i,10)})(e))return!1;if(a.length===1&&Tt({at:a[0],radius:r})(e))return!0;for(let c=0;c<a.length-1;c++){const u={start:a[c],end:a[c+1]};if(rt(u)({at:e,width:1,height:1}))return!0}return!1},ct=t=>()=>{const{points:e}=t;let n=e[0].x,a=e[0].y,r=e[0].x,o=e[0].y;for(const s of e)s.x<n&&(n=s.x),s.y<a&&(a=s.y),s.x>r&&(r=s.x),s.y>o&&(o=s.y);return{at:{x:n,y:a},width:r-n,height:o-a}},Ue=t=>e=>{if(t.type==="erase")return!1;const{at:n,width:a,height:r}=ct(t)(),o=z({at:n,width:Math.max(a,10),height:Math.max(r,10)}),{points:s,brushWeight:i}={...lt,...t};if(s.length===1&&ee({at:s[0],radius:i})(e))return!0;if(!o(e))return!1;for(let l=0;l<s.length-1;l++){const c={start:s[l],end:s[l+1]};if(rt(c)(e))return!0}return!1},lt={color:"red",brushWeight:3},et=50,Xe=t=>{if(t.points.length<1)throw new Error("not enough points to draw scribble");if(t.brushWeight&&t.brushWeight<1)throw new Error('brushWeight must be at least "1"');const e=Oe(t),n=Ue(t),a=i=>e(i),r=ct(t),o=_e(t),s=i=>{o(i)};return{id:t.id??p(),name:"scribble",drawShape:o,draw:s,hitbox:a,shapeHitbox:e,efficientHitbox:n,getBoundingBox:r}},Ye=t=>e=>{const{at:n,radiusX:a,radiusY:r,color:o,stroke:s}={...Gt,...t};if(e.beginPath(),e.ellipse(n.x,n.y,a,r,0,0,2*Math.PI),e.fillStyle=o,e.fill(),s){const{color:i,width:l,dash:c}=s;e.strokeStyle=i,e.lineWidth=l,e.setLineDash(c||[]),e.stroke(),e.setLineDash([])}e.closePath()},ke=t=>e=>{const n=e.x-t.at.x,a=e.y-t.at.y,r={...Et,...t.stroke},o=t.radiusX+r.width/2,s=t.radiusY+r.width/2;return n*n/(o*o)+a*a/(s*s)<=1},Ft=t=>()=>{const{at:e,radiusX:n,radiusY:a}=t,{width:r}={...Et,...t.stroke};return{at:{x:e.x-(n+r/2),y:e.y-(a+r/2)},width:2*n+r,height:2*a+r}},Fe=t=>{const e=Ft(t)(),n=z(e);return a=>n(a)},K=t=>{const{at:e,textArea:n}={...Gt,...t};if(!n)throw new Error("no text area provided");const{text:a}=n,{fontSize:r}={...N,...a};return{x:e.x-r,y:e.y-r}},$e=t=>{if(!t.textArea)return;const e=K(t),n=b(t.textArea,e),{width:a,height:r}=Y(n),o=H({at:n.at,width:a,height:r});return s=>o(s)},$t=t=>{if(!t.textArea)return;const e=K(t),n=b(t.textArea,e),a=k(n);return r=>a(r)},Nt=t=>{if(!t.textArea)return;const e=K(t),n=b(t.textArea,e),a=F(n);return r=>a(r)},Ne=t=>{const e=$t(t),n=Nt(t);if(!(!e||!n))return a=>{e(a),n(a)}},Gt=ne,Ge=t=>{if(t.radiusX<0||t.radiusY<0)throw new Error("radius must be positive");const e=Ye(t),n=ke(t),a=$e(t),r=Fe(t),o=d=>(a==null?void 0:a(d))||n(d),s=Ft(t),i=Ne(t),l=$t(t),c=Nt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=K(t),x=b(t.textArea,y);G(d,x,g)};return{id:p(),name:"ellipse",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},Ze=t=>{const{at:e,innerRadius:n,outerRadius:a,points:r=5,rotation:o=0}=t,s=[];for(let i=0;i<r*2;i++){const l=i%2===0?a:n,c=i*Math.PI/r,u=Math.cos(c)*l,h=Math.sin(c)*l,d=T({x:u,y:h},{x:0,y:0},o);s.push({x:d.x+e.x,y:d.y+e.y})}return s},je=(t,e)=>{let n=!1;for(let a=0,r=e.length-1;a<e.length;r=a++){const o=e[a].x,s=e[a].y,i=e[r].x,l=e[r].y;s>t.y!=l>t.y&&(l-s!==0?t.x<(i-o)*(t.y-s)/(l-s)+o:t.x<o)&&(n=!n)}return n},qe=t=>e=>{const n=Ze(t);return je(e,n)},Zt=t=>()=>{const{at:e,outerRadius:n}=t,a=n*2;return{at:{x:e.x-n,y:e.y-n},width:a,height:a}},Je=t=>e=>{const n=Zt(t)();return e.at.x<n.at.x+n.width&&e.at.x+e.width>n.at.x&&e.at.y<n.at.y+n.height&&e.at.y+e.height>n.at.y},Ke=t=>{const{at:e,color:n,innerRadius:a,outerRadius:r,rotation:o,points:s}={...Ve,...t};if(s<3)throw new Error("star must have at least 3 points");if(a>=r)throw new Error("inner radius must be less than outer radius");if(a<0||r<0)throw new Error("radius values must be positive");return i=>{i.save(),i.beginPath(),i.translate(e.x,e.y),i.rotate(o);for(let l=0;l<s*2;l++){const c=l%2===0?r:a,u=l*Math.PI/s,h=Math.cos(u)*c,d=Math.sin(u)*c;l===0?i.moveTo(h,d):i.lineTo(h,d)}i.closePath(),i.fillStyle=n,i.fill(),i.restore()}},Ve={color:"black",points:5,rotation:0},Qe=t=>{const e=Ke(t),n=qe(t),a=n,r=Je(t),o=Zt(t);return{id:t.id??p(),name:"star",draw:e,drawShape:e,hitbox:a,shapeHitbox:n,efficientHitbox:r,getBoundingBox:o}},tn=ae,en=ve,nn=mt,an=re,rn=Le,on=xe,sn=Pe,jt=Re,cn=Xe,ln=Ge,un=Qe,bn={arrow:en,circle:nn,line:tn,rect:an,square:rn,triangle:on,uturn:sn,cross:jt,scribble:cn,ellipse:ln,star:un},dn=(t,e)=>{let n;return()=>{clearTimeout(n),n=setTimeout(t,e)}},hn=()=>{const{class:t}=oe();return U(()=>{if(!t)return[];if(typeof t!="string")throw new Error("class attribute must be a string");return t.split(" ")})},gt=.5,yt=5,E=m(1);function xn(t){const e=m({x:0,y:0});let n=!1;const a=o=>{if(!o.ctrlKey)return;o.preventDefault(),n=!0;const s=t.value;if(!s)return;const i=s.getBoundingClientRect(),l=o.clientX-i.left,c=o.clientY-i.top,u=o.deltaY<0?1.03:.97,h=Math.min(yt,Math.max(gt,E.value*u));h<=gt||h>=yt||(e.value.x=l-(l-e.value.x)*(h/E.value),e.value.y=c-(c-e.value.y)*(h/E.value),E.value=h)},r=()=>{const o=X(t);o.resetTransform(),o.translate(e.value.x,e.value.y),o.scale(E.value,E.value)};return ot(()=>{const o=t.value;if(!o)throw new Error("Canvas ref is not defined");o.addEventListener("wheel",a,{passive:!1})}),st(()=>{const o=t.value;o&&o.removeEventListener("wheel",a)}),D(E,(o,s)=>{const i=t.value;if(i){if(!n){const l=i.getBoundingClientRect(),c=window.innerWidth/2,u=window.innerHeight/2,h=c-l.left,d=u-l.top;e.value.x=h-(h-e.value.x)*(E.value/s),e.value.y=d-(d-e.value.y)*(E.value/s)}r(),n=!1}}),{scale:E,origin:e}}const fn=t=>{const e=Q("pan-zoom-scale",0),n=Q("pan-zoom-pan-x",0),a=Q("pan-zoom-pan-y",0),r=()=>{const s=X(t),{a:i,e:l,f:c}=s.getTransform();e.value=i,n.value=l,a.value=c},o=()=>{X(t)};return ot(()=>{t.value&&(t.value.addEventListener("wheel",r),t.value.addEventListener("mousedown",r),t.value.addEventListener("mouseup",r),setTimeout(()=>o(),0))}),st(()=>{t.value&&(t.value.removeEventListener("wheel",r),t.value.removeEventListener("mousedown",r),t.value.removeEventListener("mouseup",r))}),{track:r,apply:o,scale:e,panX:n,panY:a}},wn=t=>{const e=m(!0),n=m(!1),a=m({x:0,y:0}),r=m({x:0,y:0}),o=c=>{e.value&&t.value&&c.button===se.middle&&(c.preventDefault(),n.value=!0,a.value={x:c.clientX,y:c.clientY},r.value={x:t.value.scrollLeft,y:t.value.scrollTop})},s=c=>{if(!n.value||!t.value)return;const u=a.value.x-c.clientX,h=a.value.y-c.clientY;t.value.scrollLeft=r.value.x+u,t.value.scrollTop=r.value.y+h},i=()=>{n.value=!1},l=c=>{if(!t.value)return;const{left:u=0,top:h=0,behavior:d}=c,g=u-window.screen.width/2,y=h-window.screen.height/2;t.value.scrollTo({left:g,top:y,behavior:d})};return{allowPanning:e,isPanning:U(()=>n.value),teleportTo:l,startPan:o,pan:s,endPan:i}},gn=["width","height"],yn=["width","height"],An=ie({__name:"ResponsiveCanvas",props:{color:{},patternColor:{},canvasWidth:{},canvasHeight:{}},emits:["canvasRef","widthChange","heightChange"],setup(t,{emit:e}){const n=m(0),a=m(0),r=m(!0),o=m(),s=m(),i=t,l=U(()=>(i==null?void 0:i.canvasWidth)??5e3),c=U(()=>(i==null?void 0:i.canvasHeight)??3e3),u=e,h=["w-full","h-full","relative","overflow-auto"],d=hn(),g=U(()=>[...h,...d.value]),y=w=>{o.value=w,u("canvasRef",w)},x=m(),{height:L,width:B}=ce(x),{startPan:I,pan:P,endPan:S}=wn(x),f=()=>{n.value=l.value,a.value=c.value},M=async()=>x.value??new Promise(w=>{const A=setInterval(()=>{x.value&&(clearInterval(A),w(x.value))},100)}),W=async()=>new Promise(w=>{const A=setInterval(()=>{s.value&&(w(X(s.value)),clearInterval(A))},100)}),v=async()=>{const w=await W();w.clearRect(0,0,n.value,a.value);const A=75,C=(R,_)=>{jt({at:{x:R,y:_},size:2,color:i.patternColor}).draw(w)},qt=n.value,Jt=a.value;for(let R=A/2;R<qt;R+=A)for(let _=A/2;_<Jt;_+=A)C(R,_)},V=dn(v,250);(async()=>{v();const w=await M(),A=a.value/2-w.clientHeight/2;w.scrollTop=A;const C=n.value/2-w.clientWidth/2;w.scrollLeft=C,r.value=!1})(),D(L,()=>{f(),v(),u("widthChange",n.value)}),D(B,()=>{f(),v(),u("heightChange",a.value)}),D([l,c],()=>{f(),v(),u("widthChange",n.value),u("heightChange",a.value)}),D(()=>i.patternColor,v),le({canvasWidth:n,canvasHeight:a,getParentEl:M});const $=xn(o);return fn(o),D($.scale,()=>{const{scale:w,origin:A}=$,C=X(s.value);C.clearRect(0,0,n.value,a.value),C.resetTransform(),C.translate(A.value.x,A.value.y),C.scale(w.value,w.value),V()}),ot(()=>{x.value&&(x.value.addEventListener("mousedown",I),x.value.addEventListener("mousemove",P),x.value.addEventListener("mouseup",S),x.value.addEventListener("mouseleave",S),x.value.addEventListener("contextmenu",w=>w.preventDefault()))}),st(()=>{x.value&&(x.value.removeEventListener("mousedown",I),x.value.removeEventListener("mousemove",P),x.value.removeEventListener("mouseup",S),x.value.removeEventListener("mouseleave",S),x.value.removeEventListener("contextmenu",w=>w.preventDefault()))}),(w,A)=>(wt(),ht("div",{ref_key:"parentEl",ref:x,id:"responsive-canvas-container",class:tt(g.value)},[r.value?(wt(),ht("div",{key:0,style:xt({backgroundColor:w.color}),class:"absolute top-0 left-0 w-full h-full"},null,4)):ue("",!0),ft("canvas",{ref:y,id:"responsive-canvas",width:n.value,height:a.value,class:tt([`w-[${n.value}px]`,`h-[${a.value}px]`])},null,10,gn),ft("canvas",{ref_key:"bgCanvas",ref:s,width:n.value,height:a.value,style:xt({backgroundColor:w.color}),class:tt([`w-[${n.value}px]`,`h-[${a.value}px]`,"absolute","top-0","-z-10","pointer-events-none"])},null,14,yn)],2))}});export{yt as M,An as _,E as a,gt as b,nn as c,dn as d,rn as e,en as f,sn as g,tn as l,an as r,bn as s,hn as u};
