import{bh as y,bi as D,bj as M,bk as k,bl as K,bm as _,bn as P,bo as I,aa as C,bp as G,bq as V,br as it,bs as St,bt as Bt,bu as ct,bv as It,bw as Q,bx as J,by as Wt,bz as E,bA as Pt,bB as zt,bC as Rt,bD as Dt,H as R,g as H,ao as lt,z as ht,O as N,d as kt,bE as _t,A as B,bF as Ot,c as ot,X as at,E as Ut,a as rt,K as Z,o as st}from"./index-X-1QUzvR.js";const q=t=>{const{pointA:n,pointB:e,pointC:o,textArea:a}={...gt,...t};if(!a)throw new Error("no text area provided");const{text:r}=a,{fontSize:s}={...K,...r},i=(n.x+e.x+o.x)/3,c=(n.y+e.y+o.y)/3;return{x:i-s,y:c-s}},Xt=t=>{if(!t.textArea)return;const n=q(t),e=y(t.textArea,n),{width:o,height:a}=D(e),r=M({at:e.at,width:o,height:a});return s=>r(s)},xt=t=>{if(!t.textArea)return;const n=q(t),e=y(t.textArea,n),o=k(e);return a=>o(a)},dt=t=>{if(!t.textArea)return;const n=q(t),e=y(t.textArea,n),o=_(e);return a=>o(a)},Yt=t=>{const n=xt(t),e=dt(t);if(!(!n||!e))return o=>{n(o),e(o)}},ut=t=>n=>{const{pointA:e,pointB:o,pointC:a,stroke:r}=t;if(r){const x={start:e,end:o,width:r.width},g={start:o,end:a,width:r.width},f={start:a,end:e,width:r.width};return I(x)(n)||I(g)(n)||I(f)(n)}const{x:s,y:i}=n,c=.5*(-o.y*a.x+e.y*(-o.x+a.x)+e.x*(o.y-a.y)+o.x*a.y),l=1/(2*c)*(e.y*a.x-e.x*a.y+(a.y-e.y)*s+(e.x-a.x)*i),h=1/(2*c)*(e.x*o.y-e.y*o.x+(e.y-o.y)*s+(o.x-e.x)*i);return l>0&&h>0&&1-l-h>0},wt=t=>()=>{const{pointA:n,pointB:e,pointC:o}=t,a=Math.min(n.x,e.x,o.x),r=Math.min(n.y,e.y,o.y),s=Math.max(n.x,e.x,o.x),i=Math.max(n.y,e.y,o.y);return{topLeft:{x:a,y:r},bottomRight:{x:s,y:i}}},ft=t=>{const{topLeft:n,bottomRight:e}=wt(t)(),o=P({at:n,width:e.x-n.x,height:e.y-n.y});return a=>o(a)},gt={color:"black"},$t=t=>{const n=tt(t),e=ut(t),o=Xt(t),a=ft(t),r=d=>e(d),s=wt(t),i=Yt(t),c=xt(t),l=dt(t),h=d=>{n(d),i==null||i(d)};return{id:t.id??C(),name:"triangle",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:c,drawText:l,hitbox:r,shapeHitbox:e,textHitbox:o,efficientHitbox:a,getBoundingBox:s}},tt=t=>n=>{const{pointA:e,pointB:o,pointC:a,color:r,stroke:s}={...gt,...t};n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(o.x,o.y),n.lineTo(a.x,a.y),n.fillStyle=r,n.fill(),n.closePath(),s&&(n.lineWidth=s.width,n.strokeStyle=s.color,s.dash?n.setLineDash(s.dash):n.setLineDash([]),n.stroke(),n.setLineDash([]))},Ft=t=>{const{start:n,end:e,width:o,color:a,arrowHeadSize:r}={...U,...t},s=Math.atan2(e.y-n.y,e.x-n.x),{arrowHeadHeight:i,perpLineLength:c}=r(o),l={x:e.x-i*Math.cos(s),y:e.y-i*Math.sin(s)},h=e,d={x:l.x+c*Math.cos(s+Math.PI/2),y:l.y+c*Math.sin(s+Math.PI/2)},x={x:l.x-c*Math.cos(s+Math.PI/2),y:l.y-c*Math.sin(s+Math.PI/2)},g={start:n,end:{x:l.x+Math.cos(s),y:l.y+Math.sin(s)},width:o,color:a},f=G(g),u=tt({pointA:h,pointB:d,pointC:x,color:a});return A=>{f(A),u(A)}},Nt=t=>{const{start:n,end:e,width:o,arrowHeadSize:a}={...U,...t},r=I(t),s=V({start:n,end:e,width:o,arrowHeadSize:a}),i=ut(s);return c=>r(c)||i(c)},Zt=t=>()=>{const{topLeft:n,bottomRight:e}=St(t)(),{start:o,end:a,width:r,arrowHeadSize:s}={...U,...t},i=V({start:o,end:a,width:r,arrowHeadSize:s}),c=Math.min(n.x,i.pointA.x,i.pointB.x,i.pointC.x),l=Math.max(n.x,i.pointA.x,i.pointB.x,i.pointC.x),h=Math.min(e.y,i.pointA.y,i.pointB.y,i.pointC.y),d=Math.max(e.y,i.pointA.y,i.pointB.y,i.pointC.y);return{topLeft:{x:c,y:h},bottomRight:{x:l,y:d}}},jt=t=>{const n=it(t),{start:e,end:o,width:a,arrowHeadSize:r}={...U,...t},s=V({start:e,end:o,width:a,arrowHeadSize:r}),i=ft(s);return c=>n(c)||i(c)},O=t=>{const{textArea:n}=t;if(!n)throw new Error("no text area provided");return Bt(t)},Gt=t=>{if(!t.textArea)return;const n=O(t),e=y(t.textArea,n),{width:o,height:a}=D(e),r=M({at:e.at,width:o,height:a});return s=>r(s)},yt=t=>{if(!t.textArea)return;const n=O(t),e=y(t.textArea,n),o=k(e);return a=>o(a)},bt=t=>{if(!t.textArea)return;const n=O(t),e=y(t.textArea,n),o=_(e);return a=>o(a)},Jt=t=>{const n=yt(t),e=bt(t);if(!(!n||!e))return o=>{n(o),e(o)}},U={...ct,arrowHeadSize:It},Kt=t=>{if(t.width&&t.width<0)throw new Error("width must be positive");const n=Ft(t),e=Nt(t),o=Gt(t),a=jt(t),r=x=>(o==null?void 0:o(x))||e(x),s=Zt(t),i=Jt(t),c=yt(t),l=bt(t),h=x=>{n(x),i==null||i(x)},d=(x,g)=>{if(!t.textArea)return;const f=O(t),u=y(t.textArea,f);Q(x,u,g)};return{id:t.id??C(),name:"arrow",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:c,drawText:l,hitbox:r,shapeHitbox:e,textHitbox:o,efficientHitbox:a,getBoundingBox:s,activateTextArea:d}},Vt=t=>{const n=J({width:t.size,height:t.size,...t});return e=>n(e)},X=t=>{const{at:n,size:e,textArea:o}=t;if(!o)throw new Error("no text area provided");const{text:a}=o,{fontSize:r}={...K,...a},s=n.x+e/2,i=n.y+e/2;return{x:s-r,y:i-r}},Qt=t=>{if(!t.textArea)return;const n=X(t),e=y(t.textArea,n),{width:o,height:a}=D(e),r=M({at:e.at,width:o,height:a});return s=>r(s)},vt=t=>{if(!t.textArea)return;const n=X(t),e=y(t.textArea,n),o=k(e);return a=>o(a)},At=t=>{if(!t.textArea)return;const n=X(t),e=y(t.textArea,n),o=_(e);return a=>o(a)},qt=t=>{const n=vt(t),e=At(t);if(!(!n||!e))return o=>{n(o),e(o)}},te=t=>{const n=M({at:t.at,width:t.size,height:t.size,borderRadius:t.borderRadius,rotation:t.rotation,stroke:t.stroke});return e=>n(e)},ee=t=>Wt({at:t.at,width:t.size,height:t.size}),ne=t=>{const n=P({at:t.at,width:t.size,height:t.size});return e=>n(e)},oe=t=>{const n=Vt(t),e=te(t),o=Qt(t),a=ne(t),r=x=>(o==null?void 0:o(x))||e(x),s=ee(t),i=qt(t),c=vt(t),l=At(t),h=x=>{n(x),i==null||i(x)},d=(x,g)=>{if(!t.textArea)return;const f=X(t),u=y(t.textArea,f);Q(x,u,g)};return{id:t.id??C(),name:"square",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:c,drawText:l,hitbox:r,shapeHitbox:e,textHitbox:o,efficientHitbox:a,getBoundingBox:s,activateTextArea:d}},ae=t=>{const{spacing:n,at:e,upDistance:o,downDistance:a,rotation:r,lineWidth:s,color:i}={...Et,...t},c=s*2.5,l=c/1.75,h=E({x:e.x,y:e.y-n},e,r),d=E({x:e.x+o,y:e.y-n},e,r),x=E({x:e.x+o,y:e.y+n},e,r),g=E({x:e.x+o-a+c,y:e.y+n},e,r),f=E({x:e.x+o,y:e.y},e,r),u=g,A={x:u.x-c*Math.cos(r),y:u.y-c*Math.sin(r)},$={x:u.x-l*Math.cos(r+Math.PI/2+.01),y:u.y-l*Math.sin(r+Math.PI/2+.01)},p={x:u.x+l*Math.cos(r+Math.PI/2-.01),y:u.y+l*Math.sin(r+Math.PI/2-.01)},z=tt({pointA:A,pointB:$,pointC:p,color:i}),F=G({start:h,end:d,width:s,color:i}),m=G({start:x,end:g,width:s,color:i});return v=>{F(v),z(v),m(v),v.beginPath(),v.arc(f.x,f.y,n,Math.PI/2+r+.01,-Math.PI/2+r-.01,!0),v.strokeStyle=i,v.stroke(),v.closePath()}},re=t=>{const{spacing:n,at:e,upDistance:o,lineWidth:a,rotation:r}=t,s=E({x:e.x+o,y:e.y},e,r),i=I({start:e,end:s,width:2*n+a});return c=>i(c)},mt=t=>()=>{const{spacing:n,at:e,upDistance:o,rotation:a,lineWidth:r}=t,s=E({x:e.x+o,y:e.y},e,a),i=Math.min(e.x,s.x)-r/2-n,c=Math.min(e.y,s.y)-r/2-n,l=Math.max(e.x,s.x)+r/2+n,h=Math.max(e.y,s.y)+r/2+n;return{topLeft:{x:i,y:c},bottomRight:{x:l,y:h}}},se=t=>{const{topLeft:n,bottomRight:e}=mt(t)(),o=e.x-n.x,a=e.y-n.y,r=P({at:{x:n.x,y:n.y},width:o,height:a});return s=>r(s)},Y=t=>{const{at:n,upDistance:e,rotation:o,textArea:a,spacing:r,lineWidth:s}={...Et,...t};if(!a)throw new Error("no text area provided");const{text:i}=a,{fontSize:c}={...K,...i},l=E({x:n.x+e+r+s/2,y:n.y},n,o);return{x:l.x-c+Math.cos(o)*15,y:l.y-c+Math.sin(o)*15}},ie=t=>{if(!t.textArea)return;const n=Y(t),e=y(t.textArea,n),{width:o,height:a}=D(e),r=M({at:e.at,width:o,height:a});return s=>r(s)},Tt=t=>{if(!t.textArea)return;const n=Y(t),e=y(t.textArea,n),o=k(e);return a=>o(a)},Ht=t=>{if(!t.textArea)return;const n=Y(t),e=y(t.textArea,n),o=_(e);return a=>o(a)},ce=t=>{const n=Tt(t),e=Ht(t);if(!(!n||!e))return o=>{n(o),e(o)}},Et={color:"black"},le=t=>{if(t.downDistance<0)throw new Error("downDistance must be positive");if(t.upDistance<0)throw new Error("upDistance must be positive");const n=ae(t),e=re(t),o=ie(t),a=se(t),r=x=>(o==null?void 0:o(x))||e(x),s=mt(t),i=ce(t),c=Tt(t),l=Ht(t),h=x=>{n(x),i==null||i(x)},d=(x,g)=>{if(!t.textArea)return;const f=Y(t),u=y(t.textArea,f);Q(x,u,g)};return{id:t.id??C(),name:"uturn",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:c,drawText:l,hitbox:r,shapeHitbox:e,textHitbox:o,efficientHitbox:a,getBoundingBox:s,activateTextArea:d}},he=t=>{const{at:n,size:e,rotation:o,lineWidth:a,borderRadius:r}={...Mt,...t},s=a/2,i=M({at:{x:n.x-e/2,y:n.y-s},width:e,height:a,rotation:o,borderRadius:r}),c=M({at:{x:n.x-s,y:n.y-e/2},width:a,height:e,rotation:o,borderRadius:r});return l=>i(l)||c(l)},xe=t=>()=>{const{at:n,size:e}=t;return{topLeft:{x:n.x-e/2,y:n.y-e/2},bottomRight:{x:n.x+e/2,y:n.y+e/2}}},de=t=>{const{at:n,size:e}=t,o=P({at:{x:n.x-e/2,y:n.y-e/2},width:e,height:e});return a=>o(a)},ue=t=>{const{at:n,size:e,rotation:o,color:a,lineWidth:r,borderRadius:s}={...Mt,...t},i=r/2;return c=>{J({at:{x:n.x-i,y:n.y-e/2},width:r,height:e,color:a,borderRadius:s,rotation:o})(c),J({at:{x:n.x-e/2,y:n.y-i},width:e,height:r,color:a,borderRadius:s,rotation:o})(c)}},Mt={rotation:0,color:"black",lineWidth:ct.width,borderRadius:0},we=t=>{if(t.lineWidth&&t.lineWidth<0)throw new Error("lineWidth must be positive");const n=ue(t),e=he(t),o=de(t),a=i=>e(i),r=xe(t),s=i=>{n(i)};return{id:t.id??C(),name:"cross",draw:s,drawShape:n,shapeHitbox:e,hitbox:a,efficientHitbox:o,getBoundingBox:r}},fe=t=>n=>{const{type:e,color:o,brushWeight:a,points:r}={...be,...t};e==="draw"?(()=>{n.strokeStyle=o,n.lineCap="round",n.lineJoin="round",n.lineWidth=a,n.beginPath();const[c,...l]=r;n.moveTo(c.x,c.y),l.forEach(({x:h,y:d})=>n.lineTo(h,d)),n.stroke()})():(()=>{n.globalCompositeOperation="destination-out",n.lineWidth=j;for(let c=0;c<r.length-1;c++){const l=r[c],h=r[c+1],d=Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2),x=Math.sqrt(d),g=Math.ceil(x/j);for(let f=0;f<=g;f++){const u=l.x+f/g*(h.x-l.x),A=l.y+f/g*(h.y-l.y);n.beginPath(),n.arc(u,A,j,0,Math.PI*2),n.fill()}}n.globalCompositeOperation="source-over"})(),n.lineCap="butt",n.lineJoin="miter"},ge=t=>n=>{const{type:e,points:o}=t;if(e==="erase")return!1;const{topLeft:a,bottomRight:r}=et(t)(),s=r.x-a.x,i=r.y-a.y;if(!M({at:{x:a.x,y:a.y},width:Math.max(s,10),height:Math.max(i,10)})(n))return!1;for(let l=0;l<o.length-1;l++){const h={start:o[l],end:o[l+1]};if(it(h)({at:n,width:1,height:1}))return!0}return!1},et=t=>()=>{const{points:n}=t;let e=n[0].x,o=n[0].y,a=n[0].x,r=n[0].y;for(const s of n)s.x<e&&(e=s.x),s.y<o&&(o=s.y),s.x>a&&(a=s.x),s.y>r&&(r=s.y);return{topLeft:{x:e,y:o},bottomRight:{x:a,y:r}}},ye=t=>{if(t.type==="erase")return s=>!1;const{topLeft:n,bottomRight:e}=et(t)(),o=e.x-n.x,a=e.y-n.y,r=P({at:{x:n.x,y:n.y},width:Math.max(o,10),height:Math.max(a,10)});return s=>r(s)},be={color:"red",brushWeight:3},j=50,ve=t=>{if(t.points.length<1)throw new Error("not enough points to draw scribble");if(t.brushWeight&&t.brushWeight<1)throw new Error('brushWeight must be at least "1"');const n=ge(t),e=ye(t),o=i=>n(i),a=et(t),r=fe(t),s=i=>{r(i)};return{id:t.id??C(),name:"scribble",drawShape:r,draw:s,hitbox:o,shapeHitbox:n,efficientHitbox:e,getBoundingBox:a}},Ae=Pt,me=Kt,Te=zt,He=Rt,Ee=oe,Me=$t,Ce=le,Ct=we,pe=ve,_e={arrow:me,circle:Te,line:Ae,rect:He,square:Ee,triangle:Me,uturn:Ce,cross:Ct,scribble:pe},W=t=>{if(!t)throw new Error("canvas not found");const n="value"in t?t.value:t;if(!n)throw new Error("canvas not found");const e=n.getContext("2d");if(!e)throw new Error("2d context not found");return e},Le=()=>{const{class:t}=Dt();return R(()=>{if(!t)return[];if(typeof t!="string")throw new Error("class attribute must be a string");return t.split(" ")})},Se=(t,n)=>{let e;return()=>{clearTimeout(e),e=setTimeout(t,n)}},Be=.5,Ie=5;function We(t){const n=H(1),e=H({x:0,y:0}),o=r=>{if(!r.ctrlKey)return;r.preventDefault();const s=t.value;if(!s)return;const i=s.getBoundingClientRect(),c=r.clientX-i.left,l=r.clientY-i.top,h=r.deltaY<0?1.03:.97,d=Math.min(Ie,Math.max(Be,n.value*h));e.value.x=c-(c-e.value.x)*(d/n.value),e.value.y=l-(l-e.value.y)*(d/n.value),n.value=d,a()},a=()=>{const r=W(t);r.resetTransform(),r.translate(e.value.x,e.value.y),r.scale(n.value,n.value)};return lt(()=>{const r=t.value;if(!r)throw new Error("Canvas ref is not defined");r.addEventListener("wheel",o,{passive:!1})}),ht(()=>{const r=t.value;r&&r.removeEventListener("wheel",o)}),{scale:n,origin:e}}const Pe=t=>{const n=N("pan-zoom-scale",0),e=N("pan-zoom-pan-x",0),o=N("pan-zoom-pan-y",0),a=()=>{const s=W(t),{a:i,e:c,f:l}=s.getTransform();n.value=i,e.value=c,o.value=l},r=()=>{W(t)};return lt(()=>{t.value&&(t.value.addEventListener("wheel",a),t.value.addEventListener("mousedown",a),t.value.addEventListener("mouseup",a),setTimeout(()=>r(),0))}),ht(()=>{t.value&&(t.value.removeEventListener("wheel",a),t.value.removeEventListener("mousedown",a),t.value.removeEventListener("mouseup",a))}),{track:a,apply:r,scale:n,panX:e,panY:o}},ze=["width","height"],Re=["width","height"],Oe=kt({__name:"ResponsiveCanvas",props:{color:{},patternColor:{},canvasWidth:{},canvasHeight:{}},emits:["canvasRef","widthChange","heightChange"],setup(t,{emit:n}){const e=H(0),o=H(0),a=H(!0),r=H(),s=H(),i=t,c=R(()=>(i==null?void 0:i.canvasWidth)??5e3),l=R(()=>(i==null?void 0:i.canvasHeight)??3e3),h=n,d=["w-full","h-full","relative","overflow-auto"],x=Le(),g=R(()=>[...d,...x.value]),f=w=>{r.value=w,h("canvasRef",w)},u=H(),{height:A,width:$}=_t(u),p=()=>{e.value=c.value,o.value=l.value},z=async()=>u.value??new Promise(w=>{const b=setInterval(()=>{u.value&&(clearInterval(b),w(u.value))},100)}),F=async()=>new Promise(w=>{const b=setInterval(()=>{s.value&&(w(W(s.value)),clearInterval(b))},100)}),m=async()=>{const w=await F();w.clearRect(0,0,e.value,o.value);const b=75,T=(L,S)=>{Ct({at:{x:L,y:S},size:2,color:i.patternColor}).draw(w)},pt=e.value,Lt=o.value;for(let L=b/2;L<pt;L+=b)for(let S=b/2;S<Lt;S+=b)T(L,S)},v=Se(m,250);(async()=>{m();const w=await z(),b=o.value/2-w.clientHeight/2;w.scrollTop=b;const T=e.value/2-w.clientWidth/2;w.scrollLeft=T,a.value=!1})(),B(A,()=>{p(),m(),h("widthChange",e.value)}),B($,()=>{p(),m(),h("heightChange",o.value)}),B([c,l],()=>{p(),m(),h("widthChange",e.value),h("heightChange",o.value)}),B(()=>i.patternColor,m),Ot({canvasWidth:e,canvasHeight:o,getParentEl:z});const nt=We(r);return Pe(r),B(nt.scale,()=>{const{scale:w,origin:b}=nt,T=W(s.value);T.clearRect(0,0,e.value,o.value),T.resetTransform(),T.translate(b.value.x,b.value.y),T.scale(w.value,w.value),v()}),(w,b)=>(st(),ot("div",{ref_key:"parentEl",ref:u,class:Z(g.value),id:"responsive-canvas-container"},[a.value?(st(),ot("div",{key:0,style:at({backgroundColor:w.color}),class:"absolute top-0 left-0 w-full h-full"},null,4)):Ut("",!0),rt("canvas",{ref:f,width:e.value,height:o.value,class:Z([`w-[${e.value}px]`,`h-[${o.value}px]`]),id:"responsive-canvas"},null,10,ze),rt("canvas",{ref_key:"bgCanvas",ref:s,width:e.value,height:o.value,style:at({backgroundColor:w.color}),class:Z([`w-[${e.value}px]`,`h-[${o.value}px]`,"absolute","top-0","-z-10","pointer-events-none"])},null,14,Re)],2))}});export{Oe as _,Ee as a,Ce as b,Te as c,Se as d,me as e,W as g,Ae as l,He as r,_e as s,Le as u};
