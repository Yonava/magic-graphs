import{L as z,d as X,u as H,b as Y,_ as Z}from"./Graph.vue_vue_type_script_setup_true_lang-Nyy1gMg2.js";import{c as S,i as q}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-BF8QVsLo.js";import{f as _,d as $,G as A,o as b,c as I,B as C,w as h,K as L,z as v,y as G,A as y,s as J,v as Q,a as B,t as ee,e as R}from"./index-fWF74cCw.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-B-rXJPQE.js";import{g as te}from"./useAdjacencyList-DECrt7DZ.js";import{_ as se}from"./SimulationPlaybackControls.vue_vue_type_script_setup_true_lang-Df9skD6K.js";import{b as oe}from"./CollabControls.vue_vue_type_script_setup_true_lang-DEfZVpKy.js";const F="S",x="T",ne=z.filter(e=>e!==F&&e!==x),O=e=>X(e.nodes,ne),le=e=>{const{setTheme:r}=H(e,"flow"),l=O(e),c=t=>i=>{const{offsetX:m,offsetY:E}=i,g=e.getNodeByCoordinates(m,E);g&&t(g)},s=async()=>{e.settings.value.userEditable=!1,e.settings.value.focusable=!1;let t;const i=await new Promise(m=>{t=c(m),e.subscribe("onClick",t)});return t&&e.unsubscribe("onClick",t),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,i},d=_(!1),o=async()=>{d.value=!0;const t=await s();e.nodes.value.forEach(i=>{i.label===F&&(i.label=l())}),t.label=F,e.trackGraphState(),d.value=!1},a=_(!1),n=async()=>{a.value=!0;const t=await s();e.nodes.value.forEach(i=>{i.label===x&&(i.label=l())}),t.label=x,e.trackGraphState(),a.value=!1},u=t=>{if(e.isFocused(t.id))return;const i=t.label===F,m=t.label===x;if(i)return S.BLUE_600;if(m)return S.RED_600};return r("nodeBorderColor",u),r("nodeAnchorColor",u),{makeSource:o,makeSink:n,makingSource:d,makingSink:a}},ae={class:"flex gap-3"},ie={key:2,class:"flex gap-3"},re=$({__name:"SourceSinkControls",props:{simControls:{},controls:{}},setup(e){const r=e,l=A(()=>r.simControls.isActive.value);return(c,s)=>(b(),I("div",ae,[l.value?(b(),C(N,{key:1,style:L({backgroundColor:v(S).RED_600,color:v(S).WHITE}),onClick:c.simControls.stop},{default:h(()=>s[1]||(s[1]=[y(" Stop Simulation ")])),_:1},8,["style","onClick"])):(b(),C(N,{key:0,style:L({backgroundColor:v(S).BLUE_500,color:v(S).WHITE}),onClick:c.simControls.start},{default:h(()=>s[0]||(s[0]=[y(" Run Flow Simulation ")])),_:1},8,["style","onClick"])),l.value?G("",!0):(b(),I("div",ie,[c.controls.makingSource.value?(b(),C(N,{key:1,style:L({backgroundColor:v(S).RED_500,color:v(S).WHITE})},{default:h(()=>s[3]||(s[3]=[y(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:0,onClick:c.controls.makeSource},{default:h(()=>s[2]||(s[2]=[y(" Switch Source ")])),_:1},8,["onClick"])),c.controls.makingSink.value?(b(),C(N,{key:3,style:L({backgroundColor:v(S).RED_500,color:v(S).WHITE})},{default:h(()=>s[5]||(s[5]=[y(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:2,onClick:c.controls.makeSink},{default:h(()=>s[4]||(s[4]=[y(" Switch Sink ")])),_:1},8,["onClick"]))]))]))}}),ce="edge-thickener",W=5,M=25,ue=3,de=e=>{const{setTheme:r,removeAllThemes:l}=H(e,ce),c=o=>{const a=Number(o.label);if(isNaN(a))return;if(a===0)return ue;const u=(a*2-W)/(M-W),t=Math.min(1,Math.max(0,u));return(M-W)*t+W},s=()=>r("edgeWidth",c),d=()=>l();return J(d),s(),{activate:s,deactivate:d}},fe={persistent:!0,persistentStorageKey:"network-flow",userAddedEdgeLabel:"5",userAddedEdgeRuleNoSelfLoops:!0,userAddedEdgeRuleOneEdgePerPath:!0,edgeInputToLabel:e=>{const r=Number(e);return!isNaN(r)&&r>=0&&r<100?e:void 0}},ve=(e,r,l)=>{const c=e.edges.value.reduce((n,u)=>(n[u.id]=Number(u.label),n),{}),s=[],d=te(e),o=(n,u,t=void 0,i=void 0)=>{if(i===void 0&&(i=[]),t===void 0&&(t=new Set),t.add(n),i.push(n),n===u)return i;const m=d[n];for(const E of m){const g=e.edges.value.find(f=>f.from===n&&f.to===E);if(!g)throw"the adj list must be wrong! 1";if(c[g.id]>0&&!t.has(E)){const f=o(E,u,t,[...i]);if(f)return f}}};return{maxFlow:(()=>{let n=0,u=o(r,l);for(;u;){let t=1/0;for(let i=0;i<u.length-1;i++){const m=u[i],E=u[i+1],g=e.edges.value.find(f=>f.from===m&&f.to===E);if(!g)throw"the adj list must be wrong! 2";const k=c[g.id];t=Math.min(t,k)}for(let i=0;i<u.length-1;i++){const m=u[i],E=u[i+1],g=e.edges.value.find(f=>f.from===m&&f.to===E),k=e.edges.value.find(f=>f.from===E&&f.to===m);if(!g||!k)throw"the adj list must be wrong! 3";c[g.id]-=t,c[k.id]+=t,s.push({[g.id]:c[g.id],[k.id]:c[k.id]})}n+=t,u=o(r,l)}return n})(),trace:s}},T="residual",V=e=>{const r=o=>o.startsWith(T),l=o=>o.split("-")[1],c=o=>`${T}-${o}`;return{cleanupResidualEdges:()=>{for(const o of e.edges.value){if(!r(o.id))continue;const a=l(o.id),n=e.getEdge(a);if(!n)throw"big oopsie";const u=Number(n.label),t=Number(o.label);n.label=(u+t).toString()}e.edges.value=e.edges.value.filter(o=>!o.id.startsWith(T))},createResidualEdges:()=>{if(e.edges.value.some(n=>n.id.startsWith(T)))return;const a=e.edges.value.map(n=>({...n,to:n.from,from:n.to,label:"0",id:c(n.id)}));e.edges.value.push(...a)},isResidual:r,getIdFromResidual:l,getResidualId:c}},K=e=>{const r=_([]),l=_(0),{createResidualEdges:c,cleanupResidualEdges:s}=V(e),d=()=>{const o=e.nodes.value.find(t=>t.label===F),a=e.nodes.value.find(t=>t.label===x);if(!o||!a)return r.value=[];c();const{maxFlow:n,trace:u}=ve(e,o.id,a.id);r.value=u,l.value=n,s()};return e.subscribe("onEdgeLabelChange",d),e.subscribe("onStructureChange",d),e.subscribe("onGraphReset",d),{maxFlow:l,trace:r,update:d}},ge=e=>{const{maxFlow:r}=K(e);return{maxFlow:Q(r)}},me={class:"flex gap-3"},Ee={class:"font-bold text-xl"},be=$({__name:"NetworkFlowStats",props:{graph:{}},setup(e){const r=e,{maxFlow:l}=ge(r.graph);return(c,s)=>(b(),I("div",me,[B("span",Ee,"Max Flow: "+ee(v(l)??"N/A"),1)]))}}),Se=e=>{const{setTheme:r}=H(e,"flow"),{createResidualEdges:l,cleanupResidualEdges:c}=V(e),{trace:s}=K(e),d=_(!1),o=_([]),a=_(0),n=_(null),u=_(!1),t=_(1500),i=A(()=>a.value===s.value.length),m=A(()=>a.value>-1),E=()=>{u.value||i.value||f()},g=()=>{a.value=-1,e.settings.value.userEditable=!1,e.settings.value.focusable=!1,d.value=!0,u.value=!1,l(),n.value=setInterval(E,t.value)},k=()=>{c(),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,o.value=[],d.value=!1,n.value&&clearInterval(n.value)},f=()=>{if(a.value===s.value.length)return;if(a.value++,a.value===s.value.length){o.value=[];return}const p=s.value[a.value];o.value=Object.keys(p);const[w,j]=o.value,U=e.getEdge(w),D=e.getEdge(j);if(!U||!D)throw"this is all wrong!";U.label=p[w].toString(),D.label=p[j].toString()},P=()=>{if(a.value<-1)return;if(a.value--,a.value===-1){o.value=[];return}const p=a.value;k(),g();for(let w=0;w<p+1;w++)f()};return r("edgeColor",p=>{if(o.value.includes(p.id))return q(e.theme.value.edgeFocusColor,p);if(p.id.startsWith(T))return S.ORANGE_400}),{nextStep:f,prevStep:P,setStep:()=>{throw"setStep not implemented"},trace:A(()=>s.value),step:A(()=>a.value),start:g,stop:k,paused:u,playbackSpeed:t,isOver:i,hasBegun:m,isActive:A(()=>d.value)}},_e={class:"w-full h-full relative"},ke={class:"absolute w-full h-full"},pe={class:"absolute top-0 p-3"},we={class:"absolute top-0 right-0 p-3 text-white flex gap-3"},Ce={key:0,class:"absolute bottom-8 w-full flex justify-center items-center p-3"},he={key:1,class:"absolute right-0 p-3 h-14 flex gap-3 bottom-0"},Le=$({__name:"Main",setup(e){const r=_(),l=Y(r,{settings:fe});l.settings.value.newNodeLabelGetter=O(l),de(l);const c=le(l),s=Se(l);return(d,o)=>(b(),I("div",_e,[B("div",ke,[R(Z,{onGraphRef:o[0]||(o[0]=a=>r.value=a),graph:v(l)},null,8,["graph"])]),B("div",pe,[R(re,{controls:v(c),"sim-controls":v(s)},null,8,["controls","sim-controls"])]),B("div",we,[R(be,{graph:v(l)},null,8,["graph"])]),v(s).isActive.value?(b(),I("div",Ce,[R(se,{controls:v(s)},null,8,["controls"])])):G("",!0),v(s).isActive.value?G("",!0):(b(),I("div",he,[R(oe,{graph:v(l)},null,8,["graph"])]))]))}});export{Le as default};
