import{L as X,d as z,u as G,b as Y,_ as Z}from"./Graph.vue_vue_type_script_setup_true_lang-CTaBmmpA.js";import{c as _,i as q}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-p2bUJyZt.js";import{f as S,d as $,s as A,o as b,c as I,D as C,w as y,v as L,B as m,A as H,C as h,x as J,y as Q,a as B,t as ee,e as T}from"./index-BwD5cFD_.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-A9vCViIy.js";import{g as te}from"./useAdjacencyList-BVmHohm5.js";import{_ as se}from"./SimulationPlaybackControls.vue_vue_type_script_setup_true_lang-DbxcVvUH.js";import{b as oe}from"./CollabControls.vue_vue_type_script_setup_true_lang-DFHh9ZL5.js";const x="S",F="T",ne=X.filter(e=>e!==x&&e!==F),M=e=>z(e.nodes,ne),le=e=>{const{setTheme:r}=G(e,"flow"),a=M(e);e.subscribe("onEdgeAdded",t=>{if(t.to===t.from||e.edges.value.some(v=>v.from===t.to&&v.to===t.from))return e.removeEdge(t.id)});const u=t=>l=>{const{offsetX:v,offsetY:E}=l,g=e.getNodeByCoordinates(v,E);g&&t(g)},s=async()=>{e.settings.value.userEditable=!1,e.settings.value.focusable=!1;let t;const l=await new Promise(v=>{t=u(v),e.subscribe("onClick",t)});return t&&e.unsubscribe("onClick",t),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,l},d=S(!1),o=async()=>{d.value=!0;const t=await s();e.nodes.value.forEach(l=>{l.label===x&&(l.label=a())}),t.label=x,e.trackGraphState(),d.value=!1},i=S(!1),n=async()=>{i.value=!0;const t=await s();e.nodes.value.forEach(l=>{l.label===F&&(l.label=a())}),t.label=F,e.trackGraphState(),i.value=!1},c=t=>{if(e.isHighlighted(t.id))return;const l=t.label===x,v=t.label===F;if(l)return _.BLUE_600;if(v)return _.RED_600};return r("nodeBorderColor",c),r("nodeAnchorColor",c),{makeSource:o,makeSink:n,makingSource:d,makingSink:i}},ae={class:"flex gap-3"},ie={key:2,class:"flex gap-3"},re=$({__name:"SourceSinkControls",props:{simControls:{},controls:{}},setup(e){const r=e,a=A(()=>r.simControls.isActive.value);return(u,s)=>(b(),I("div",ae,[a.value?(b(),C(N,{key:1,style:L({backgroundColor:m(_).RED_600,color:m(_).WHITE}),onClick:u.simControls.stop},{default:y(()=>s[1]||(s[1]=[h(" Stop Simulation ")])),_:1},8,["style","onClick"])):(b(),C(N,{key:0,style:L({backgroundColor:m(_).BLUE_500,color:m(_).WHITE}),onClick:u.simControls.start},{default:y(()=>s[0]||(s[0]=[h(" Run Flow Simulation ")])),_:1},8,["style","onClick"])),a.value?H("",!0):(b(),I("div",ie,[u.controls.makingSource.value?(b(),C(N,{key:1,style:L({backgroundColor:m(_).RED_500,color:m(_).WHITE})},{default:y(()=>s[3]||(s[3]=[h(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:0,onClick:u.controls.makeSource},{default:y(()=>s[2]||(s[2]=[h(" Switch Source ")])),_:1},8,["onClick"])),u.controls.makingSink.value?(b(),C(N,{key:3,style:L({backgroundColor:m(_).RED_500,color:m(_).WHITE})},{default:y(()=>s[5]||(s[5]=[h(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:2,onClick:u.controls.makeSink},{default:y(()=>s[4]||(s[4]=[h(" Switch Sink ")])),_:1},8,["onClick"]))]))]))}}),ue="edge-thickener",W=5,U=25,ce=3,de=e=>{const{setTheme:r,removeAllThemes:a}=G(e,ue),u=o=>{const i=Number(o.label);if(isNaN(i))return;if(i===0)return ce;const c=(i*2-W)/(U-W),t=Math.min(1,Math.max(0,c));return(U-W)*t+W},s=()=>r("edgeWidth",u),d=()=>a();return J(d),s(),{activate:s,deactivate:d}},fe={persistent:!0,persistentStorageKey:"network-flow",userEditableAddedEdgeLabel:"5",edgeInputToLabel:e=>{const r=Number(e);return!isNaN(r)&&r>=0&&r<100?e:void 0}},ve=(e,r,a)=>{const u=e.edges.value.reduce((n,c)=>(n[c.id]=Number(c.label),n),{}),s=[],d=te(e),o=(n,c,t=void 0,l=void 0)=>{if(l===void 0&&(l=[]),t===void 0&&(t=new Set),t.add(n),l.push(n),n===c)return l;const v=d[n];for(const E of v){const g=e.edges.value.find(f=>f.from===n&&f.to===E);if(!g)throw"the adj list must be wrong! 1";if(u[g.id]>0&&!t.has(E)){const f=o(E,c,t,[...l]);if(f)return f}}};return{maxFlow:(()=>{let n=0,c=o(r,a);for(;c;){let t=1/0;for(let l=0;l<c.length-1;l++){const v=c[l],E=c[l+1],g=e.edges.value.find(f=>f.from===v&&f.to===E);if(!g)throw"the adj list must be wrong! 2";const k=u[g.id];t=Math.min(t,k)}for(let l=0;l<c.length-1;l++){const v=c[l],E=c[l+1],g=e.edges.value.find(f=>f.from===v&&f.to===E),k=e.edges.value.find(f=>f.from===E&&f.to===v);if(!g||!k)throw"the adj list must be wrong! 3";u[g.id]-=t,u[k.id]+=t,s.push({[g.id]:u[g.id],[k.id]:u[k.id]})}n+=t,c=o(r,a)}return n})(),trace:s}},R="residual",V=e=>{const r=o=>o.startsWith(R),a=o=>o.split("-")[1],u=o=>`${R}-${o}`;return{cleanupResidualEdges:()=>{for(const o of e.edges.value){if(!r(o.id))continue;const i=a(o.id),n=e.getEdge(i);if(!n)throw"big oopsie";const c=Number(n.label),t=Number(o.label);n.label=(c+t).toString()}e.edges.value=e.edges.value.filter(o=>!o.id.startsWith(R))},createResidualEdges:()=>{if(e.edges.value.some(n=>n.id.startsWith(R)))return;const i=e.edges.value.map(n=>({...n,to:n.from,from:n.to,label:"0",id:u(n.id)}));e.edges.value.push(...i)},isResidual:r,getIdFromResidual:a,getResidualId:u}},P=e=>{const r=S([]),a=S(0),{createResidualEdges:u,cleanupResidualEdges:s}=V(e),d=()=>{const o=e.nodes.value.find(t=>t.label===x),i=e.nodes.value.find(t=>t.label===F);if(!o||!i)return r.value=[];u();const{maxFlow:n,trace:c}=ve(e,o.id,i.id);r.value=c,a.value=n,s()};return e.subscribe("onEdgeLabelChange",d),e.subscribe("onStructureChange",d),e.subscribe("onGraphReset",d),{maxFlow:a,trace:r,update:d}},me=e=>{const{maxFlow:r}=P(e);return{maxFlow:Q(r)}},ge={class:"flex gap-3"},Ee={class:"font-bold text-xl"},be=$({__name:"NetworkFlowStats",props:{graph:{}},setup(e){const r=e,{maxFlow:a}=me(r.graph);return(u,s)=>(b(),I("div",ge,[B("span",Ee,"Max Flow: "+ee(m(a)??"N/A"),1)]))}}),_e=e=>{const{setTheme:r}=G(e,"flow"),{createResidualEdges:a,cleanupResidualEdges:u}=V(e),{trace:s}=P(e),d=S(!1),o=S([]),i=S(0),n=S(null),c=S(!1),t=S(1500),l=A(()=>i.value===s.value.length),v=A(()=>i.value>-1),E=()=>{c.value||l.value||f()},g=()=>{i.value=-1,e.settings.value.userEditable=!1,e.settings.value.focusable=!1,d.value=!0,c.value=!1,a(),n.value=setInterval(E,t.value),e.repaint("flow-simulation/start-simulation")()},k=()=>{u(),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,o.value=[],d.value=!1,n.value&&clearInterval(n.value),e.repaint("flow-simulation/stop-simulation")()},f=()=>{if(i.value===s.value.length)return;if(i.value++,i.value===s.value.length){o.value=[],e.repaint("flow-simulation/next-step")();return}const w=s.value[i.value];o.value=Object.keys(w);const[p,j]=o.value,D=e.getEdge(p),O=e.getEdge(j);if(!D||!O)throw"this is all wrong!";D.label=w[p].toString(),O.label=w[j].toString(),e.repaint("flow-simulation/next-step")()},K=()=>{if(i.value<-1)return;if(i.value--,i.value===-1){o.value=[],e.repaint("flow-simulation/prev-step")();return}const w=i.value;k(),g();for(let p=0;p<w+1;p++)f()};return r("edgeColor",w=>{if(o.value.includes(w.id))return q(e.theme.value.edgeFocusColor,w);if(w.id.startsWith(R))return _.ORANGE_400}),{nextStep:f,prevStep:K,setStep:()=>{throw"setStep not implemented"},trace:A(()=>s.value),step:A(()=>i.value),start:g,stop:k,paused:c,playbackSpeed:t,isOver:l,hasBegun:v,isActive:A(()=>d.value)}},Se={class:"w-full h-full relative"},ke={class:"absolute w-full h-full"},we={class:"absolute top-0 p-3"},pe={class:"absolute top-0 right-0 p-3 text-white flex gap-3"},Ce={key:0,class:"absolute bottom-8 w-full flex justify-center items-center p-3"},ye={key:1,class:"absolute right-0 p-3 h-14 flex gap-3 bottom-0"},Le=$({__name:"Main",setup(e){const r=S(),a=Y(r,{settings:fe});a.settings.value.newNodeLabelGetter=M(a),de(a);const u=le(a),s=_e(a);return(d,o)=>(b(),I("div",Se,[B("div",ke,[T(Z,{onGraphRef:o[0]||(o[0]=i=>r.value=i),graph:m(a)},null,8,["graph"])]),B("div",we,[T(re,{controls:m(u),"sim-controls":m(s)},null,8,["controls","sim-controls"])]),B("div",pe,[T(be,{graph:m(a)},null,8,["graph"])]),m(s).isActive.value?(b(),I("div",Ce,[T(se,{controls:m(s)},null,8,["controls"])])):H("",!0),m(s).isActive.value?H("",!0):(b(),I("div",ye,[T(oe,{graph:m(a)},null,8,["graph"])]))]))}});export{Le as default};
