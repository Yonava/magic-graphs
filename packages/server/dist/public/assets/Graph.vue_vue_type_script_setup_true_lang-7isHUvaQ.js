import{S as xe,N as we,z as q,b1 as X,b2 as ve,b3 as Ie,b4 as Be,b5 as Me,b6 as De,b7 as ge,b8 as Re,b9 as _e,v as y,ba as ke,G as R,g as I,y as ee,a8 as V,bb as Le,al as Fe,am as Pe,bc as Oe,bd as be,u as he,A as Q,be as Ue,x as Ge,d as We,B as He,o as Ke}from"./index-BauKbB-4.js";import{c as me,a as qe,b as ze,l as ye,e as Ye,g as Se,r as ne,s as j,_ as je}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-CO0BbGB8.js";const Ve="auto",Je=e=>{const o=xe(),t=we("preferred-theme",Ve);return q(o,()=>{t.value==="auto"&&(e.themeName.value=o.value?"dark":"light")},{immediate:!0}),q(t,()=>{t.value==="auto"?e.themeName.value=o.value?"dark":"light":e.themeName.value=t.value},{immediate:!0}),{preferredTheme:t}},Ze=e=>({getConnectedNodes:o=>X(o,e),getConnectedEdges:o=>ve(o,e),getInboundEdges:o=>Ie(o,e),getOutboundEdges:o=>Be(o,e),isEdgeFlowingIntoNode:(o,t)=>Me(o,t,e),isEdgeFlowingOutOfNode:(o,t)=>De(o,t,e),getEdgesAlongPath:(o,t)=>ge(o,t,e),getEdgeWeight:o=>Re(o,e),getWeightBetweenNodes:(o,t)=>_e(o,t,e)}),Xe=(e,o)=>{const t=o("nodeColor",e),u=o("nodeBorderColor",e),r=o("nodeSize",e),s=o("nodeBorderWidth",e),v=o("nodeText",e),d=o("nodeTextSize",e),i=o("nodeTextColor",e),l=o("nodeShape",e),m=me({at:{x:e.x,y:e.y},radius:r,color:t,stroke:{color:u,width:s},textArea:{text:{content:v,fontSize:d,fontWeight:"bold",color:i},color:y.TRANSPARENT}}),T=qe({at:{x:e.x-r,y:e.y-r},size:r*2,color:t,stroke:{color:u,width:s},textArea:{text:{content:v,fontSize:d,fontWeight:"bold",color:i},color:y.TRANSPARENT}});return{shape:l==="circle"?m:T,id:e.id,graphType:"node"}},Qe=1.618,se=2,$e=(e,o)=>{const{displayEdgeLabels:t,isGraphDirected:u}=o.settings.value,[r,s]=X(e.id,o),d=ge(r.id,s.id,o).length>1,i=s===r,l=o.getTheme("nodeBorderWidth",r),m=o.getTheme("nodeBorderWidth",s),T=o.getTheme("nodeSize",r),n=o.getTheme("nodeSize",s),a=Math.atan2(s.y-r.y,s.x-r.x),A=m/2+se,w={x:(n+A)*Math.cos(a),y:(n+A)*Math.sin(a)},N={x:r.x,y:r.y},g={x:s.x-(u?w.x:0),y:s.y-(u?w.y:0)},f=o.getTheme("edgeWidth",e),h=f*1.2;d&&(N.x+=Math.cos(a+Math.PI/2)*h,N.y+=Math.sin(a+Math.PI/2)*h,g.x+=Math.cos(a+Math.PI/2)*h,g.y+=Math.sin(a+Math.PI/2)*h);const c=ke(N,o.edges.value.filter(L=>(L.from===r.id||L.to===s.id)&&L.from!==L.to).map(L=>{const[W,K]=X(L.id,o);return r.id===W.id?{x:K.x,y:K.y}:{x:W.x,y:W.y}}).filter((L,W,K)=>W===K.findIndex(U=>U.x===L.x&&U.y===L.y))),b=o.getTheme("edgeColor",e),E=o.getTheme("edgeTextColor",e),x=o.getTheme("graphBgColor"),B=o.getTheme("edgeText",e),S=o.getTheme("edgeTextSize",e),C=o.getTheme("edgeTextFontWeight",e),_=t?{color:x,activeColor:x,text:{content:B,color:E,fontSize:S,fontWeight:C}}:void 0,k=(T+l)*Qe,P=k-(T+l/2)-se;if(i)return{shape:ze({spacing:f*1.2,at:{x:r.x,y:r.y},upDistance:k,downDistance:P,rotation:c,lineWidth:f,color:b,textArea:_}),id:e.id,graphType:"edge"};const G=T+l/2+n+m/2,O=(r.x-s.x)**2+(r.y-s.y)**2;return G**2>O?void 0:u?{shape:Ye({start:N,end:g,width:f,textOffsetFromCenter:(T+l/2)/2,color:b,textArea:_}),id:e.id,graphType:"edge"}:{shape:ye({start:N,end:g,width:f,color:b,textArea:_}),id:e.id,graphType:"edge"}},oe={nodeShape:"circle",nodeSize:35,nodeBorderWidth:8,nodeTextSize:24,nodeAnchorRadius:Math.ceil(Math.sqrt(35)*2),edgeWidth:10,edgeTextSize:20,nodeText:({label:e})=>e,edgeText:({label:e})=>e,edgeTextFontWeight:"bold",linkPreviewWidth:10},eo="rgb(100, 60, 70)",oo={nodeBorderColor:y.BLACK,nodeColor:y.STONE_600,nodeTextColor:y.WHITE,nodeFocusBorderColor:y.RED_700,nodeFocusColor:eo,nodeFocusTextColor:y.WHITE,edgeColor:y.STONE_900,edgeFocusColor:y.RED_700,edgeFocusTextColor:y.WHITE,edgeTextColor:y.WHITE,graphBgColor:y.GRAY_600,graphBgPatternColor:y.WHITE+"15",nodeAnchorColorWhenParentFocused:y.RED_800,nodeAnchorColor:y.GRAY_900,linkPreviewColor:y.BLACK,marqueeSelectionBoxColor:y.WHITE+"15",marqueeSelectionBoxBorderColor:y.WHITE,marqueeEncapsulatedNodeBoxBorderColor:y.RED_700,marqueeEncapsulatedNodeBoxColor:y.RED_700+"20",...oe},to={nodeColor:y.GRAY_50,nodeBorderColor:y.GRAY_800,nodeFocusBorderColor:y.BLUE_600,nodeFocusColor:y.BLUE_100,nodeTextColor:y.GRAY_900,nodeFocusTextColor:y.GRAY_900,edgeColor:y.GRAY_800,edgeTextColor:y.GRAY_900,edgeFocusColor:y.BLUE_600,edgeFocusTextColor:y.BLACK,graphBgColor:y.GRAY_200,graphBgPatternColor:y.BLACK+"15",nodeAnchorColor:y.BLACK,nodeAnchorColorWhenParentFocused:y.BLUE_900,linkPreviewColor:y.BLACK,marqueeSelectionBoxColor:y.BLUE_300+"15",marqueeSelectionBoxBorderColor:y.BLUE_500,marqueeEncapsulatedNodeBoxBorderColor:y.BLUE_700,marqueeEncapsulatedNodeBoxColor:y.BLUE_700+"05",...oe},no={nodeColor:y.PINK_100,nodeBorderColor:y.PINK_400,nodeFocusBorderColor:y.PURPLE_600,nodeFocusColor:y.PURPLE_200,nodeTextColor:y.PINK_600,nodeFocusTextColor:y.PURPLE_900,edgeColor:y.PINK_600,edgeTextColor:y.PINK_600,edgeFocusColor:y.PURPLE_600,edgeFocusTextColor:y.PURPLE_600,graphBgColor:y.PINK_300,graphBgPatternColor:y.WHITE+"50",nodeAnchorColor:y.PINK_500,nodeAnchorColorWhenParentFocused:y.PURPLE_700,linkPreviewColor:y.PINK_900,marqueeSelectionBoxColor:y.PINK_300+"15",marqueeSelectionBoxBorderColor:y.PINK_500,marqueeEncapsulatedNodeBoxBorderColor:y.PINK_700,marqueeEncapsulatedNodeBoxColor:y.PINK_700+"05",...oe},Ee={light:to,dark:oo,girl:no},so=()=>({nodeSize:[],nodeBorderWidth:[],nodeColor:[],nodeBorderColor:[],nodeFocusColor:[],nodeFocusBorderColor:[],nodeText:[],nodeFocusTextColor:[],nodeTextSize:[],nodeTextColor:[],nodeShape:[],edgeColor:[],edgeWidth:[],edgeText:[],edgeTextSize:[],edgeTextColor:[],edgeFocusTextColor:[],edgeTextFontWeight:[],edgeFocusColor:[],graphBgColor:[],graphBgPatternColor:[],nodeAnchorRadius:[],nodeAnchorColor:[],nodeAnchorColorWhenParentFocused:[],linkPreviewColor:[],linkPreviewWidth:[],marqueeSelectionBoxColor:[],marqueeSelectionBoxBorderColor:[],marqueeEncapsulatedNodeBoxColor:[],marqueeEncapsulatedNodeBoxBorderColor:[]}),ro=e=>Object.prototype.toString.call(e)==="[object Object]",Te=(e,o)=>{const t={};if(!e)return o;if(!o)return null;const u=Object.keys(e),r=Object.keys(o);for(const s of r)u.includes(s)||(t[s]=o[s]);for(const s of u){if(ro(e[s])){const v=Te(e[s],o[s]);v&&(t[s]=v);continue}if(Array.isArray(e[s])){JSON.stringify(e[s])!==JSON.stringify(o[s])&&(t[s]=o[s]);continue}else e[s]!==o[s]&&(t[s]=o[s])}return Object.keys(t).length?t:null},$=e=>{const o={...e};for(const t in o)typeof o[t]=="object"&&(o[t]=$(o[t]));return o},ao=e=>({subscribe:(o,t)=>e[o].add(t),unsubscribe:(o,t)=>e[o].delete(t),emit:(o,...t)=>{for(const u of e[o])u(...t)}}),uo=()=>({onStructureChange:new Set,onNodeAdded:new Set,onBulkNodeAdded:new Set,onNodeRemoved:new Set,onBulkNodeRemoved:new Set,onNodeMoved:new Set,onBulkNodeMoved:new Set,onEdgeAdded:new Set,onBulkEdgeAdded:new Set,onEdgeRemoved:new Set,onBulkEdgeRemoved:new Set,onEdgeLabelEdited:new Set,onRepaint:new Set,onNodeHoverChange:new Set,onGraphLoaded:new Set,onGraphReset:new Set,onClick:new Set,onMouseDown:new Set,onMouseUp:new Set,onMouseMove:new Set,onDblClick:new Set,onContextMenu:new Set,onKeyDown:new Set,onKeyUp:new Set,onThemeChange:new Set,onSettingsChange:new Set,onUndo:new Set,onRedo:new Set,onFocusChange:new Set,onNodeDragStart:new Set,onNodeDrop:new Set,onNodeAnchorDragStart:new Set,onNodeAnchorDrop:new Set,onGroupDragStart:new Set,onGroupDrop:new Set}),re=e=>e==null,co=e=>{const o=e.trim().split("/").filter(Boolean);if(o.length!==2)return!1;const[t,u]=o.map(Number);return!(re(t)||re(u))},io=e=>{if(!co(e))return;const o=e.split("/"),[t,u]=o.map(Number);return t/u},lo={displayEdgeLabels:!0,edgeLabelsEditable:!0,edgeInputToLabel:e=>{var u;const o=e.trim();if(!o)return;const t=(u=io(o))==null?void 0:u.toFixed(2);return t==="Infinity"?"∞":t==="-Infinity"?"-∞":t===void 0&&isNaN(Number(o))?void 0:t??o},newNodeLabelGetter:null,isGraphDirected:!0},fo={focusable:!0,focusBlacklist:[]},vo={draggable:!0},go={nodeAnchors:!0},bo={marquee:!0,marqueeSelectableGraphTypes:["node","edge"]},ho={interactive:!0,userAddedEdgeLabel:"1",userAddedEdgeRuleNoSelfLoops:!1,userAddedEdgeRuleOneEdgePerPath:!1},mo={persistent:!0,persistentStorageKey:"graph",persistentBlacklist:new Set},yo={shortcuts:!0,shortcutUndo:!0,shortcutRedo:!0,shortcutSelectAll:!0,shortcutDelete:!0,shortcutEscape:!0},So={...lo,...fo,...vo,...go,...bo,...ho,...mo,...yo},ae=(e,...o)=>typeof e=="function"?e(...o):e,Eo=(e,o)=>(t,...u)=>{const r=o[t].findLast(v=>{const d=v.value;return ae(d,...u)!==void 0}),s=(r==null?void 0:r.value)??Ee[e.value][t];if(!s)throw new Error(`Theme property "${t}" not found`);return ae(s,...u)},To=(e,o)=>{const t=R(()=>{const r=new Map;for(const s of e.value)r.set(s.id,s);return r}),u=R(()=>{const r=new Map;for(const s of o.value)r.set(s.id,s);return r});return{nodeIdToNodeMap:t,edgeIdToEdgeMap:u}},po=({canvas:e,emit:o})=>{const t=I([]),u=[],r=()=>{var n,a,A,w;if(!e.value)return;const d=e.value.getContext("2d");if(!d)return;d.clearRect(0,0,e.value.width,e.value.height);const i=u.reduce((N,g)=>g(N),[]);t.value=[...i.sort((N,g)=>N.priority-g.priority)];const l=t.value.findLastIndex(N=>N.graphType==="edge"),m=t.value.slice(0,l+1),T=t.value.slice(l+1);for(const N of m)N.shape.drawShape(d);for(const N of m)(a=(n=N.shape).drawTextAreaMatte)==null||a.call(n,d);for(const N of m)(w=(A=N.shape).drawText)==null||w.call(A,d);for(const N of T)N.shape.draw(d);o("onRepaint",d,"loop")},s=setInterval(r,1e3/60);return ee(()=>{clearInterval(s)}),setTimeout(r,1e3),{aggregator:t,updateAggregator:u,getSchemaItemsByCoordinates:d=>t.value.sort((i,l)=>i.priority-l.priority).filter(i=>{var l,m;return i.shape.shapeHitbox(d)||((m=(l=i.shape).textHitbox)==null?void 0:m.call(l,d))})}},Ao={broadcast:!0,focus:!0,history:!0},Co={broadcast:!0,focus:!1,history:!0},ue={broadcast:!0,history:!0},Z={broadcast:!0,focus:!1,history:!0},ce={broadcast:!0,history:!0},No={broadcast:!0},xo={label:""},wo="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");Array.from({length:999},(e,o)=>(o+1).toString());const Io=(e,o)=>()=>{let t=e.value.map(({label:d})=>d),u=0,r=0,s;const v=()=>u===0?"":o[(u-1)%o.length];for(;!s;){r>=o.length&&(t=t.slice(o.length),r=0,u++);const i=v()+o[r];t.includes(i)||(s=i),r++}return s},Bo=e=>Io(e.nodes,wo),Mo=({nodes:e,edges:o,nodeMap:t,edgeMap:u,emit:r,settings:s})=>{const v=f=>t.value.get(f),d=f=>u.value.get(f),i=(f,h={})=>{if(f!=null&&f.id&&v(f.id)){console.warn("prevented adding a node with an existing id, this shouldn't happen");return}const c={...Ao,...h},b=s.value.newNodeLabelGetter??Bo({nodes:e}),E={id:f.id??V(),label:f.label??b(),x:f.x??0,y:f.y??0};return e.value.push(E),r("onNodeAdded",E,c),r("onStructureChange"),E},l=(f,h={})=>{if(f.length===0)return;const c={...Co,...h},b=[];for(const E of f){const x=i(E,{focus:!1,broadcast:!1,history:!1});x&&b.push(x)}b.length!==0&&r("onBulkNodeAdded",b,c)},m=(f,h={})=>{const c={...Z,...h},{isGraphDirected:b}=s.value,[E,x]=[v(f.from),v(f.to)];if(!E||!x)return;if(b){if(o.value.find(C=>C.from===f.from&&C.to===f.to))return}else if(o.value.find(C=>C.from===f.from&&C.to===f.to||C.from===f.to&&C.to===f.from))return;const B={...xo,id:V(),...f};return o.value.push(B),r("onEdgeAdded",B,c),r("onStructureChange"),B},T=(f,h={})=>{if(f.length===0)return;const c={...Z,...h},b=[];for(const E of f){const x=m(E,{broadcast:!1,history:!1});x&&b.push(x)}b.length!==0&&r("onBulkEdgeAdded",b,c)},n=(f,h,c={})=>{const b=v(f);if(!b)return;const E={...No,...c};b.x=h.x,b.y=h.y,r("onNodeMoved",b,E)},a=(f,h,c={})=>{const b={...Z,...c},E=d(f);if(!E)return;const x=E.label;E.label=h,r("onEdgeLabelEdited",E,x,b),r("onStructureChange")},A=(f,h={})=>{const c=v(f);if(!c)return;const b={...ue,...h},x=ve(c.id,{edges:o,getEdge:d,settings:s}).map(B=>N(B.id,{broadcast:!1,history:!1})).filter(Boolean);return e.value=e.value.filter(B=>B.id!==c.id),r("onNodeRemoved",c,x,b),r("onStructureChange"),[c,x]},w=(f,h={})=>{if(f.length===0)return;const c={...ue,...h},b=[],E=[];for(const x of f){const B=A(x,{broadcast:!1,history:!1});if(!B)continue;const[S,C]=B;b.push(S),E.push(...C)}b.length!==0&&r("onBulkNodeRemoved",b,E,c)},N=(f,h={})=>{const c=d(f);if(!c)return;const b={...ce,...h};return o.value=o.value.filter(E=>E.id!==c.id),r("onEdgeRemoved",c,b),r("onStructureChange"),c};return{getNode:v,getEdge:d,addNode:i,addEdge:m,moveNode:n,editEdgeLabel:a,removeNode:A,removeEdge:N,bulkAddNode:l,bulkRemoveNode:w,bulkAddEdge:T,bulkRemoveEdge:(f,h={})=>{if(f.length===0)return;const c={...ce,...h},b=[];for(const E of f){const x=N(E,{broadcast:!1,history:!1});x&&b.push(x)}if(b.length!==0)return r("onBulkEdgeRemoved",b,c),b}}},Do=({subscribe:e,canvas:o,graphAtMousePosition:t})=>{const u=I(!1),r=I(!1),s=I({node:"grab",edge:"pointer","node-anchor":"grab","encapsulated-node-box":"move"}),v=I(),d=R(()=>!!v.value),i=n=>{v.value=n},l=()=>{v.value=void 0},m=n=>{var A;if(!n)return"default";if(d.value)return((A=v.value)==null?void 0:A.call(v,n))??!1?"pointer":"default";const a=s.value[n.graphType]??"default";return a==="grab"&&u.value?"grabbing":a},T=({items:n})=>{if(!o.value||r.value)return;const a=n.at(-1);o.value.style.cursor=m(a)};return e("onMouseDown",n=>{u.value=!0,T(n)}),e("onMouseUp",n=>{u.value=!1,T(n)}),e("onMouseMove",T),q(s,()=>{T({items:t.value.items})},{deep:!0}),{graphToCursorMap:s,activateCursorSelectMode:i,deactivateCursorSelectMode:l,graphCursorDisabled:r}},Ro=(e,o={})=>{const t=I("light"),u=so(),r=Eo(t,u),s=I({...So,...o}),v=uo(),{subscribe:d,unsubscribe:i,emit:l}=ao(v),m=I(!0);Le(e,()=>{m.value=!1}),d("onMouseDown",()=>{m.value=!0});const T=I([]),n=I([]),a=I({coords:{x:0,y:0},items:[]}),A=Do({canvas:e,subscribe:d,graphAtMousePosition:a}),w=p=>{const D=Se(e),F=Oe(p,D);a.value={coords:F,items:b(F)}},N=p=>({...a.value,event:p}),g={click:p=>{p.preventDefault(),l("onClick",N(p))},mousemove:p=>{p.preventDefault(),l("onMouseMove",N(p))},mousedown:p=>{p.preventDefault(),l("onMouseDown",N(p))},mouseup:p=>{p.preventDefault(),l("onMouseUp",N(p))},dblclick:p=>{p.preventDefault(),l("onDblClick",N(p))},contextmenu:p=>{l("onContextMenu",N(p))}},f={keydown:p=>l("onKeyDown",p),keyup:p=>l("onKeyUp",p)},{aggregator:h,updateAggregator:c,getSchemaItemsByCoordinates:b}=po({canvas:e,emit:l}),E=p=>{const D={edges:n,getNode:S,getEdge:C,getTheme:r,settings:s},F=n.value.map(H=>$e(H,D)).filter(Boolean).map((H,J)=>({...H,priority:J*10})),Ne=T.value.map(H=>Xe(H,r)).filter(Boolean).map((H,J)=>({...H,priority:J*10+1e3}));return p.push(...F),p.push(...Ne),p};c.push(E),Fe(()=>{if(!e.value)throw new Error("canvas element not found");e.value.addEventListener("mousemove",w);for(const[p,D]of Object.entries(g))e.value.addEventListener(p,D);for(const[p,D]of Object.entries(f))document.addEventListener(p,D)}),Pe(()=>{if(!e.value)throw new Error("Canvas element not found");e.value.removeEventListener("mousemove",w);for(const[p,D]of Object.entries(g))e.value.removeEventListener(p,D);for(const[p,D]of Object.entries(f))document.removeEventListener(p,D)});const{nodeIdToNodeMap:x,edgeIdToEdgeMap:B}=To(T,n),{getNode:S,getEdge:C,addNode:M,addEdge:_,moveNode:k,editEdgeLabel:P,removeNode:G,removeEdge:O,bulkAddNode:z,bulkRemoveNode:Y,bulkAddEdge:L,bulkRemoveEdge:W}=Mo({nodes:T,edges:n,nodeMap:x,edgeMap:B,emit:l,settings:s}),K=(p,D)=>{const F=b({x:p,y:D}).pop();if(F&&F.graphType==="node")return S(F.id)};let U;d("onMouseMove",({items:p})=>{const D=p.at(-1);if(!D||D.graphType!=="node")return;const F=S(D.id);F!==U&&(l("onNodeHoverChange",F,U),U=F)});const pe=p=>(U&&be(U.id,p),p);c.push(pe);const Ae=p=>{T.value=p.nodes,n.value=p.edges,l("onGraphLoaded"),l("onStructureChange")},Ce=()=>{T.value=[],n.value=[],l("onGraphReset"),l("onStructureChange")};q(t,async(p,D)=>{l("onThemeChange",p,D)});const te=I($(s.value));return q(s,p=>{const D=Te(te.value,p);D&&(te.value=$(s.value),l("onSettingsChange",D))},{deep:!0}),{nodes:T,edges:n,getNode:S,getEdge:C,addNode:M,addEdge:_,moveNode:k,editEdgeLabel:P,removeNode:G,removeEdge:O,bulkAddNode:z,bulkRemoveNode:Y,bulkAddEdge:L,bulkRemoveEdge:W,getSchemaItemsByCoordinates:b,getNodeByCoordinates:K,eventBus:v,subscribe:d,unsubscribe:i,emit:l,updateAggregator:c,aggregator:h,baseTheme:R(()=>Ee[t.value]),themeName:t,getTheme:r,themeMap:u,settings:s,load:Ae,reset:Ce,canvas:e,canvasFocused:m,graphAtMousePosition:a,updateGraphAtMousePosition:w,...A}},_o="use-marquee-graph",ko={THEME_ID:_o},Lo=e=>{const o=I(),t=I(),u=I(),{setTheme:r,removeTheme:s}=he(e,ko.THEME_ID),v=()=>r("nodeAnchorColor",y.TRANSPARENT),d=()=>s("nodeAnchorColor"),i=S=>{const{width:C,height:M}=S;return Math.abs(C*M)},l=({items:S,coords:C})=>{const M=S.at(-1);(M==null?void 0:M.graphType)!=="encapsulated-node-box"&&d(),M||A(C)},m=({items:S,coords:C})=>{if(!u.value)return;const M=S.at(-1);if((M==null?void 0:M.graphType)!=="encapsulated-node-box")return;const _=C.x-u.value.x,k=C.y-u.value.y;u.value=C;for(const P of e.focusedNodes.value)e.moveNode(P.id,{x:P.x+_,y:P.y+k});g()},T=({items:S,coords:C})=>{if(o.value)return;const M=S.at(-1);(M==null?void 0:M.graphType)==="encapsulated-node-box"&&(u.value=C,e.emit("onGroupDragStart",e.focusedNodes.value,C))},n=()=>{u.value&&(e.emit("onGroupDrop",e.focusedNodes.value,u.value),u.value=void 0)},a=()=>t.value={at:{x:1/0,y:1/0},width:0,height:0},A=S=>{v(),e.graphCursorDisabled.value=!0,o.value={at:S,width:0,height:0},a()},w=()=>{o.value&&(o.value=void 0,e.graphCursorDisabled.value=!1,d())},N=S=>{if(i(S)<100)return;const M=[];for(const{id:_,shape:k,graphType:P}of e.aggregator.value){const{marqueeSelectableGraphTypes:G}=e.settings.value;if(!G.includes(P))continue;k.efficientHitbox(S)&&M.push(_)}e.setFocus(M)},g=()=>{if(!t.value)return;if(e.focusedNodes.value.length<2)return a();let S=1/0,C=1/0,M=-1/0,_=-1/0;for(const k of e.focusedNodes.value){const P=e.getTheme("nodeSize",k),G=e.getTheme("nodeBorderWidth",k),O=P+G/2,{x:z,y:Y}=k;S=Math.min(S,z-O),C=Math.min(C,Y-O),M=Math.max(M,z+O),_=Math.max(_,Y+O)}S<1/0&&C<1/0&&M>-1/0&&_>-1/0?(t.value.at.x=S,t.value.at.y=C,t.value.width=M-S,t.value.height=_-C):(t.value.width=0,t.value.height=0)},f=({coords:S})=>{if(!o.value)return;const{x:C,y:M}=S;o.value.width=C-o.value.at.x,o.value.height=M-o.value.at.y,N(o.value)},h=S=>({id:"marquee-box",graphType:"marquee-box",shape:ne({...S,color:e.getTheme("marqueeSelectionBoxColor"),stroke:{color:e.getTheme("marqueeSelectionBoxBorderColor"),width:2}}),priority:1/0}),c=S=>{if(!o.value)return S;const C=h(o.value);return S.push(C),S},b=S=>({id:"encapsulated-node-box",graphType:"encapsulated-node-box",shape:ne({...S,color:e.getTheme("marqueeEncapsulatedNodeBoxColor"),stroke:{color:e.getTheme("marqueeEncapsulatedNodeBoxBorderColor"),width:2}}),priority:1/0}),E=S=>{if(!t.value)return S;const C=b(t.value);return S.push(C),S};e.updateAggregator.push(E),e.updateAggregator.push(c);const x=()=>{e.subscribe("onFocusChange",g),e.subscribe("onMouseDown",l),e.subscribe("onMouseUp",w),e.subscribe("onContextMenu",w),e.subscribe("onMouseMove",f),e.subscribe("onMouseDown",T),e.subscribe("onMouseUp",n),e.subscribe("onMouseMove",m),e.subscribe("onUndo",g),e.subscribe("onRedo",g)},B=()=>{e.unsubscribe("onFocusChange",g),e.unsubscribe("onMouseDown",l),e.unsubscribe("onMouseUp",w),e.unsubscribe("onContextMenu",w),e.unsubscribe("onMouseMove",f),e.unsubscribe("onMouseDown",T),e.unsubscribe("onMouseUp",n),e.unsubscribe("onMouseMove",m),e.unsubscribe("onUndo",g),e.unsubscribe("onRedo",g),o.value&&w()};return e.subscribe("onSettingsChange",S=>{S.marquee===!0?x():S.marquee===!1&&B()}),e.settings.value.marquee&&x(),{updateEncapsulatedNodeBox:g}},Fo=e=>{const o=I(),t=({items:d,coords:i})=>{const l=d.at(-1);if(!l||l.graphType!=="node")return;e.settings.value.nodeAnchors=!1;const m=e.getNode(l.id);m&&(o.value={node:m,coords:i},e.emit("onNodeDragStart",m))},u=()=>{o.value&&(e.emit("onNodeDrop",o.value.node),e.settings.value.nodeAnchors=!0,e.nodeAnchorSetParentNode(o.value.node.id),o.value=void 0)},r=({coords:d})=>{if(!o.value)return;const{node:i,coords:l}=o.value,m=d.x-l.x,T=d.y-l.y;e.moveNode(i.id,{x:i.x+m,y:i.y+T}),o.value.coords=d},s=()=>{e.subscribe("onMouseDown",t),e.subscribe("onMouseUp",u),e.subscribe("onMouseMove",r)},v=()=>{e.unsubscribe("onMouseDown",t),e.unsubscribe("onMouseUp",u),e.unsubscribe("onMouseMove",r),o.value&&u()};return e.subscribe("onSettingsChange",d=>{d.draggable===!1?v():d.draggable===!0&&s()}),e.settings.value.draggable&&s(),{activeDragNode:R(()=>{var d;return(d=o.value)==null?void 0:d.node})}},Po=e=>{const o=I(),t=I(),u=c=>{const b=e.getNode(c);if(!b)throw new Error("node not found");o.value=b,d(b)},r=()=>{o.value=void 0,t.value=void 0},s=c=>{const{getTheme:b}=e,E=b("nodeAnchorColor",c),x=b("nodeAnchorRadius",c),B=[];for(const S of v.value){const{x:C,y:M}=S,_={at:{x:C,y:M},radius:x,color:E};t.value&&t.value.direction===S.direction&&(_.at.x=t.value.x,_.at.y=t.value.y);const k=me(_);B.push({id:S.id,graphType:"node-anchor",shape:k,priority:1/0})}return B},v=I([]),d=c=>{if(!c)return v.value=[];const{getTheme:b}=e,E=b("nodeAnchorRadius",c),x=b("nodeSize",c),B=b("nodeBorderWidth",c),S=x-E/3+B/2;v.value=[{x:c.x,y:c.y-S,direction:"north"},{x:c.x+S,y:c.y,direction:"east"},{x:c.x,y:c.y+S,direction:"south"},{x:c.x-S,y:c.y,direction:"west"}].map(C=>({...C,id:V()}))},i=({items:c})=>{const b=c.at(-1);if(!b||b.graphType!=="node-anchor")return;const{id:E}=b;return v.value.find(x=>x.id===E)},l=()=>{if(!o.value||!t.value)return;const{x:c,y:b}=t.value,E={x:o.value.x,y:o.value.y},x={x:c,y:b},{getTheme:B}=e,S=B("linkPreviewColor",o.value,t.value),C=B("linkPreviewWidth",o.value,t.value);return{id:"link-preview",graphType:"link-preview",shape:ye({start:E,end:x,color:S,width:C})}},m=({items:c})=>{if(t.value)return;const b=c.at(-1);if(!b)return r();if(b.graphType!=="node")return;const E=e.getNode(b.id);if(!E)throw new Error("node in aggregator but not in graph");const x=e.isFocused(E.id),B=e.focusedNodes.value.length>1;if(x&&B)return r();o.value=E,d(E)},T=c=>{if(!o.value)return;const b=i(c);b&&(t.value=b,e.emit("onNodeAnchorDragStart",o.value,b))},n=({coords:c})=>{if(!t.value)return;const{x:b,y:E}=c;t.value.x=b,t.value.y=E},a=()=>{if(t.value){if(!o.value)throw new Error("active anchor without parent node")}else return;e.emit("onNodeAnchorDrop",o.value,t.value),r()},A=c=>{if(!o.value)return c;const b=s(o.value);for(const E of b)c.push(E);return c},w=c=>{var S;if(!o.value||!t.value)return c;const{id:b}=o.value;be(b,c);const E=(S=c.find(C=>C.id===b))==null?void 0:S.priority;if(!E)return c;const x=l();if(!x)return c;const B={...x,priority:E-.1};return c.push(B),c};e.updateAggregator.push(A),e.updateAggregator.push(w);const N=c=>{var b;((b=o.value)==null?void 0:b.id)===c.id&&r()},g=()=>{if(!o.value)return;const c=e.isFocused(o.value.id),b=e.focusedNodes.value.length>1;c&&b&&r()},f=()=>{e.subscribe("onNodeRemoved",N),e.subscribe("onNodeMoved",r),e.subscribe("onNodeDrop",d),e.subscribe("onMouseMove",m),e.subscribe("onMouseMove",n),e.subscribe("onMouseDown",T),e.subscribe("onMouseUp",a),e.subscribe("onFocusChange",g)},h=()=>{e.unsubscribe("onNodeRemoved",N),e.unsubscribe("onNodeMoved",r),e.unsubscribe("onNodeDrop",d),e.unsubscribe("onMouseMove",m),e.unsubscribe("onMouseMove",n),e.unsubscribe("onMouseDown",T),e.unsubscribe("onMouseUp",a),e.unsubscribe("onFocusChange",g),r()};return e.subscribe("onSettingsChange",c=>{c.nodeAnchors===!0?f():c.nodeAnchors===!1&&h()}),e.settings.value.nodeAnchors&&f(),{nodeAnchorActiveAnchor:Q(t),nodeAnchorParentNode:Q(o),nodeAnchorSetParentNode:u}},Oo=(e=!1)=>{const o=d=>d.key===" "?"Space":d.key.length>1||e?d.key:d.key.toUpperCase(),t=I(""),u=R(()=>{let d;return t.value.split("+").filter(i=>{const l=i===d;return d=i,!l}).join("+")}),r=d=>{t.value.length>0&&(t.value+="+"),t.value+=o(d)},s=()=>{t.value=""},v=d=>u.value===d;return document.addEventListener("keydown",r),document.addEventListener("keyup",s),ee(()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",s)}),{isPressed:v,currentKeyString:t}},Uo=window.navigator.userAgent.includes("Mac")?"Mac":"Windows",Go=e=>{const{settings:o}=e,t=()=>{e.annotationActive.value&&e.undoAnnotation(),o.value.interactive&&e.undo()},u=()=>{e.annotationActive.value&&e.redoAnnotation(),o.value.interactive&&e.redo()},r=()=>e.resetFocus(),s=()=>e.focusAll(),v=()=>{o.value.interactive!==!1&&(e.bulkRemoveNode([...e.focusedItemIds.value]),e.bulkRemoveEdge([...e.focusedItemIds.value]))},d=(f,h)=>h===!1?()=>{}:typeof h=="function"?h:f,i=R(()=>d(u,o.value.shortcutRedo)),l=R(()=>d(t,o.value.shortcutUndo)),m=R(()=>d(r,o.value.shortcutEscape)),T=R(()=>d(s,o.value.shortcutSelectAll)),n=R(()=>d(v,o.value.shortcutDelete)),a=R(()=>({Mac:{"Meta+Z":l.value,"Shift+Meta+Z":i.value,"Meta+Shift+Z":i.value,Backspace:n.value,"Meta+A":T.value,Escape:m.value},Windows:{"Control+Z":l.value,"Shift+Control+Z":i.value,"Control+Shift+Z":i.value,Backspace:n.value,"Control+A":T.value,Escape:m.value}})),{isPressed:A}=Oo(),w=f=>{if(e.canvasFocused.value===!1)return;const h=a.value[Uo];for(const c in h)if(A(c)){h[c](),f.preventDefault();return}},N=()=>{e.subscribe("onKeyDown",w)},g=()=>{e.unsubscribe("onKeyDown",w)};return o.value.shortcuts&&N(),e.subscribe("onSettingsChange",f=>{f.shortcuts===!0?N():f.shortcuts===!1&&g()}),{delete:n,selectAll:T,escape:m,redo:i,undo:l}},Wo=[y.RED_600,y.BLUE_600,y.GREEN_600,y.YELLOW_600],Ho=[3,6,9,12],ie=100,Ko=e=>{const o=I([]),t=I([]);return{clearHistory:()=>{o.value=[],t.value=[]},undo:()=>{const i=o.value.pop();if(!i)return;const{action:l,annotations:m}=i,T=m.map(({id:n})=>n);l==="add"?e.value=e.value.filter(({id:n})=>!T.includes(n)):l==="remove"&&e.value.push(...m),t.value.push(i)},redo:()=>{const i=t.value.pop();if(!i)return;const{action:l,annotations:m}=i,T=m.map(({id:n})=>n);l==="add"?e.value.push(...m):l==="remove"&&(e.value=e.value.filter(({id:n})=>!T.includes(n))),o.value.push(i)},addToUndoStack:i=>{o.value.push(i),o.value.length>ie&&o.value.shift()},addToRedoStack:i=>{t.value.push(i),t.value.length>ie&&t.value.shift()},canUndo:R(()=>o.value.length!==0),canRedo:R(()=>t.value.length!==0)}},qo=e=>{const o=I(Wo[0]),t=I(Ho[1]),u=I(!1),r=I(new Set),s=I([]),v=I([]),d=I(!1),i=I(),l=I(!1),m=Ko(v),T=()=>{v.value.length!==0&&(m.addToUndoStack({action:"remove",annotations:v.value}),v.value=[])},n=({coords:f})=>{d.value=!0,i.value=f,s.value=[f]},a=({coords:f})=>{if(!(!d.value||!i.value)){if(u.value){const h=v.value.filter(c=>j.scribble(c).hitbox(f));for(const c of h)r.value.add(c.id);return}i.value=f,s.value.push(f)}},A=()=>{if(!d.value||(d.value=!1,i.value=void 0,s.value.length===0))return;if(u.value){const h=v.value.filter(c=>r.value.has(c.id));m.addToUndoStack({action:"remove",annotations:h}),v.value=v.value.filter(c=>!r.value.has(c.id)),r.value.clear();return}const f={id:V(),type:"draw",points:s.value,color:o.value,brushWeight:t.value};v.value.push(f),m.addToUndoStack({action:"add",annotations:[f]}),s.value=[]};q(u,()=>{e.canvas.value&&(e.canvas.value.style.cursor=u.value?"none":"crosshair")});const w=f=>{if(!l.value)return f;if(u.value){const h=j.circle({at:e.graphAtMousePosition.value.coords,radius:10,color:y.TRANSPARENT,stroke:{color:y.WHITE+"60",width:2}});f.push({graphType:"annotation",id:h.id,shape:h,priority:5050})}else if(s.value.length>0){const h=j.scribble({type:"draw",points:s.value,color:o.value,brushWeight:t.value});f.push({graphType:"annotation",id:h.id,shape:h,priority:5001})}for(const h of v.value){const c=r.value.has(h.id);f.push({graphType:"annotation",id:h.id,shape:j.scribble({...h,color:h.color+(c?"50":"")}),priority:5e3})}return f};return e.updateAggregator.push(w),{clearAnnotations:T,annotationActive:l,annotationErasing:u,annotationColor:o,annotationBrushWeight:t,activateAnnotation:()=>{e.canvas.value&&(l.value=!0,e.settings.value.interactive=!1,e.settings.value.marquee=!1,e.settings.value.focusable=!1,e.settings.value.draggable=!1,e.graphCursorDisabled.value=!0,e.canvas.value.style.cursor="crosshair",e.subscribe("onMouseDown",n),e.subscribe("onMouseMove",a),e.subscribe("onMouseUp",A))},deactivateAnnotation:()=>{e.canvas.value&&(l.value=!1,u.value=!1,e.settings.value.interactive=!0,e.settings.value.marquee=!0,e.settings.value.focusable=!0,e.settings.value.draggable=!0,e.graphCursorDisabled.value=!1,e.canvas.value.style.cursor="default",e.unsubscribe("onMouseDown",n),e.unsubscribe("onMouseMove",a),e.unsubscribe("onMouseUp",A))},undoAnnotation:m.undo,redoAnnotation:m.redo,canUndoAnnotation:m.canUndo,canRedoAnnotation:m.canRedo}},zo=["node","edge"],Yo="use-focus-graph",jo=e=>{const{setTheme:o}=he(e,Yo),t=I(new Set),u=I(!1),r=g=>{const f=g.filter(E=>!e.settings.value.focusBlacklist.includes(E));if(f.length===t.value.size&&f.every(E=>t.value.has(E)))return;const b=new Set([...t.value]);t.value=new Set(f),e.emit("onFocusChange",t.value,b)},s=g=>{if(t.value.has(g)||e.settings.value.focusBlacklist.includes(g))return;const c=new Set([...t.value]);t.value.add(g),e.emit("onFocusChange",t.value,c)},v=g=>{var h,c;const f=Se(e.canvas);(c=(h=g.shape).activateTextArea)==null||c.call(h,f,b=>{const E=e.getEdge(g.id);if(!E)throw new Error("textarea only implemented for edges");const x=e.settings.value.edgeInputToLabel(b);x===void 0||E.label===x||e.editEdgeLabel(E.id,x)})},d=()=>{const g=Array.from(t.value),f=g.filter(h=>e.getNode(h)||e.getEdge(h));f.length!==g.length&&r(f)},i=({items:g,coords:f})=>{var x,B;const h=g.at(-1);if(!h)return u.value?void 0:l();if(((B=(x=h.shape).textHitbox)==null?void 0:B.call(x,f))&&e.settings.value.edgeLabelsEditable&&h.graphType==="edge")return l(),v(h);zo.some(S=>S===h.graphType)&&(u.value?s(h.id):r([h.id]))},l=()=>r([]),m=()=>{const g=e.nodes.value.map(h=>h.id),f=e.edges.value.map(h=>h.id);r([...g,...f])},T=({id:g},{focus:f})=>{f&&r([g])},n=g=>t.value.has(g);o("nodeColor",g=>{if(n(g.id))return e.getTheme("nodeFocusColor",g)}),o("nodeBorderColor",g=>{if(n(g.id))return e.getTheme("nodeFocusBorderColor",g)}),o("nodeTextColor",g=>{if(n(g.id))return e.getTheme("nodeFocusTextColor",g)}),o("edgeColor",g=>{if(n(g.id))return e.getTheme("edgeFocusColor",g)}),o("edgeTextColor",g=>{if(n(g.id))return e.getTheme("edgeFocusTextColor",g)}),o("nodeAnchorColor",g=>{if(n(g.id))return e.getTheme("nodeAnchorColorWhenParentFocused",g)});const a=g=>{g.key==="Shift"&&(u.value=!0)},A=g=>{g.key==="Shift"&&(u.value=!1)},w=()=>{e.subscribe("onNodeAdded",T),e.subscribe("onEdgeAdded",T),e.subscribe("onMouseDown",i),e.subscribe("onKeyDown",a),e.subscribe("onKeyUp",A),e.subscribe("onStructureChange",d)},N=()=>{e.unsubscribe("onNodeAdded",T),e.unsubscribe("onEdgeAdded",T),e.unsubscribe("onMouseDown",i),e.unsubscribe("onKeyDown",a),e.unsubscribe("onKeyUp",A),e.unsubscribe("onStructureChange",d),l()};return e.subscribe("onSettingsChange",g=>{g.focusable===!1?N():g.focusable===!0&&w()}),e.settings.value.focusable&&w(),{focusedItemIds:Q(t),setFocus:r,resetFocus:l,addToFocus:s,isFocused:n,focusAll:m,focusedNodes:R(()=>e.nodes.value.filter(g=>n(g.id))),focusedEdges:R(()=>e.edges.value.filter(g=>n(g.id)))}},Vo={focus:!0},Jo={focus:!0},de=100,le=3,Zo=e=>{const o=I([]),t=I([]),u=n=>{o.value.push(n),o.value.length>de&&o.value.shift()},r=n=>{t.value.push(n),t.value.length>de&&t.value.shift()};e.subscribe("onNodeAdded",(n,{history:a})=>{a&&u({action:"add",affectedItems:[{graphType:"node",data:n}]})}),e.subscribe("onBulkNodeAdded",(n,{history:a})=>{a&&u({action:"add",affectedItems:n.map(A=>({graphType:"node",data:A}))})}),e.subscribe("onNodeRemoved",(n,a,{history:A})=>{if(!A)return;const w=a.map(N=>({graphType:"edge",data:N}));u({action:"remove",affectedItems:[{graphType:"node",data:n},...w]})}),e.subscribe("onBulkNodeRemoved",(n,a,{history:A})=>{if(!A)return;const w=n.map(g=>({graphType:"node",data:g})),N=a.map(g=>({graphType:"edge",data:g}));u({action:"remove",affectedItems:[...w,...N]})}),e.subscribe("onEdgeLabelEdited",(n,a,{history:A})=>{A&&u({action:"edit",affectedItems:[{graphType:"edge",data:{id:n.id,from:a,to:n.label}}]})}),e.subscribe("onEdgeAdded",(n,{history:a})=>{a&&u({action:"add",affectedItems:[{graphType:"edge",data:n}]})}),e.subscribe("onBulkEdgeAdded",(n,{history:a})=>{a&&u({action:"add",affectedItems:n.map(A=>({graphType:"edge",data:A}))})}),e.subscribe("onEdgeRemoved",(n,{history:a})=>{a&&u({action:"remove",affectedItems:[{graphType:"edge",data:n}]})}),e.subscribe("onBulkEdgeRemoved",(n,{history:a})=>{a&&u({action:"remove",affectedItems:n.map(A=>({graphType:"edge",data:A}))})});const s=I();e.subscribe("onGroupDragStart",(n,a)=>{s.value={startingCoordinates:a,nodes:n}}),e.subscribe("onGroupDrop",(n,a)=>{if(!s.value)throw new Error("dropped a group we didn't know was being dragged");if(s.value.nodes.length!==n.length)throw new Error("group size mismatch");const A=s.value.startingCoordinates.y-a.y,w=s.value.startingCoordinates.x-a.x;Math.sqrt(A**2+w**2)<le||u({action:"move",affectedItems:s.value.nodes.map(g=>({graphType:"node",data:{id:g.id,from:{x:g.x+w,y:g.y+A},to:{x:g.x,y:g.y}}}))})});const v=I();e.subscribe("onNodeDragStart",n=>{v.value={id:n.id,from:{x:n.x,y:n.y},to:{x:n.x,y:n.y}}}),e.subscribe("onNodeDrop",n=>{if(!v.value)throw new Error("dropped a node we didn't know was being dragged");if(v.value.id!==n.id)throw new Error("node ID mismatch");v.value.to={x:n.x,y:n.y};const a=v.value.from.y-v.value.to.y,A=v.value.from.x-v.value.to.x;Math.sqrt(a**2+A**2)<le||u({action:"move",affectedItems:[{graphType:"node",data:v.value}]})});const d=(n={})=>{const a=o.value.pop();if(a)return r(a),l(a),e.emit("onUndo",a,{...Vo,...n}),a},i=(n={})=>{const a=t.value.pop();if(a)return u(a),m(a),e.emit("onRedo",a,{...Jo,...n}),a},l=n=>{if(n.action==="add")for(const a of n.affectedItems)a.graphType==="node"?e.removeNode(a.data.id,{history:!1}):a.graphType==="edge"&&e.removeEdge(a.data.id,{history:!1});else if(n.action==="remove")for(const a of n.affectedItems)a.graphType==="node"?e.addNode(a.data,{history:!1,focus:!1}):a.graphType==="edge"&&e.addEdge(a.data,{history:!1,focus:!1});else if(n.action==="move"){for(const a of n.affectedItems)if(a.graphType==="node"){const{from:A,id:w}=a.data;e.moveNode(w,{x:A.x,y:A.y})}}else if(n.action==="edit")for(const a of n.affectedItems)e.editEdgeLabel(a.data.id,a.data.from,{history:!1})},m=n=>{if(n.action==="add")for(const a of n.affectedItems)a.graphType==="node"?e.addNode(a.data,{history:!1,focus:!1}):a.graphType==="edge"&&e.addEdge(a.data,{history:!1,focus:!1});else if(n.action==="remove")for(const a of n.affectedItems)a.graphType==="node"?e.removeNode(a.data.id,{history:!1}):a.graphType==="edge"&&e.removeEdge(a.data.id,{history:!1});else if(n.action==="move"){for(const a of n.affectedItems)if(a.graphType==="node"){const{to:A,id:w}=a.data;e.moveNode(w,{x:A.x,y:A.y})}}else if(n.action==="edit")for(const a of n.affectedItems)e.editEdgeLabel(a.data.id,a.data.to,{history:!1})},T=()=>{o.value=[],t.value=[]};return{undo:d,redo:i,canUndo:R(()=>o.value.length>0),canRedo:R(()=>t.value.length>0),undoStack:o,redoStack:t,addToUndoStack:u,addToRedoStack:r,clearHistory:T}},Xo=e=>{const o={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-nodes")??"[]"),set:i=>{const l=i.filter(m=>!e.settings.value.persistentBlacklist.has(m.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-nodes",JSON.stringify(l))}},t={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-edges")??"[]"),set:i=>{const l=i.filter(m=>!e.settings.value.persistentBlacklist.has(m.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-edges",JSON.stringify(l))}},u=async()=>{await new Promise(i=>setTimeout(i,10)),o.set(e.nodes.value),t.set(e.edges.value)},r=()=>e.load({nodes:o.get(),edges:t.get()}),s=["onStructureChange","onNodeDrop","onGroupDrop"],v=()=>{s.forEach(i=>e.subscribe(i,u))},d=()=>{s.forEach(i=>e.unsubscribe(i,u))};return e.subscribe("onSettingsChange",i=>{if(d(),"persistent"in i&&!i.persistent)return;if("persistent"in i&&i.persistent){r(),v();return}"persistentStorageKey"in i&&r(),v()}),e.settings.value.persistent&&(queueMicrotask(r),v()),{trackGraphState:u}},Qo=e=>{const o=({coords:s,event:v})=>{e.addNode(s),setTimeout(()=>e.updateGraphAtMousePosition(v),10)},t=(s,v)=>{const i=e.getSchemaItemsByCoordinates(v).findLast(m=>m.graphType==="node");if(!i)return;const l=e.getNode(i.id);if(l&&!(e.settings.value.userAddedEdgeRuleNoSelfLoops&&s.id===l.id)){if(e.settings.value.userAddedEdgeRuleOneEdgePerPath){const m=e.edges.value.find(a=>a.from===s.id&&a.to===l.id),T=e.edges.value.find(a=>a.from===l.id&&a.to===s.id);if(m||T)return}e.addEdge({from:s.id,to:l.id,label:e.settings.value.userAddedEdgeLabel})}},u=()=>{e.subscribe("onDblClick",o),e.subscribe("onNodeAnchorDrop",t),e.settings.value.nodeAnchors=!0,e.settings.value.edgeLabelsEditable=!0},r=()=>{e.unsubscribe("onDblClick",o),e.unsubscribe("onNodeAnchorDrop",t),e.settings.value.nodeAnchors=!1,e.settings.value.edgeLabelsEditable=!1};e.settings.value.interactive&&u(),e.subscribe("onSettingsChange",s=>{s.interactive===!0?u():s.interactive===!1&&r()})},$o=({adjacencyList:e,undirectedAdjacencyList:o})=>{const t=(v,d)=>{const i=new Set,l=[];for(l.push(d);l.length>0;){const m=l.shift();if(!m)break;i.add(m),v[m].forEach(n=>{i.has(n)||l.push(n)})}return i},u=v=>Object.keys(v).every(d=>t(v,d).size===Object.keys(v).length),r=R(()=>u(e.value)),s=R(()=>u(o.value));return{isConnected:r,isWeaklyConnected:s}},et=e=>({...$o(e.adjacencyLists)}),fe=e=>{const o=e.nodes.value,t=o.length,u=Ue(e),r=o.reduce((v,d,i)=>(v[d.id]=i,v),{}),s=Array.from({length:t},()=>Array(t).fill(0));for(const[v,d]of Object.entries(u)){const i=r[v];for(const l of d){const m=r[l.id];s[i][m]=l.weight}}return s},ot=e=>{const o=I(fe(e)),t=()=>{o.value=fe(e)};return e.subscribe("onStructureChange",t),ee(()=>{e.unsubscribe("onStructureChange",t)}),{transitionMatrix:o}},st=(e,o={})=>{const t=Ro(e,o),u=jo(t),r=Zo(t),s=Lo({...t,...u}),v=Po({...t,...u}),d=Fo({...t,...v}),i=qo(t),l=Xo(t),m=Je(t),T=Go({...t,...r,...u,...i}),n=Ge(t),a=ot(t),A=et({...t,adjacencyLists:n});return Qo(t),{...t,...u,...r,...s,...d,...v,...i,...l,...m,shortcutActions:T,adjacencyLists:n,transitionMatrix:a,characteristics:A,helpers:Ze(t)}},rt=We({__name:"Graph",props:{graph:{}},emits:["graphRef"],setup(e,{emit:o}){const t=e,u=o,r=i=>u("graphRef",i),s=I(t.graph.getTheme("graphBgPatternColor")),v=I(t.graph.getTheme("graphBgColor")),d=async()=>{s.value=t.graph.getTheme("graphBgPatternColor"),v.value=t.graph.getTheme("graphBgColor")};return t.graph.subscribe("onThemeChange",d),(i,l)=>(Ke(),He(je,{onCanvasRef:r,color:v.value,"pattern-color":s.value},null,8,["color","pattern-color"]))}});export{Ho as B,Wo as C,wo as L,Ee as T,rt as _,ot as a,Io as g,co as i,st as u};
