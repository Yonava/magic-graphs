import{bH as b,bI as X,bJ as S,bK as Y,bL as $,bM as k,bN as _,bO as W,ah as C,bP as wt,bQ as nt,bR as at,bS as jt,bT as qt,bU as gt,bV as yt,bW as N,bX as et,bY as Jt,bZ as Kt,b_ as T,b$ as ut,c0 as vt,c1 as bt,c2 as Vt,c3 as At,c4 as Qt,c5 as te,c6 as ee,c7 as ne,E as O,g as m,an as ot,ak as rt,O as U,N as V,bs as ae,d as oe,c8 as re,L as R,c9 as se,c as dt,Z as ht,C as ie,a as xt,I as Q,o as ft}from"./index-B-EnZkPm.js";const st=t=>{const{pointA:e,pointB:n,pointC:a,textArea:o}={...Lt,...t};if(!o)throw new Error("no text area provided");const{text:r}=o,{fontSize:s}={...$,...r},i=(e.x+n.x+a.x)/3,l=(e.y+n.y+a.y)/3;return{x:i-s,y:l-s}},ce=t=>{if(!t.textArea)return;const e=st(t),n=b(t.textArea,e),{width:a,height:o}=X(n),r=S({at:n.at,width:a,height:o});return s=>r(s)},Tt=t=>{if(!t.textArea)return;const e=st(t),n=b(t.textArea,e),a=Y(n);return o=>a(o)},mt=t=>{if(!t.textArea)return;const e=st(t),n=b(t.textArea,e),a=k(n);return o=>a(o)},le=t=>{const e=Tt(t),n=mt(t);if(!(!e||!n))return a=>{e(a),n(a)}},Et=t=>e=>{const{pointA:n,pointB:a,pointC:o,stroke:r}=t;if(r){const d={start:n,end:a,width:r.width},g={start:a,end:o,width:r.width},y={start:o,end:n,width:r.width};return _(d)(e)||_(g)(e)||_(y)(e)}const{x:s,y:i}=e,l=.5*(-a.y*o.x+n.y*(-a.x+o.x)+n.x*(a.y-o.y)+a.x*o.y),c=1/(2*l)*(n.y*o.x-n.x*o.y+(o.y-n.y)*s+(n.x-o.x)*i),u=1/(2*l)*(n.x*a.y-n.y*a.x+(n.y-a.y)*s+(a.x-n.x)*i);return c>0&&u>0&&1-c-u>0},St=t=>()=>{const{pointA:e,pointB:n,pointC:a}=t,o=Math.min(e.x,n.x,a.x),r=Math.min(e.y,n.y,a.y),s=Math.max(e.x,n.x,a.x),i=Math.max(e.y,n.y,a.y);return{at:{x:o,y:r},width:s-o,height:i-r}},Ht=t=>{const e=St(t)(),n=W(e);return a=>n(a)},Lt={color:"black"},ue=t=>{const e=Mt(t),n=Et(t),a=ce(t),o=Ht(t),r=h=>n(h),s=St(t),i=le(t),l=Tt(t),c=mt(t),u=h=>{e(h),i==null||i(h)};return{id:t.id??C(),name:"triangle",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:r,shapeHitbox:n,textHitbox:a,efficientHitbox:o,getBoundingBox:s}},Mt=t=>e=>{const{pointA:n,pointB:a,pointC:o,color:r,stroke:s,gradientStops:i}={...Lt,...t};if(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.lineTo(o.x,o.y),i&&i.length>=2){const l={x:(a.x+o.x)/2,y:(a.y+o.y)/2},c=e.createLinearGradient(l.x,l.y,n.x,n.y);i.forEach(({offset:u,color:h})=>{c.addColorStop(u,h)}),e.fillStyle=c}else e.fillStyle=r;e.fill(),e.closePath(),s&&(e.lineWidth=s.width,e.strokeStyle=s.color,s.dash?e.setLineDash(s.dash):e.setLineDash([]),e.stroke(),e.setLineDash([]))},Ct=t=>{var I;const{start:e,end:n,width:a,color:o,dash:r,gradientStops:s,arrowHeadSize:i,arrowHeadShape:l}={...Z,...t},c=Math.atan2(n.y-e.y,n.x-e.x),{arrowHeadHeight:u,perpLineLength:h}=i(a),d={x:n.x-u*Math.cos(c),y:n.y-u*Math.sin(c)},g={start:e,end:{x:d.x+Math.cos(c),y:d.y+Math.sin(c)},width:a,color:o,dash:r,gradientStops:s},y=wt(g),x=n,H={x:d.x+h*Math.cos(c+Math.PI/2),y:d.y+h*Math.sin(c+Math.PI/2)},p={x:d.x-h*Math.cos(c+Math.PI/2),y:d.y-h*Math.sin(c+Math.PI/2)},B=l?l(n,u,h).draw:Mt({pointA:x,pointB:H,pointC:p,color:s&&s.length?(I=s.at(-1))==null?void 0:I.color:o});return E=>{y(E),B(E)}},pt=t=>{const{start:e,end:n,width:a,arrowHeadSize:o,arrowHeadShape:r}={...Z,...t},s=_(t),{arrowHeadHeight:i,perpLineLength:l}=o(a),c=nt({start:e,end:n,width:a,arrowHeadSize:o}),u=r?r(n,i,l).hitbox:Et(c);return h=>s(h)||u(h)},de=t=>()=>{const{at:e,width:n,height:a}=jt(t)(),o={x:e.x,y:e.y},r={x:e.x+n,y:e.y+a},{start:s,end:i,width:l,arrowHeadSize:c}={...Z,...t},u=nt({start:s,end:i,width:l,arrowHeadSize:c}),h=Math.min(o.x,u.pointA.x,u.pointB.x,u.pointC.x),d=Math.max(o.x,u.pointA.x,u.pointB.x,u.pointC.x),g=Math.min(r.y,u.pointA.y,u.pointB.y,u.pointC.y),y=Math.max(r.y,u.pointA.y,u.pointB.y,u.pointC.y);return{at:{x:h,y:g},width:d-h,height:y-g}},he=t=>{const e=at(t),{start:n,end:a,width:o,arrowHeadSize:r}={...Z,...t},s=nt({start:n,end:a,width:o,arrowHeadSize:r}),i=Ht(s);return l=>e(l)||i(l)},G=t=>{const{textArea:e}=t;if(!e)throw new Error("no text area provided");return qt(t)},xe=t=>{if(!t.textArea)return;const e=G(t),n=b(t.textArea,e),{width:a,height:o}=X(n),r=S({at:n.at,width:a,height:o});return s=>r(s)},Bt=t=>{if(!t.textArea)return;const e=G(t),n=b(t.textArea,e),a=Y(n);return o=>a(o)},It=t=>{if(!t.textArea)return;const e=G(t),n=b(t.textArea,e),a=k(n);return o=>a(o)},fe=t=>{const e=Bt(t),n=It(t);if(!(!e||!n))return a=>{e(a),n(a)}},Z={...gt,arrowHeadSize:yt},we=t=>{if(t.width&&t.width<0)throw new Error("width must be positive");const e=Ct(t),n=pt(t),a=xe(t),o=he(t),r=d=>(a==null?void 0:a(d))||n(d),s=de(t),i=fe(t),l=Bt(t),c=It(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=G(t),x=b(t.textArea,y);N(d,x,g)};return{id:t.id??C(),name:"arrow",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:r,shapeHitbox:n,textHitbox:a,efficientHitbox:o,getBoundingBox:s,activateTextArea:h}},ge=t=>{const e=et({width:t.size,height:t.size,...t});return n=>e(n)},j=t=>{const{at:e,size:n,textArea:a}=t;if(!a)throw new Error("no text area provided");const{text:o}=a,{fontSize:r}={...$,...o},s=e.x+n/2,i=e.y+n/2;return{x:s-r,y:i-r}},ye=t=>{if(!t.textArea)return;const e=j(t),n=b(t.textArea,e),{width:a,height:o}=X(n),r=S({at:n.at,width:a,height:o});return s=>r(s)},Pt=t=>{if(!t.textArea)return;const e=j(t),n=b(t.textArea,e),a=Y(n);return o=>a(o)},Wt=t=>{if(!t.textArea)return;const e=j(t),n=b(t.textArea,e),a=k(n);return o=>a(o)},ve=t=>{const e=Pt(t),n=Wt(t);if(!(!e||!n))return a=>{e(a),n(a)}},be=t=>{const{at:e,size:n,borderRadius:a,rotation:o,stroke:r}={...me,...t},s=S({at:e,width:n,height:n,borderRadius:a,rotation:o,stroke:r});return i=>s(i)},Ae=t=>Jt({at:t.at,width:t.size,height:t.size}),Te=t=>{const e=W({at:t.at,width:t.size,height:t.size});return n=>e(n)},me=Kt,Ee=t=>{const e=ge(t),n=be(t),a=ye(t),o=Te(t),r=d=>(a==null?void 0:a(d))||n(d),s=Ae(t),i=ve(t),l=Pt(t),c=Wt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=j(t),x=b(t.textArea,y);N(d,x,g)};return{id:t.id??C(),name:"square",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:r,shapeHitbox:n,textHitbox:a,efficientHitbox:o,getBoundingBox:s,activateTextArea:h}},Se=t=>{const{spacing:e,at:n,upDistance:a,downDistance:o,rotation:r,lineWidth:s,color:i,arrowHeadShape:l,arrowHeadSize:c,gradientStops:u}={..._t,...t},h=T({x:n.x,y:n.y-e},n,r),d=T({x:n.x+a,y:n.y-e},n,r),g=T({x:n.x+a,y:n.y+e},n,r),y=T({x:n.x+a-o,y:n.y+e},n,r),x=T({x:n.x+a,y:n.y},n,r);let H=[],p=[],B=[];if(u.length>=2){const f=a+o+Math.PI*e,L=ut(u,a/f),P=ut(u,(f-o)/f);H=[...u.filter(v=>v.offset<=a/f),{offset:1,color:L}],p=[{offset:0,color:L},...u.filter(v=>v.offset>=a/f&&v.offset<=(f-o)/f).map(v=>({offset:(v.offset-a/f)/(Math.PI*e/f),color:v.color})),{offset:1,color:P}],B=[{offset:0,color:P},...u.filter(v=>v.offset>=(f-o)/f).map(v=>({offset:(v.offset-(f-o)/f)/(o/f),color:v.color}))]}const I=wt({start:h,end:d,width:s,color:i,gradientStops:H}),E=Ct({start:g,end:y,width:s,color:i,arrowHeadSize:c,arrowHeadShape:l,gradientStops:B});return f=>{if(I(f),E(f),f.beginPath(),f.strokeStyle=i,p.length>=2){const L=Math.PI/2+r+.01,P=-Math.PI/2+r-.01,v=x.x+Math.cos(L)*e,K=x.y+Math.sin(L)*e,lt=x.x+Math.cos(P)*e,F=x.y+Math.sin(P)*e,w=f.createLinearGradient(lt,F,v,K);for(const A of p)w.addColorStop(A.offset,A.color);f.strokeStyle=w}f.arc(x.x,x.y,e,Math.PI/2+r+.01,-Math.PI/2+r-.01,!0),f.lineWidth=s,f.stroke(),f.closePath()}},He=t=>{const{spacing:e,at:n,downDistance:a,upDistance:o,lineWidth:r,rotation:s}=t,i=T({x:n.x,y:n.y-e},n,s),l=T({x:n.x+o,y:n.y-e},n,s),c=T({x:n.x+o,y:n.y+e},n,s),u=T({x:n.x+o-a,y:n.y+e},n,s),h=T({x:n.x+o,y:n.y},n,s),d=_({start:i,end:l,width:r}),g=pt({start:c,end:u,width:r}),y=vt({at:h,radius:e+r/2});return x=>d(x)||g(x)||y(x)},Dt=t=>()=>{const{spacing:e,at:n,upDistance:a,rotation:o,lineWidth:r}=t,s=T({x:n.x+a,y:n.y},n,o),i=Math.min(n.x,s.x)-r/2-e,l=Math.min(n.y,s.y)-r/2-e,c=Math.max(n.x,s.x)+r/2+e,u=Math.max(n.y,s.y)+r/2+e;return{at:{x:i,y:l},width:c-i,height:u-l}},Le=t=>{const e=Dt(t)(),n=W(e);return a=>n(a)},q=t=>{const{at:e,upDistance:n,rotation:a,textArea:o,spacing:r,lineWidth:s}={..._t,...t};if(!o)throw new Error("no text area provided");const{text:i}=o,{fontSize:l}={...$,...i},c=T({x:e.x+n+r+s/2,y:e.y},e,a);return{x:c.x-l+Math.cos(a)*15,y:c.y-l+Math.sin(a)*15}},Me=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),{width:a,height:o}=X(n),r=S({at:n.at,width:a,height:o});return s=>r(s)},zt=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),a=Y(n);return o=>a(o)},Rt=t=>{if(!t.textArea)return;const e=q(t),n=b(t.textArea,e),a=k(n);return o=>a(o)},Ce=t=>{const e=zt(t),n=Rt(t);if(!(!e||!n))return a=>{e(a),n(a)}},_t={color:"black",arrowHeadSize:yt,gradientStops:[]},pe=t=>{if(t.downDistance<0)throw new Error("downDistance must be positive");if(t.upDistance<0)throw new Error("upDistance must be positive");const e=Se(t),n=He(t),a=Me(t),o=Le(t),r=d=>(a==null?void 0:a(d))||n(d),s=Dt(t),i=Ce(t),l=zt(t),c=Rt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=q(t),x=b(t.textArea,y);N(d,x,g)};return{id:t.id??C(),name:"uturn",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:r,shapeHitbox:n,textHitbox:a,efficientHitbox:o,getBoundingBox:s,activateTextArea:h}},Be=t=>{const{at:e,size:n,rotation:a,lineWidth:o,borderRadius:r}={...Ut,...t},s=o/2,i=S({at:{x:e.x-n/2,y:e.y-s},width:n,height:o,rotation:a,borderRadius:r}),l=S({at:{x:e.x-s,y:e.y-n/2},width:o,height:n,rotation:a,borderRadius:r});return c=>i(c)||l(c)},Ot=t=>()=>{const{at:e,size:n}=t;return{at:{x:e.x-n/2,y:e.y-n/2},width:n,height:n}},Ie=t=>{const e=Ot(t)(),n=W(e);return a=>n(a)},Pe=t=>{const{at:e,size:n,rotation:a,color:o,lineWidth:r,borderRadius:s}={...Ut,...t},i=r/2;return l=>{et({at:{x:e.x-i,y:e.y-n/2},width:r,height:n,color:o,borderRadius:s,rotation:a})(l),et({at:{x:e.x-n/2,y:e.y-i},width:n,height:r,color:o,borderRadius:s,rotation:a})(l)}},Ut={rotation:0,color:"black",lineWidth:gt.width,borderRadius:0},We=t=>{if(t.lineWidth&&t.lineWidth<0)throw new Error("lineWidth must be positive");const e=Pe(t),n=Be(t),a=Ie(t),o=i=>n(i),r=Ot(t),s=i=>{e(i)};return{id:t.id??C(),name:"cross",draw:s,drawShape:e,shapeHitbox:n,hitbox:o,efficientHitbox:a,getBoundingBox:r}},De=t=>e=>{const{type:n,color:a,brushWeight:o,points:r}={...ct,...t};n==="draw"?(()=>{if(r.length===1){bt({at:r[0],radius:o/2,color:a}).draw(e);return}e.strokeStyle=a,e.lineCap="round",e.lineJoin="round",e.lineWidth=o,e.beginPath();const[l,...c]=r;e.moveTo(l.x,l.y),c.forEach(({x:u,y:h})=>e.lineTo(u,h)),e.stroke()})():(()=>{e.globalCompositeOperation="destination-out",e.lineWidth=tt;for(let l=0;l<r.length-1;l++){const c=r[l],u=r[l+1],h=Math.pow(u.x-c.x,2)+Math.pow(u.y-c.y,2),d=Math.sqrt(h),g=Math.ceil(d/tt);for(let y=0;y<=g;y++){const x=c.x+y/g*(u.x-c.x),H=c.y+y/g*(u.y-c.y);e.beginPath(),e.arc(x,H,tt,0,Math.PI*2),e.fill()}}e.globalCompositeOperation="source-over"})(),e.lineCap="butt",e.lineJoin="miter"},ze=t=>e=>{const{type:n,points:a,brushWeight:o}={...ct,...t};if(n==="erase")return!1;const{at:r,width:s,height:i}=it(t)();if(!S({at:r,width:Math.max(s,10),height:Math.max(i,10)})(e))return!1;if(a.length===1&&vt({at:a[0],radius:o})(e))return!0;for(let c=0;c<a.length-1;c++){const u={start:a[c],end:a[c+1]};if(at(u)({at:e,width:1,height:1}))return!0}return!1},it=t=>()=>{const{points:e}=t;let n=e[0].x,a=e[0].y,o=e[0].x,r=e[0].y;for(const s of e)s.x<n&&(n=s.x),s.y<a&&(a=s.y),s.x>o&&(o=s.x),s.y>r&&(r=s.y);return{at:{x:n,y:a},width:o-n,height:r-a}},Re=t=>e=>{if(t.type==="erase")return!1;const{at:n,width:a,height:o}=it(t)(),r=W({at:n,width:Math.max(a,10),height:Math.max(o,10)}),{points:s,brushWeight:i}={...ct,...t};if(s.length===1&&Vt({at:s[0],radius:i})(e))return!0;if(!r(e))return!1;for(let l=0;l<s.length-1;l++){const c={start:s[l],end:s[l+1]};if(at(c)(e))return!0}return!1},ct={color:"red",brushWeight:3},tt=50,_e=t=>{if(t.points.length<1)throw new Error("not enough points to draw scribble");if(t.brushWeight&&t.brushWeight<1)throw new Error('brushWeight must be at least "1"');const e=ze(t),n=Re(t),a=i=>e(i),o=it(t),r=De(t),s=i=>{r(i)};return{id:t.id??C(),name:"scribble",drawShape:r,draw:s,hitbox:a,shapeHitbox:e,efficientHitbox:n,getBoundingBox:o}},Oe=t=>e=>{const{at:n,radiusX:a,radiusY:o,color:r,stroke:s}={...Ft,...t};if(e.beginPath(),e.ellipse(n.x,n.y,a,o,0,0,2*Math.PI),e.fillStyle=r,e.fill(),s){const{color:i,width:l,dash:c}=s;e.strokeStyle=i,e.lineWidth=l,e.setLineDash(c||[]),e.stroke(),e.setLineDash([])}e.closePath()},Ue=t=>e=>{const n=e.x-t.at.x,a=e.y-t.at.y,o={...At,...t.stroke},r=t.radiusX+o.width/2,s=t.radiusY+o.width/2;return n*n/(r*r)+a*a/(s*s)<=1},Xt=t=>()=>{const{at:e,radiusX:n,radiusY:a}=t,{width:o}={...At,...t.stroke};return{at:{x:e.x-(n+o/2),y:e.y-(a+o/2)},width:2*n+o,height:2*a+o}},Xe=t=>{const e=Xt(t)(),n=W(e);return a=>n(a)},J=t=>{const{at:e,textArea:n}={...Ft,...t};if(!n)throw new Error("no text area provided");const{text:a}=n,{fontSize:o}={...$,...a};return{x:e.x-o,y:e.y-o}},Ye=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),{width:a,height:o}=X(n),r=S({at:n.at,width:a,height:o});return s=>r(s)},Yt=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),a=Y(n);return o=>a(o)},kt=t=>{if(!t.textArea)return;const e=J(t),n=b(t.textArea,e),a=k(n);return o=>a(o)},ke=t=>{const e=Yt(t),n=kt(t);if(!(!e||!n))return a=>{e(a),n(a)}},Ft=Qt,Fe=t=>{if(t.radiusX<0||t.radiusY<0)throw new Error("radius must be positive");const e=Oe(t),n=Ue(t),a=Ye(t),o=Xe(t),r=d=>(a==null?void 0:a(d))||n(d),s=Xt(t),i=ke(t),l=Yt(t),c=kt(t),u=d=>{e(d),i==null||i(d)},h=(d,g)=>{if(!t.textArea)return;const y=J(t),x=b(t.textArea,y);N(d,x,g)};return{id:C(),name:"ellipse",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:r,shapeHitbox:n,textHitbox:a,efficientHitbox:o,getBoundingBox:s,activateTextArea:h}},$e=t=>{const{at:e,innerRadius:n,outerRadius:a,points:o=5,rotation:r=0}=t,s=[];for(let i=0;i<o*2;i++){const l=i%2===0?a:n,c=i*Math.PI/o,u=Math.cos(c)*l,h=Math.sin(c)*l,d=T({x:u,y:h},{x:0,y:0},r);s.push({x:d.x+e.x,y:d.y+e.y})}return s},Ne=(t,e)=>{let n=!1;for(let a=0,o=e.length-1;a<e.length;o=a++){const r=e[a].x,s=e[a].y,i=e[o].x,l=e[o].y;s>t.y!=l>t.y&&(l-s!==0?t.x<(i-r)*(t.y-s)/(l-s)+r:t.x<r)&&(n=!n)}return n},Ge=t=>e=>{const n=$e(t);return Ne(e,n)},$t=t=>()=>{const{at:e,outerRadius:n}=t,a=n*2;return{at:{x:e.x-n,y:e.y-n},width:a,height:a}},Ze=t=>e=>{const n=$t(t)();return e.at.x<n.at.x+n.width&&e.at.x+e.width>n.at.x&&e.at.y<n.at.y+n.height&&e.at.y+e.height>n.at.y},je=t=>{const{at:e,color:n,innerRadius:a,outerRadius:o,rotation:r,points:s}={...qe,...t};if(s<3)throw new Error("star must have at least 3 points");if(a>=o)throw new Error("inner radius must be less than outer radius");if(a<0||o<0)throw new Error("radius values must be positive");return i=>{i.save(),i.beginPath(),i.translate(e.x,e.y),i.rotate(r);for(let l=0;l<s*2;l++){const c=l%2===0?o:a,u=l*Math.PI/s,h=Math.cos(u)*c,d=Math.sin(u)*c;l===0?i.moveTo(h,d):i.lineTo(h,d)}i.closePath(),i.fillStyle=n,i.fill(),i.restore()}},qe={color:"black",points:5,rotation:0},Je=t=>{const e=je(t),n=Ge(t),a=n,o=Ze(t),r=$t(t);return{id:t.id??C(),name:"star",draw:e,drawShape:e,hitbox:a,shapeHitbox:n,efficientHitbox:o,getBoundingBox:r}},Ke=te,Ve=we,Qe=bt,tn=ee,en=Ee,nn=ue,an=pe,Nt=We,on=_e,rn=Fe,sn=Je,vn={arrow:Ve,circle:Qe,line:Ke,rect:tn,square:en,triangle:nn,uturn:an,cross:Nt,scribble:on,ellipse:rn,star:sn},cn=()=>{const{class:t}=ne();return O(()=>{if(!t)return[];if(typeof t!="string")throw new Error("class attribute must be a string");return t.split(" ")})},ln=(t,e)=>{let n;return()=>{clearTimeout(n),n=setTimeout(t,e)}},un=.5,dn=5;function hn(t){const e=m(1),n=m({x:0,y:0}),a=r=>{if(!r.ctrlKey)return;r.preventDefault();const s=t.value;if(!s)return;const i=s.getBoundingClientRect(),l=r.clientX-i.left,c=r.clientY-i.top,u=r.deltaY<0?1.03:.97,h=Math.min(dn,Math.max(un,e.value*u));n.value.x=l-(l-n.value.x)*(h/e.value),n.value.y=c-(c-n.value.y)*(h/e.value),e.value=h,o()},o=()=>{const r=U(t);r.resetTransform(),r.translate(n.value.x,n.value.y),r.scale(e.value,e.value)};return ot(()=>{const r=t.value;if(!r)throw new Error("Canvas ref is not defined");r.addEventListener("wheel",a,{passive:!1})}),rt(()=>{const r=t.value;r&&r.removeEventListener("wheel",a)}),{scale:e,origin:n}}const xn=t=>{const e=V("pan-zoom-scale",0),n=V("pan-zoom-pan-x",0),a=V("pan-zoom-pan-y",0),o=()=>{const s=U(t),{a:i,e:l,f:c}=s.getTransform();e.value=i,n.value=l,a.value=c},r=()=>{U(t)};return ot(()=>{t.value&&(t.value.addEventListener("wheel",o),t.value.addEventListener("mousedown",o),t.value.addEventListener("mouseup",o),setTimeout(()=>r(),0))}),rt(()=>{t.value&&(t.value.removeEventListener("wheel",o),t.value.removeEventListener("mousedown",o),t.value.removeEventListener("mouseup",o))}),{track:o,apply:r,scale:e,panX:n,panY:a}},fn=t=>{const e=m(!0),n=m(!1),a=m({x:0,y:0}),o=m({x:0,y:0}),r=c=>{e.value&&t.value&&c.button===ae.middle&&(c.preventDefault(),n.value=!0,a.value={x:c.clientX,y:c.clientY},o.value={x:t.value.scrollLeft,y:t.value.scrollTop})},s=c=>{if(!n.value||!t.value)return;const u=a.value.x-c.clientX,h=a.value.y-c.clientY;t.value.scrollLeft=o.value.x+u,t.value.scrollTop=o.value.y+h},i=()=>{n.value=!1},l=c=>{if(!t.value)return;const{left:u=0,top:h=0,behavior:d}=c,g=u-window.screen.width/2,y=h-window.screen.height/2;t.value.scrollTo({left:g,top:y,behavior:d})};return{allowPanning:e,isPanning:O(()=>n.value),teleportTo:l,startPan:r,pan:s,endPan:i}},wn=["width","height"],gn=["width","height"],bn=oe({__name:"ResponsiveCanvas",props:{color:{},patternColor:{},canvasWidth:{},canvasHeight:{}},emits:["canvasRef","widthChange","heightChange"],setup(t,{emit:e}){const n=m(0),a=m(0),o=m(!0),r=m(),s=m(),i=t,l=O(()=>(i==null?void 0:i.canvasWidth)??5e3),c=O(()=>(i==null?void 0:i.canvasHeight)??3e3),u=e,h=["w-full","h-full","relative","overflow-auto"],d=cn(),g=O(()=>[...h,...d.value]),y=w=>{r.value=w,u("canvasRef",w)},x=m(),{height:H,width:p}=re(x),{startPan:B,pan:I,endPan:E}=fn(x),f=()=>{n.value=l.value,a.value=c.value},L=async()=>x.value??new Promise(w=>{const A=setInterval(()=>{x.value&&(clearInterval(A),w(x.value))},100)}),P=async()=>new Promise(w=>{const A=setInterval(()=>{s.value&&(w(U(s.value)),clearInterval(A))},100)}),v=async()=>{const w=await P();w.clearRect(0,0,n.value,a.value);const A=75,M=(D,z)=>{Nt({at:{x:D,y:z},size:2,color:i.patternColor}).draw(w)},Gt=n.value,Zt=a.value;for(let D=A/2;D<Gt;D+=A)for(let z=A/2;z<Zt;z+=A)M(D,z)},K=ln(v,250);(async()=>{v();const w=await L(),A=a.value/2-w.clientHeight/2;w.scrollTop=A;const M=n.value/2-w.clientWidth/2;w.scrollLeft=M,o.value=!1})(),R(H,()=>{f(),v(),u("widthChange",n.value)}),R(p,()=>{f(),v(),u("heightChange",a.value)}),R([l,c],()=>{f(),v(),u("widthChange",n.value),u("heightChange",a.value)}),R(()=>i.patternColor,v),se({canvasWidth:n,canvasHeight:a,getParentEl:L});const F=hn(r);return xn(r),R(F.scale,()=>{const{scale:w,origin:A}=F,M=U(s.value);M.clearRect(0,0,n.value,a.value),M.resetTransform(),M.translate(A.value.x,A.value.y),M.scale(w.value,w.value),K()}),ot(()=>{x.value&&(x.value.addEventListener("mousedown",B),x.value.addEventListener("mousemove",I),x.value.addEventListener("mouseup",E),x.value.addEventListener("mouseleave",E),x.value.addEventListener("contextmenu",w=>w.preventDefault()))}),rt(()=>{x.value&&(x.value.removeEventListener("mousedown",B),x.value.removeEventListener("mousemove",I),x.value.removeEventListener("mouseup",E),x.value.removeEventListener("mouseleave",E),x.value.removeEventListener("contextmenu",w=>w.preventDefault()))}),(w,A)=>(ft(),dt("div",{ref_key:"parentEl",ref:x,id:"responsive-canvas-container",class:Q(g.value)},[o.value?(ft(),dt("div",{key:0,style:ht({backgroundColor:w.color}),class:"absolute top-0 left-0 w-full h-full"},null,4)):ie("",!0),xt("canvas",{ref:y,id:"responsive-canvas",width:n.value,height:a.value,class:Q([`w-[${n.value}px]`,`h-[${a.value}px]`])},null,10,wn),xt("canvas",{ref_key:"bgCanvas",ref:s,width:n.value,height:a.value,style:ht({backgroundColor:w.color}),class:Q([`w-[${n.value}px]`,`h-[${a.value}px]`,"absolute","top-0","-z-10","pointer-events-none"])},null,14,gn)],2))}});export{bn as _,en as a,Ve as b,Qe as c,ln as d,an as e,Ke as l,tn as r,vn as s,cn as u};
