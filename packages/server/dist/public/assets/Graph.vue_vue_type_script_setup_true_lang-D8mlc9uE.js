import{v as m,T as Ae,z as Y,b4 as Q,b5 as ge,b6 as Ie,b7 as we,b8 as Be,b9 as De,ba as be,bb as Me,bc as _e,bd as Re,aa as ae,H as F,g as w,y as he,a7 as Z,be as Le,al as ke,am as Pe,bf as Fe,bg as Ee,u as Te,A as $,d as Oe,C as Ue,o as Ge}from"./index-D9-peFBB.js";import{c as ye,a as We,b as He,l as pe,e as Ke,g as Se,r as de,s as J,_ as qe}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-Zj62QpuQ.js";const te={nodeShape:"circle",nodeSize:35,nodeBorderWidth:8,nodeTextSize:24,nodeAnchorRadius:Math.ceil(Math.sqrt(35)*2),edgeWidth:10,edgeTextSize:20,nodeText:({label:e})=>e,edgeText:({label:e})=>e,edgeTextFontWeight:"bold",linkPreviewWidth:10},ze="rgb(100, 60, 70)",Ye={primaryColor:m.RED_700,secondaryColor:m.GRAY_900,tertiaryColor:m.RED_900,primaryTextColor:m.WHITE,secondaryTextColor:m.WHITE,tertiaryTextColor:m.WHITE,nodeBorderColor:m.BLACK,nodeColor:m.STONE_600,nodeTextColor:m.WHITE,nodeFocusBorderColor:m.RED_700,nodeFocusColor:ze,nodeFocusTextColor:m.WHITE,edgeColor:m.STONE_900,edgeFocusColor:m.RED_700,edgeFocusTextColor:m.WHITE,edgeTextColor:m.WHITE,graphBgColor:m.GRAY_600,graphBgPatternColor:m.WHITE+"15",nodeAnchorColorWhenParentFocused:m.RED_800,nodeAnchorColor:m.GRAY_900,linkPreviewColor:m.BLACK,marqueeSelectionBoxColor:m.WHITE+"15",marqueeSelectionBoxBorderColor:m.WHITE,marqueeEncapsulatedNodeBoxBorderColor:m.RED_700,marqueeEncapsulatedNodeBoxColor:m.RED_700+"20",...te},Ve={primaryColor:m.BLUE_500,secondaryColor:m.BLUE_700,tertiaryColor:m.BLUE_900,primaryTextColor:m.WHITE,secondaryTextColor:m.WHITE,tertiaryTextColor:m.WHITE,nodeColor:m.GRAY_50,nodeBorderColor:m.GRAY_800,nodeFocusBorderColor:m.BLUE_600,nodeFocusColor:m.BLUE_100,nodeTextColor:m.GRAY_900,nodeFocusTextColor:m.GRAY_900,edgeColor:m.GRAY_800,edgeTextColor:m.GRAY_900,edgeFocusColor:m.BLUE_600,edgeFocusTextColor:m.BLACK,graphBgColor:m.GRAY_200,graphBgPatternColor:m.BLACK+"15",nodeAnchorColor:m.BLACK,nodeAnchorColorWhenParentFocused:m.BLUE_900,linkPreviewColor:m.BLACK,marqueeSelectionBoxColor:m.BLUE_300+"15",marqueeSelectionBoxBorderColor:m.BLUE_500,marqueeEncapsulatedNodeBoxBorderColor:m.BLUE_700,marqueeEncapsulatedNodeBoxColor:m.BLUE_700+"05",...te},Je={primaryColor:m.PINK_500,secondaryColor:m.PINK_700,tertiaryColor:m.PINK_900,primaryTextColor:m.WHITE,secondaryTextColor:m.WHITE,tertiaryTextColor:m.WHITE,nodeColor:m.PINK_100,nodeBorderColor:m.PINK_400,nodeFocusBorderColor:m.PURPLE_600,nodeFocusColor:m.PURPLE_200,nodeTextColor:m.PINK_600,nodeFocusTextColor:m.PURPLE_900,edgeColor:m.PINK_600,edgeTextColor:m.PINK_600,edgeFocusColor:m.PURPLE_600,edgeFocusTextColor:m.PURPLE_600,graphBgColor:m.PINK_200,graphBgPatternColor:m.PINK_900+"15",nodeAnchorColor:m.PINK_500,nodeAnchorColorWhenParentFocused:m.PURPLE_700,linkPreviewColor:m.PINK_900,marqueeSelectionBoxColor:m.PINK_300+"15",marqueeSelectionBoxBorderColor:m.PINK_500,marqueeEncapsulatedNodeBoxBorderColor:m.PINK_700,marqueeEncapsulatedNodeBoxColor:m.PINK_700+"05",...te},ee={light:Ve,dark:Ye,girl:Je},Ze=(e,o)=>{const t=Ae();Y(t,()=>{const a=e.theme.value;t.value?Object.assign(a,{...ee.dark,...o}):Object.assign(a,{...ee.light,...o})},{immediate:!0})},je=e=>({getConnectedNodes:o=>Q(o,e),getConnectedEdges:o=>ge(o,e),getInboundEdges:o=>Ie(o,e),getOutboundEdges:o=>we(o,e),isEdgeFlowingIntoNode:(o,t)=>Be(o,t,e),isEdgeFlowingOutOfNode:(o,t)=>De(o,t,e),getEdgesAlongPath:(o,t)=>be(o,t,e),getEdgeWeight:o=>Me(o,e),getWeightBetweenNodes:(o,t)=>_e(o,t,e)}),Xe=(e,o)=>{const t=o("nodeColor",e),a=o("nodeBorderColor",e),s=o("nodeSize",e),d=o("nodeBorderWidth",e),b=o("nodeText",e),c=o("nodeTextSize",e),f=o("nodeTextColor",e),g=o("nodeShape",e),y=ye({at:{x:e.x,y:e.y},radius:s,color:t,stroke:{color:a,width:d},textArea:{text:{content:b,fontSize:c,fontWeight:"bold",color:f},color:m.TRANSPARENT}}),E=We({at:{x:e.x-s,y:e.y-s},size:s*2,color:t,stroke:{color:a,width:d},textArea:{text:{content:b,fontSize:c,fontWeight:"bold",color:f},color:m.TRANSPARENT}});return{shape:g==="circle"?y:E,id:e.id,graphType:"node"}},Qe=1.618,ue=2,$e=(e,o)=>{const{displayEdgeLabels:t,isGraphDirected:a}=o.settings.value,[s,d]=Q(e.id,o),c=be(s.id,d.id,o).length>1,f=d===s,g=o.getTheme("nodeBorderWidth",s),y=o.getTheme("nodeBorderWidth",d),E=o.getTheme("nodeSize",s),n=o.getTheme("nodeSize",d),r=Math.atan2(d.y-s.y,d.x-s.x),C=y/2+ue,I={x:(n+C)*Math.cos(r),y:(n+C)*Math.sin(r)},N={x:s.x,y:s.y},l={x:d.x-(a?I.x:0),y:d.y-(a?I.y:0)},i=o.getTheme("edgeWidth",e),h=i*1.2;c&&(N.x+=Math.cos(r+Math.PI/2)*h,N.y+=Math.sin(r+Math.PI/2)*h,l.x+=Math.cos(r+Math.PI/2)*h,l.y+=Math.sin(r+Math.PI/2)*h);const u=Re(N,o.edges.value.filter(L=>(L.from===s.id||L.to===d.id)&&L.from!==L.to).map(L=>{const[W,O]=Q(L.id,o);return s.id===W.id?{x:O.x,y:O.y}:{x:W.x,y:W.y}}).filter((L,W,O)=>W===O.findIndex(V=>V.x===L.x&&V.y===L.y))),v=o.getTheme("edgeColor",e),p=o.getTheme("edgeTextColor",e),A=o.getTheme("graphBgColor"),B=o.getTheme("edgeText",e),T=o.getTheme("edgeTextSize",e),x=o.getTheme("edgeTextFontWeight",e),_=t?{color:A,activeColor:A,text:{content:B,color:p,fontSize:T,fontWeight:x}}:void 0,R=(E+g)*Qe,P=R-(E+g/2)-ue;if(f)return{shape:He({spacing:i*1.2,at:{x:s.x,y:s.y},upDistance:R,downDistance:P,rotation:u,lineWidth:i,color:v,textArea:_}),id:e.id,graphType:"edge"};const G=E+g/2+n+y/2,U=(s.x-d.x)**2+(s.y-d.y)**2;if(G**2>U)return;if(!a)return{shape:pe({start:N,end:l,width:i,color:v,textArea:_}),id:e.id,graphType:"edge"};const K=E>=50?.9:E>=25?1:1.3;return{shape:Ke({start:N,end:l,width:i,textOffsetFromCenter:E**K,color:v,textArea:_}),id:e.id,graphType:"edge"}},eo=()=>({primaryColor:[],secondaryColor:[],tertiaryColor:[],primaryTextColor:[],secondaryTextColor:[],tertiaryTextColor:[],nodeSize:[],nodeBorderWidth:[],nodeColor:[],nodeBorderColor:[],nodeFocusColor:[],nodeFocusBorderColor:[],nodeText:[],nodeFocusTextColor:[],nodeTextSize:[],nodeTextColor:[],nodeShape:[],edgeColor:[],edgeWidth:[],edgeText:[],edgeTextSize:[],edgeTextColor:[],edgeFocusTextColor:[],edgeTextFontWeight:[],edgeFocusColor:[],graphBgColor:[],graphBgPatternColor:[],nodeAnchorRadius:[],nodeAnchorColor:[],nodeAnchorColorWhenParentFocused:[],linkPreviewColor:[],linkPreviewWidth:[],marqueeSelectionBoxColor:[],marqueeSelectionBoxBorderColor:[],marqueeEncapsulatedNodeBoxColor:[],marqueeEncapsulatedNodeBoxBorderColor:[]}),oo=e=>Object.prototype.toString.call(e)==="[object Object]",oe=(e,o)=>{const t={};if(!e)return o;if(!o)return null;const a=Object.keys(e),s=Object.keys(o);for(const d of s)a.includes(d)||(t[d]=o[d]);for(const d of a){if(oo(e[d])){const b=oe(e[d],o[d]);b&&(t[d]=b);continue}if(Array.isArray(e[d])){JSON.stringify(e[d])!==JSON.stringify(o[d])&&(t[d]=o[d]);continue}else e[d]!==o[d]&&(t[d]=o[d])}return Object.keys(t).length?t:null},q=e=>{const o={...e};for(const t in o)typeof o[t]=="object"&&(o[t]=q(o[t]));return o},to=e=>({subscribe:(o,t)=>e[o].add(t),unsubscribe:(o,t)=>e[o].delete(t),emit:(o,...t)=>{for(const a of e[o])a(...t)}}),no=()=>({onStructureChange:new Set,onNodeAdded:new Set,onBulkNodeAdded:new Set,onNodeRemoved:new Set,onBulkNodeRemoved:new Set,onNodeMoved:new Set,onBulkNodeMoved:new Set,onEdgeAdded:new Set,onBulkEdgeAdded:new Set,onEdgeRemoved:new Set,onBulkEdgeRemoved:new Set,onEdgeLabelEdited:new Set,onRepaint:new Set,onNodeHoverChange:new Set,onGraphLoaded:new Set,onGraphReset:new Set,onClick:new Set,onMouseDown:new Set,onMouseUp:new Set,onMouseMove:new Set,onDblClick:new Set,onContextMenu:new Set,onKeyDown:new Set,onKeyUp:new Set,onThemeChange:new Set,onSettingsChange:new Set,onUndo:new Set,onRedo:new Set,onFocusChange:new Set,onNodeDragStart:new Set,onNodeDrop:new Set,onNodeAnchorDragStart:new Set,onNodeAnchorDrop:new Set,onGroupDragStart:new Set,onGroupDrop:new Set}),ie=e=>e==null,so=e=>{const o=e.trim().split("/").filter(Boolean);if(o.length!==2)return!1;const[t,a]=o.map(Number);return!(ie(t)||ie(a))},ro=e=>{if(!so(e))return;const o=e.split("/"),[t,a]=o.map(Number);return t/a},ao={displayEdgeLabels:!0,edgeLabelsEditable:!0,edgeInputToLabel:e=>{var a;const o=e.trim();if(!o)return;const t=(a=ro(o))==null?void 0:a.toFixed(2);return t==="Infinity"?"∞":t==="-Infinity"?"-∞":t===void 0&&isNaN(Number(o))?void 0:t??o},newNodeLabelGetter:null,isGraphDirected:!0},uo={focusable:!0,focusBlacklist:[]},io={draggable:!0},co={nodeAnchors:!0},lo={marquee:!0,marqueeSelectableGraphTypes:["node","edge"]},fo={userEditable:!0,userAddedEdgeLabel:"1",userAddedEdgeRuleNoSelfLoops:!1,userAddedEdgeRuleOneEdgePerPath:!1},vo={persistent:!0,persistentStorageKey:"graph",persistentBlacklist:new Set},mo={},go={...ao,...uo,...io,...co,...lo,...fo,...vo,...mo},bo=(e,o)=>(t,...a)=>{const s=o[t].findLast(b=>{const c=b.value;return ae(c,...a)!==void 0}),d=(s==null?void 0:s.value)??e.value[t];if(!d)throw new Error(`Theme property "${t}" not found`);return ae(d,...a)},ho=(e,o)=>{const t=F(()=>{const s=new Map;for(const d of e.value)s.set(d.id,d);return s}),a=F(()=>{const s=new Map;for(const d of o.value)s.set(d.id,d);return s});return{nodeIdToNodeMap:t,edgeIdToEdgeMap:a}},Eo=({canvas:e,emit:o})=>{const t=w([]),a=[],s=()=>{var n,r,C,I;if(!e.value)return;const c=e.value.getContext("2d");if(!c)return;c.clearRect(0,0,e.value.width,e.value.height);const f=a.reduce((N,l)=>l(N),[]);t.value=[...f.sort((N,l)=>N.priority-l.priority)];const g=t.value.findLastIndex(N=>N.graphType==="edge"),y=t.value.slice(0,g+1),E=t.value.slice(g+1);for(const N of y)N.shape.drawShape(c);for(const N of y)(r=(n=N.shape).drawTextAreaMatte)==null||r.call(n,c);for(const N of y)(I=(C=N.shape).drawText)==null||I.call(C,c);for(const N of E)N.shape.draw(c);o("onRepaint",c,"loop")},d=setInterval(s,1e3/60);return he(()=>{clearInterval(d)}),setTimeout(s,1e3),{aggregator:t,updateAggregator:a,getSchemaItemsByCoordinates:c=>t.value.sort((f,g)=>f.priority-g.priority).filter(f=>{var g,y;return f.shape.shapeHitbox(c)||((y=(g=f.shape).textHitbox)==null?void 0:y.call(g,c))})}},To={broadcast:!0,focus:!0,history:!0},yo={broadcast:!0,focus:!1,history:!0},ce={broadcast:!0,history:!0},X={broadcast:!0,focus:!1,history:!0},le={broadcast:!0,history:!0},po={broadcast:!0},So={label:""},Co="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");Array.from({length:999},(e,o)=>(o+1).toString());const No=(e,o)=>()=>{let t=e.value.map(({label:c})=>c),a=0,s=0,d;const b=()=>a===0?"":o[(a-1)%o.length];for(;!d;){s>=o.length&&(t=t.slice(o.length),s=0,a++);const f=b()+o[s];t.includes(f)||(d=f),s++}return d},xo=e=>No(e.nodes,Co),Ao=({nodes:e,edges:o,nodeMap:t,edgeMap:a,emit:s,settings:d})=>{const b=i=>t.value.get(i),c=i=>a.value.get(i),f=(i,h={})=>{if(i!=null&&i.id&&b(i.id)){console.warn("prevented adding a node with an existing id, this shouldn't happen");return}const u={...To,...h},v=d.value.newNodeLabelGetter??xo({nodes:e}),p={id:i.id??Z(),label:i.label??v(),x:i.x??0,y:i.y??0};return e.value.push(p),s("onNodeAdded",p,u),s("onStructureChange"),p},g=(i,h={})=>{if(i.length===0)return;const u={...yo,...h},v=[];for(const p of i){const A=f(p,{focus:!1,broadcast:!1,history:!1});A&&v.push(A)}v.length!==0&&s("onBulkNodeAdded",v,u)},y=(i,h={})=>{const u={...X,...h},{isGraphDirected:v}=d.value,[p,A]=[b(i.from),b(i.to)];if(!p||!A)return;if(v){if(o.value.find(x=>x.from===i.from&&x.to===i.to))return}else if(o.value.find(x=>x.from===i.from&&x.to===i.to||x.from===i.to&&x.to===i.from))return;const B={...So,id:Z(),...i};return o.value.push(B),s("onEdgeAdded",B,u),s("onStructureChange"),B},E=(i,h={})=>{if(i.length===0)return;const u={...X,...h},v=[];for(const p of i){const A=y(p,{broadcast:!1,history:!1});A&&v.push(A)}v.length!==0&&s("onBulkEdgeAdded",v,u)},n=(i,h,u={})=>{const v=b(i);if(!v)return;const p={...po,...u};v.x=h.x,v.y=h.y,s("onNodeMoved",v,p)},r=(i,h,u={})=>{const v={...X,...u},p=c(i);if(!p)return;const A=p.label;p.label=h,s("onEdgeLabelEdited",p,A,v),s("onStructureChange")},C=(i,h={})=>{const u=b(i);if(!u)return;const v={...ce,...h},A=ge(u.id,{edges:o,getEdge:c,settings:d}).map(B=>N(B.id,{broadcast:!1,history:!1})).filter(Boolean);return e.value=e.value.filter(B=>B.id!==u.id),s("onNodeRemoved",u,A,v),s("onStructureChange"),[u,A]},I=(i,h={})=>{if(i.length===0)return;const u={...ce,...h},v=[],p=[];for(const A of i){const B=C(A,{broadcast:!1,history:!1});if(!B)continue;const[T,x]=B;v.push(T),p.push(...x)}v.length!==0&&s("onBulkNodeRemoved",v,p,u)},N=(i,h={})=>{const u=c(i);if(!u)return;const v={...le,...h};return o.value=o.value.filter(p=>p.id!==u.id),s("onEdgeRemoved",u,v),s("onStructureChange"),u};return{getNode:b,getEdge:c,addNode:f,addEdge:y,moveNode:n,editEdgeLabel:r,removeNode:C,removeEdge:N,bulkAddNode:g,bulkRemoveNode:I,bulkAddEdge:E,bulkRemoveEdge:(i,h={})=>{if(i.length===0)return;const u={...le,...h},v=[];for(const p of i){const A=N(p,{broadcast:!1,history:!1});A&&v.push(A)}if(v.length!==0)return s("onBulkEdgeRemoved",v,u),v}}},Io=({subscribe:e,canvas:o,graphAtMousePosition:t})=>{const a=w(!1),s=w(!1),d=w({node:"grab",edge:"pointer","node-anchor":"grab","encapsulated-node-box":"move"}),b=w(),c=F(()=>!!b.value),f=n=>{b.value=n},g=()=>{b.value=void 0},y=n=>{var C;if(!n)return"default";if(c.value)return((C=b.value)==null?void 0:C.call(b,n))??!1?"pointer":"default";const r=d.value[n.graphType]??"default";return r==="grab"&&a.value?"grabbing":r},E=({items:n})=>{if(!o.value||s.value)return;const r=n.at(-1);o.value.style.cursor=y(r)};return e("onMouseDown",n=>{a.value=!0,E(n)}),e("onMouseUp",n=>{a.value=!1,E(n)}),e("onMouseMove",E),Y(d,()=>{E({items:t.value.items})},{deep:!0}),{graphToCursorMap:d,activateCursorSelectMode:f,deactivateCursorSelectMode:g,graphCursorDisabled:s}},wo=(e,o={})=>{const t=w({...ee.light,...o.theme}),a=eo(),s=bo(t,a),d=w({...go,...o.settings}),b=no(),{subscribe:c,unsubscribe:f,emit:g}=to(b),y=w(!0);Le(e,()=>{y.value=!1}),c("onMouseDown",()=>{y.value=!0});const E=w([]),n=w([]),r=w({coords:{x:0,y:0},items:[]}),C=Io({canvas:e,subscribe:c,graphAtMousePosition:r}),I=S=>{const M=Se(e),k=Fe(S,M);r.value={coords:k,items:v(k)}},N=S=>({...r.value,event:S}),l={click:S=>{S.preventDefault(),g("onClick",N(S))},mousemove:S=>{S.preventDefault(),g("onMouseMove",N(S))},mousedown:S=>{S.preventDefault(),g("onMouseDown",N(S))},mouseup:S=>{S.preventDefault(),g("onMouseUp",N(S))},dblclick:S=>{S.preventDefault(),g("onDblClick",N(S))},contextmenu:S=>{S.preventDefault(),g("onContextMenu",N(S))}},i={keydown:S=>g("onKeyDown",S),keyup:S=>g("onKeyUp",S)},{aggregator:h,updateAggregator:u,getSchemaItemsByCoordinates:v}=Eo({canvas:e,emit:g}),p=S=>{const M={edges:n,getNode:T,getEdge:x,getTheme:s,settings:d},k=n.value.map(H=>$e(H,M)).filter(Boolean).map((H,j)=>({...H,priority:j*10})),xe=E.value.map(H=>Xe(H,s)).filter(Boolean).map((H,j)=>({...H,priority:j*10+1e3}));return S.push(...k),S.push(...xe),S};u.push(p),ke(()=>{if(!e.value)throw new Error("canvas element not found");e.value.addEventListener("mousemove",I);for(const[S,M]of Object.entries(l))e.value.addEventListener(S,M);for(const[S,M]of Object.entries(i))document.addEventListener(S,M)}),Pe(()=>{if(!e.value)throw new Error("Canvas element not found");e.value.removeEventListener("mousemove",I);for(const[S,M]of Object.entries(l))e.value.removeEventListener(S,M);for(const[S,M]of Object.entries(i))document.removeEventListener(S,M)});const{nodeIdToNodeMap:A,edgeIdToEdgeMap:B}=ho(E,n),{getNode:T,getEdge:x,addNode:D,addEdge:_,moveNode:R,editEdgeLabel:P,removeNode:G,removeEdge:U,bulkAddNode:z,bulkRemoveNode:K,bulkAddEdge:ne,bulkRemoveEdge:L}=Ao({nodes:E,edges:n,nodeMap:A,edgeMap:B,emit:g,settings:d}),W=(S,M)=>{const k=v({x:S,y:M}).pop();if(k&&k.graphType==="node")return T(k.id)};let O;c("onMouseMove",({items:S})=>{const M=S.at(-1);if(!M||M.graphType!=="node")return;const k=T(M.id);k!==O&&(g("onNodeHoverChange",k,O),O=k)});const V=S=>(O&&Ee(O.id,S),S);u.push(V);const Ce=S=>{E.value=S.nodes,n.value=S.edges,g("onGraphLoaded"),g("onStructureChange")},Ne=()=>{E.value=[],n.value=[],g("onGraphReset"),g("onStructureChange")},se=w(q(t.value));Y(t,S=>{const M=oe(se.value,t.value);M&&(se.value=q(S),g("onThemeChange",M))},{deep:!0});const re=w(q(d.value));return Y(d,S=>{const M=oe(re.value,S);M&&(re.value=q(d.value),g("onSettingsChange",M))},{deep:!0}),{nodes:E,edges:n,getNode:T,getEdge:x,addNode:D,addEdge:_,moveNode:R,editEdgeLabel:P,removeNode:G,removeEdge:U,bulkAddNode:z,bulkRemoveNode:K,bulkAddEdge:ne,bulkRemoveEdge:L,getSchemaItemsByCoordinates:v,getNodeByCoordinates:W,eventBus:b,subscribe:c,unsubscribe:f,emit:g,updateAggregator:u,aggregator:h,theme:t,getTheme:s,themeMap:a,settings:d,load:Ce,reset:Ne,canvas:e,canvasFocused:y,graphAtMousePosition:r,updateGraphAtMousePosition:I,...C}},Bo="use-marquee-graph",Do={THEME_ID:Bo},Mo=e=>{const o=w(),t=w(),a=w(),{setTheme:s,removeTheme:d}=Te(e,Do.THEME_ID),b=()=>s("nodeAnchorColor",m.TRANSPARENT),c=()=>d("nodeAnchorColor"),f=T=>{const{width:x,height:D}=T;return Math.abs(x*D)},g=({items:T,coords:x})=>{const D=T.at(-1);(D==null?void 0:D.graphType)!=="encapsulated-node-box"&&c(),D||C(x)},y=({items:T,coords:x})=>{if(!a.value)return;const D=T.at(-1);if((D==null?void 0:D.graphType)!=="encapsulated-node-box")return;const _=x.x-a.value.x,R=x.y-a.value.y;a.value=x;for(const P of e.focusedNodes.value)e.moveNode(P.id,{x:P.x+_,y:P.y+R});l()},E=({items:T,coords:x})=>{if(o.value)return;const D=T.at(-1);(D==null?void 0:D.graphType)==="encapsulated-node-box"&&(a.value=x,e.emit("onGroupDragStart",e.focusedNodes.value,x))},n=()=>{a.value&&(e.emit("onGroupDrop",e.focusedNodes.value,a.value),a.value=void 0)},r=()=>t.value={at:{x:1/0,y:1/0},width:0,height:0},C=T=>{b(),e.graphCursorDisabled.value=!0,o.value={at:T,width:0,height:0},r()},I=()=>{o.value&&(o.value=void 0,e.graphCursorDisabled.value=!1,c())},N=T=>{if(f(T)<100)return;const D=[];for(const{id:_,shape:R,graphType:P}of e.aggregator.value){const{marqueeSelectableGraphTypes:G}=e.settings.value;if(!G.includes(P))continue;R.efficientHitbox(T)&&D.push(_)}e.setFocus(D)},l=()=>{if(!t.value)return;if(e.focusedNodes.value.length<2)return r();let T=1/0,x=1/0,D=-1/0,_=-1/0;for(const R of e.focusedNodes.value){const P=e.getTheme("nodeSize",R),G=e.getTheme("nodeBorderWidth",R),U=P+G/2,{x:z,y:K}=R;T=Math.min(T,z-U),x=Math.min(x,K-U),D=Math.max(D,z+U),_=Math.max(_,K+U)}T<1/0&&x<1/0&&D>-1/0&&_>-1/0?(t.value.at.x=T,t.value.at.y=x,t.value.width=D-T,t.value.height=_-x):(t.value.width=0,t.value.height=0)},i=({coords:T})=>{if(!o.value)return;const{x,y:D}=T;o.value.width=x-o.value.at.x,o.value.height=D-o.value.at.y,N(o.value)},h=T=>({id:"marquee-box",graphType:"marquee-box",shape:de({...T,color:e.getTheme("marqueeSelectionBoxColor"),stroke:{color:e.getTheme("marqueeSelectionBoxBorderColor"),width:2}}),priority:1/0}),u=T=>{if(!o.value)return T;const x=h(o.value);return T.push(x),T},v=T=>({id:"encapsulated-node-box",graphType:"encapsulated-node-box",shape:de({...T,color:e.getTheme("marqueeEncapsulatedNodeBoxColor"),stroke:{color:e.getTheme("marqueeEncapsulatedNodeBoxBorderColor"),width:2}}),priority:1/0}),p=T=>{if(!t.value)return T;const x=v(t.value);return T.push(x),T};e.updateAggregator.push(p),e.updateAggregator.push(u);const A=()=>{e.subscribe("onFocusChange",l),e.subscribe("onMouseDown",g),e.subscribe("onMouseUp",I),e.subscribe("onContextMenu",I),e.subscribe("onMouseMove",i),e.subscribe("onMouseDown",E),e.subscribe("onMouseUp",n),e.subscribe("onMouseMove",y),e.subscribe("onUndo",l),e.subscribe("onRedo",l)},B=()=>{e.unsubscribe("onFocusChange",l),e.unsubscribe("onMouseDown",g),e.unsubscribe("onMouseUp",I),e.unsubscribe("onContextMenu",I),e.unsubscribe("onMouseMove",i),e.unsubscribe("onMouseDown",E),e.unsubscribe("onMouseUp",n),e.unsubscribe("onMouseMove",y),e.unsubscribe("onUndo",l),e.unsubscribe("onRedo",l),o.value&&I()};return e.subscribe("onSettingsChange",T=>{T.marquee===!0?A():T.marquee===!1&&B()}),e.settings.value.marquee&&A(),{updateEncapsulatedNodeBox:l}},_o=e=>{const o=w(),t=({items:c,coords:f})=>{const g=c.at(-1);if(!g||g.graphType!=="node")return;e.settings.value.nodeAnchors=!1;const y=e.getNode(g.id);y&&(o.value={node:y,coords:f},e.emit("onNodeDragStart",y))},a=()=>{o.value&&(e.emit("onNodeDrop",o.value.node),e.settings.value.nodeAnchors=!0,e.nodeAnchorSetParentNode(o.value.node.id),o.value=void 0)},s=({coords:c})=>{if(!o.value)return;const{node:f,coords:g}=o.value,y=c.x-g.x,E=c.y-g.y;e.moveNode(f.id,{x:f.x+y,y:f.y+E}),o.value.coords=c},d=()=>{e.subscribe("onMouseDown",t),e.subscribe("onMouseUp",a),e.subscribe("onMouseMove",s)},b=()=>{e.unsubscribe("onMouseDown",t),e.unsubscribe("onMouseUp",a),e.unsubscribe("onMouseMove",s),o.value&&a()};return e.subscribe("onSettingsChange",c=>{c.draggable===!1?b():c.draggable===!0&&d()}),e.settings.value.draggable&&d(),{activeDragNode:F(()=>{var c;return(c=o.value)==null?void 0:c.node})}},Ro=e=>{const o=w(),t=w(),a=u=>{const v=e.getNode(u);if(!v)throw new Error("node not found");o.value=v,c(v)},s=()=>{o.value=void 0,t.value=void 0},d=u=>{const{getTheme:v}=e,p=v("nodeAnchorColor",u),A=v("nodeAnchorRadius",u),B=[];for(const T of b.value){const{x,y:D}=T,_={at:{x,y:D},radius:A,color:p};t.value&&t.value.direction===T.direction&&(_.at.x=t.value.x,_.at.y=t.value.y);const R=ye(_);B.push({id:T.id,graphType:"node-anchor",shape:R,priority:1/0})}return B},b=w([]),c=u=>{if(!u)return b.value=[];const{getTheme:v}=e,p=v("nodeAnchorRadius",u),A=v("nodeSize",u),B=v("nodeBorderWidth",u),T=A-p/3+B/2;b.value=[{x:u.x,y:u.y-T,direction:"north"},{x:u.x+T,y:u.y,direction:"east"},{x:u.x,y:u.y+T,direction:"south"},{x:u.x-T,y:u.y,direction:"west"}].map(x=>({...x,id:Z()}))},f=({items:u})=>{const v=u.at(-1);if(!v||v.graphType!=="node-anchor")return;const{id:p}=v;return b.value.find(A=>A.id===p)},g=()=>{if(!o.value||!t.value)return;const{x:u,y:v}=t.value,p={x:o.value.x,y:o.value.y},A={x:u,y:v},{getTheme:B}=e,T=B("linkPreviewColor",o.value,t.value),x=B("linkPreviewWidth",o.value,t.value);return{id:"link-preview",graphType:"link-preview",shape:pe({start:p,end:A,color:T,width:x})}},y=({items:u})=>{if(t.value)return;const v=u.at(-1);if(!v)return s();if(v.graphType!=="node")return;const p=e.getNode(v.id);if(!p)throw new Error("node in aggregator but not in graph");const A=e.isFocused(p.id),B=e.focusedNodes.value.length>1;if(A&&B)return s();o.value=p,c(p)},E=u=>{if(!o.value)return;const v=f(u);v&&(t.value=v,e.emit("onNodeAnchorDragStart",o.value,v))},n=({coords:u})=>{if(!t.value)return;const{x:v,y:p}=u;t.value.x=v,t.value.y=p},r=()=>{if(t.value){if(!o.value)throw new Error("active anchor without parent node")}else return;e.emit("onNodeAnchorDrop",o.value,t.value),s()},C=u=>{if(!o.value)return u;const v=d(o.value);for(const p of v)u.push(p);return u},I=u=>{var T;if(!o.value||!t.value)return u;const{id:v}=o.value;Ee(v,u);const p=(T=u.find(x=>x.id===v))==null?void 0:T.priority;if(!p)return u;const A=g();if(!A)return u;const B={...A,priority:p-.1};return u.push(B),u};e.updateAggregator.push(C),e.updateAggregator.push(I);const N=u=>{var v;((v=o.value)==null?void 0:v.id)===u.id&&s()},l=()=>{if(!o.value)return;const u=e.isFocused(o.value.id),v=e.focusedNodes.value.length>1;u&&v&&s()},i=()=>{e.subscribe("onNodeRemoved",N),e.subscribe("onNodeMoved",s),e.subscribe("onNodeDrop",c),e.subscribe("onMouseMove",y),e.subscribe("onMouseMove",n),e.subscribe("onMouseDown",E),e.subscribe("onMouseUp",r),e.subscribe("onFocusChange",l)},h=()=>{e.unsubscribe("onNodeRemoved",N),e.unsubscribe("onNodeMoved",s),e.unsubscribe("onNodeDrop",c),e.unsubscribe("onMouseMove",y),e.unsubscribe("onMouseMove",n),e.unsubscribe("onMouseDown",E),e.unsubscribe("onMouseUp",r),e.unsubscribe("onFocusChange",l),s()};return e.subscribe("onSettingsChange",u=>{u.nodeAnchors===!0?i():u.nodeAnchors===!1&&h()}),e.settings.value.nodeAnchors&&i(),{nodeAnchorActiveAnchor:$(t),nodeAnchorParentNode:$(o),nodeAnchorSetParentNode:a}},Lo=(e=!1)=>{const o=c=>c.key===" "?"Space":c.key.length>1||e?c.key:c.key.toUpperCase(),t=w(""),a=F(()=>{let c;return t.value.split("+").filter(f=>{const g=f===c;return c=f,!g}).join("+")}),s=c=>{t.value.length>0&&(t.value+="+"),t.value+=o(c)},d=()=>{t.value=""},b=c=>a.value===c;return document.addEventListener("keydown",s),document.addEventListener("keyup",d),he(()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",d)}),{isPressed:b,currentKeyString:t}},ko=e=>{const o=({coords:E,event:n})=>{e.addNode(E),setTimeout(()=>e.updateGraphAtMousePosition(n),10)},t=(E,n)=>{const C=e.getSchemaItemsByCoordinates(n).findLast(N=>N.graphType==="node");if(!C)return;const I=e.getNode(C.id);if(I&&!(e.settings.value.userAddedEdgeRuleNoSelfLoops&&E.id===I.id)){if(e.settings.value.userAddedEdgeRuleOneEdgePerPath){const N=e.edges.value.find(h=>h.from===E.id&&h.to===I.id),l=e.edges.value.find(h=>h.from===I.id&&h.to===E.id);if(N||l)return}e.addEdge({from:E.id,to:I.id,label:e.settings.value.userAddedEdgeLabel})}},a=()=>{e.bulkRemoveNode([...e.focusedItemIds.value]),e.bulkRemoveEdge([...e.focusedItemIds.value])},s={Mac:{"Meta+Z":()=>e.undo(),"Shift+Meta+Z":()=>e.redo(),"Meta+Shift+Z":()=>e.redo(),Backspace:a,"Meta+A":e.focusAll,Escape:e.resetFocus},Windows:{"Control+Z":()=>e.undo(),"Shift+Control+Z":()=>e.redo(),"Control+Shift+Z":()=>e.redo(),Backspace:a,"Control+A":e.focusAll,Escape:e.resetFocus}},d=window.navigator.userAgent.includes("Mac")?"Mac":"Windows",{isPressed:b}=Lo(),f={onDblClick:o,onKeyDown:E=>{if(e.settings.value.userEditable===!1||e.canvasFocused.value===!1)return;const n=s[d];for(const r in n)b(r)&&(n[r](),E.preventDefault())},onNodeAnchorDrop:t},g=()=>{for(const E in f)e.subscribe(E,f[E]);e.settings.value.nodeAnchors=!0,e.settings.value.edgeLabelsEditable=!0},y=()=>{for(const E in f)e.unsubscribe(E,f[E]);e.settings.value.nodeAnchors=!1,e.settings.value.edgeLabelsEditable=!1};e.settings.value.userEditable&&g(),e.subscribe("onSettingsChange",E=>{E.userEditable===!0?g():E.userEditable===!1&&y()})},Po=[m.RED_600,m.BLUE_600,m.GREEN_600,m.YELLOW_600],Fo=[3,6,9,12],fe=100,Oo=e=>{const o=w([]),t=w([]);return{clearHistory:()=>{o.value=[],t.value=[]},undo:()=>{const f=o.value.pop();if(!f)return;const{action:g,annotations:y}=f,E=y.map(({id:n})=>n);g==="add"?e.value=e.value.filter(({id:n})=>!E.includes(n)):g==="remove"&&e.value.push(...y),t.value.push(f)},redo:()=>{const f=t.value.pop();if(!f)return;const{action:g,annotations:y}=f,E=y.map(({id:n})=>n);g==="add"?e.value.push(...y):g==="remove"&&(e.value=e.value.filter(({id:n})=>!E.includes(n))),o.value.push(f)},addToUndoStack:f=>{o.value.push(f),o.value.length>fe&&o.value.shift()},addToRedoStack:f=>{t.value.push(f),t.value.length>fe&&t.value.shift()},canUndo:F(()=>o.value.length!==0),canRedo:F(()=>t.value.length!==0)}},Uo=e=>{const o=w(Po[0]),t=w(Fo[1]),a=w(!1),s=w(new Set),d=w([]),b=w([]),c=w(!1),f=w(),g=w(!1),y=Oo(b),E=()=>{b.value.length!==0&&(y.addToUndoStack({action:"remove",annotations:b.value}),b.value=[])},n=({coords:i})=>{c.value=!0,f.value=i,d.value=[i]},r=({coords:i})=>{if(!(!c.value||!f.value)){if(a.value){const h=b.value.filter(u=>J.scribble(u).hitbox(i));for(const u of h)s.value.add(u.id);return}f.value=i,d.value.push(i)}},C=()=>{if(!c.value||(c.value=!1,f.value=void 0,d.value.length===0))return;if(a.value){const h=b.value.filter(u=>s.value.has(u.id));y.addToUndoStack({action:"remove",annotations:h}),b.value=b.value.filter(u=>!s.value.has(u.id)),s.value.clear();return}const i={id:Z(),type:"draw",points:d.value,color:o.value,brushWeight:t.value};b.value.push(i),y.addToUndoStack({action:"add",annotations:[i]}),d.value=[]};Y(a,()=>{e.canvas.value&&(e.canvas.value.style.cursor=a.value?"none":"crosshair")});const I=i=>{if(!g.value)return i;if(a.value){const h=J.circle({at:e.graphAtMousePosition.value.coords,radius:10,color:m.TRANSPARENT,stroke:{color:m.WHITE+"60",width:2}});i.push({graphType:"annotation",id:h.id,shape:h,priority:5050})}else if(d.value.length>0){const h=J.scribble({type:"draw",points:d.value,color:o.value,brushWeight:t.value});i.push({graphType:"annotation",id:h.id,shape:h,priority:5001})}for(const h of b.value){const u=s.value.has(h.id);i.push({graphType:"annotation",id:h.id,shape:J.scribble({...h,color:h.color+(u?"50":"")}),priority:5e3})}return i};return e.updateAggregator.push(I),{clearAnnotations:E,annotationActive:g,annotationErasing:a,annotationColor:o,annotationBrushWeight:t,activateAnnotation:()=>{e.canvas.value&&(g.value=!0,e.settings.value.userEditable=!1,e.settings.value.marquee=!1,e.settings.value.focusable=!1,e.graphCursorDisabled.value=!0,e.canvas.value.style.cursor="crosshair",e.subscribe("onMouseDown",n),e.subscribe("onMouseMove",r),e.subscribe("onMouseUp",C))},deactivateAnnotation:()=>{e.canvas.value&&(g.value=!1,a.value=!1,e.settings.value.userEditable=!0,e.settings.value.marquee=!0,e.settings.value.focusable=!0,e.graphCursorDisabled.value=!1,e.canvas.value.style.cursor="default",e.unsubscribe("onMouseDown",n),e.unsubscribe("onMouseMove",r),e.unsubscribe("onMouseUp",C))},undoAnnotation:y.undo,redoAnnotation:y.redo,canUndoAnnotation:y.canUndo,canRedoAnnotation:y.canRedo}},Go=["node","edge"],Wo="use-focus-graph",Ho=e=>{const{setTheme:o}=Te(e,Wo),t=w(new Set),a=w(!1),s=l=>{const i=l.filter(p=>!e.settings.value.focusBlacklist.includes(p));if(i.length===t.value.size&&i.every(p=>t.value.has(p)))return;const v=new Set([...t.value]);t.value=new Set(i),e.emit("onFocusChange",t.value,v)},d=l=>{if(t.value.has(l)||e.settings.value.focusBlacklist.includes(l))return;const u=new Set([...t.value]);t.value.add(l),e.emit("onFocusChange",t.value,u)},b=l=>{var h,u;const i=Se(e.canvas);(u=(h=l.shape).activateTextArea)==null||u.call(h,i,v=>{const p=e.getEdge(l.id);if(!p)throw new Error("textarea only implemented for edges");const A=e.settings.value.edgeInputToLabel(v);A===void 0||p.label===A||e.editEdgeLabel(p.id,A)})},c=()=>{const l=Array.from(t.value),i=l.filter(h=>e.getNode(h)||e.getEdge(h));i.length!==l.length&&s(i)},f=({items:l,coords:i})=>{var A,B;const h=l.at(-1);if(!h)return a.value?void 0:g();if(((B=(A=h.shape).textHitbox)==null?void 0:B.call(A,i))&&e.settings.value.edgeLabelsEditable&&h.graphType==="edge")return g(),b(h);Go.some(T=>T===h.graphType)&&(a.value?d(h.id):s([h.id]))},g=()=>s([]),y=()=>{const l=e.nodes.value.map(h=>h.id),i=e.edges.value.map(h=>h.id);s([...l,...i])},E=({id:l},{focus:i})=>{i&&s([l])},n=l=>t.value.has(l);o("nodeColor",l=>{if(n(l.id))return e.getTheme("nodeFocusColor",l)}),o("nodeBorderColor",l=>{if(n(l.id))return e.getTheme("nodeFocusBorderColor",l)}),o("nodeTextColor",l=>{if(n(l.id))return e.getTheme("nodeFocusTextColor",l)}),o("edgeColor",l=>{if(n(l.id))return e.getTheme("edgeFocusColor",l)}),o("edgeTextColor",l=>{if(n(l.id))return e.getTheme("edgeFocusTextColor",l)}),o("nodeAnchorColor",l=>{if(n(l.id))return e.getTheme("nodeAnchorColorWhenParentFocused",l)});const r=l=>{l.key==="Shift"&&(a.value=!0)},C=l=>{l.key==="Shift"&&(a.value=!1)},I=()=>{e.subscribe("onNodeAdded",E),e.subscribe("onEdgeAdded",E),e.subscribe("onMouseDown",f),e.subscribe("onKeyDown",r),e.subscribe("onKeyUp",C),e.subscribe("onStructureChange",c)},N=()=>{e.unsubscribe("onNodeAdded",E),e.unsubscribe("onEdgeAdded",E),e.unsubscribe("onMouseDown",f),e.unsubscribe("onKeyDown",r),e.unsubscribe("onKeyUp",C),e.unsubscribe("onStructureChange",c),g()};return e.subscribe("onSettingsChange",l=>{l.focusable===!1?N():l.focusable===!0&&I()}),e.settings.value.focusable&&I(),{focusedItemIds:$(t),setFocus:s,resetFocus:g,addToFocus:d,isFocused:n,focusAll:y,focusedNodes:F(()=>e.nodes.value.filter(l=>n(l.id))),focusedEdges:F(()=>e.edges.value.filter(l=>n(l.id)))}},Ko={focus:!0},qo={focus:!0},ve=100,me=3,zo=e=>{const o=w([]),t=w([]),a=n=>{o.value.push(n),o.value.length>ve&&o.value.shift()},s=n=>{t.value.push(n),t.value.length>ve&&t.value.shift()};e.subscribe("onNodeAdded",(n,{history:r})=>{r&&a({action:"add",affectedItems:[{graphType:"node",data:n}]})}),e.subscribe("onBulkNodeAdded",(n,{history:r})=>{r&&a({action:"add",affectedItems:n.map(C=>({graphType:"node",data:C}))})}),e.subscribe("onNodeRemoved",(n,r,{history:C})=>{if(!C)return;const I=r.map(N=>({graphType:"edge",data:N}));a({action:"remove",affectedItems:[{graphType:"node",data:n},...I]})}),e.subscribe("onBulkNodeRemoved",(n,r,{history:C})=>{if(!C)return;const I=n.map(l=>({graphType:"node",data:l})),N=r.map(l=>({graphType:"edge",data:l}));a({action:"remove",affectedItems:[...I,...N]})}),e.subscribe("onEdgeLabelEdited",(n,r,{history:C})=>{C&&a({action:"edit",affectedItems:[{graphType:"edge",data:{id:n.id,from:r,to:n.label}}]})}),e.subscribe("onEdgeAdded",(n,{history:r})=>{r&&a({action:"add",affectedItems:[{graphType:"edge",data:n}]})}),e.subscribe("onBulkEdgeAdded",(n,{history:r})=>{r&&a({action:"add",affectedItems:n.map(C=>({graphType:"edge",data:C}))})}),e.subscribe("onEdgeRemoved",(n,{history:r})=>{r&&a({action:"remove",affectedItems:[{graphType:"edge",data:n}]})}),e.subscribe("onBulkEdgeRemoved",(n,{history:r})=>{r&&a({action:"remove",affectedItems:n.map(C=>({graphType:"edge",data:C}))})});const d=w();e.subscribe("onGroupDragStart",(n,r)=>{d.value={startingCoordinates:r,nodes:n}}),e.subscribe("onGroupDrop",(n,r)=>{if(!d.value)throw new Error("dropped a group we didn't know was being dragged");if(d.value.nodes.length!==n.length)throw new Error("group size mismatch");const C=d.value.startingCoordinates.y-r.y,I=d.value.startingCoordinates.x-r.x;Math.sqrt(C**2+I**2)<me||a({action:"move",affectedItems:d.value.nodes.map(l=>({graphType:"node",data:{id:l.id,from:{x:l.x+I,y:l.y+C},to:{x:l.x,y:l.y}}}))})});const b=w();e.subscribe("onNodeDragStart",n=>{b.value={id:n.id,from:{x:n.x,y:n.y},to:{x:n.x,y:n.y}}}),e.subscribe("onNodeDrop",n=>{if(!b.value)throw new Error("dropped a node we didn't know was being dragged");if(b.value.id!==n.id)throw new Error("node ID mismatch");b.value.to={x:n.x,y:n.y};const r=b.value.from.y-b.value.to.y,C=b.value.from.x-b.value.to.x;Math.sqrt(r**2+C**2)<me||a({action:"move",affectedItems:[{graphType:"node",data:b.value}]})});const c=(n={})=>{const r=o.value.pop();if(r)return s(r),g(r),e.emit("onUndo",r,{...Ko,...n}),r},f=(n={})=>{const r=t.value.pop();if(r)return a(r),y(r),e.emit("onRedo",r,{...qo,...n}),r},g=n=>{if(n.action==="add")for(const r of n.affectedItems)r.graphType==="node"?e.removeNode(r.data.id,{history:!1}):r.graphType==="edge"&&e.removeEdge(r.data.id,{history:!1});else if(n.action==="remove")for(const r of n.affectedItems)r.graphType==="node"?e.addNode(r.data,{history:!1,focus:!1}):r.graphType==="edge"&&e.addEdge(r.data,{history:!1,focus:!1});else if(n.action==="move"){for(const r of n.affectedItems)if(r.graphType==="node"){const{from:C,id:I}=r.data;e.moveNode(I,{x:C.x,y:C.y})}}else if(n.action==="edit")for(const r of n.affectedItems)e.editEdgeLabel(r.data.id,r.data.from,{history:!1})},y=n=>{if(n.action==="add")for(const r of n.affectedItems)r.graphType==="node"?e.addNode(r.data,{history:!1,focus:!1}):r.graphType==="edge"&&e.addEdge(r.data,{history:!1,focus:!1});else if(n.action==="remove")for(const r of n.affectedItems)r.graphType==="node"?e.removeNode(r.data.id,{history:!1}):r.graphType==="edge"&&e.removeEdge(r.data.id,{history:!1});else if(n.action==="move"){for(const r of n.affectedItems)if(r.graphType==="node"){const{to:C,id:I}=r.data;e.moveNode(I,{x:C.x,y:C.y})}}else if(n.action==="edit")for(const r of n.affectedItems)e.editEdgeLabel(r.data.id,r.data.to,{history:!1})},E=()=>{o.value=[],t.value=[]};return{undo:c,redo:f,canUndo:F(()=>o.value.length>0),canRedo:F(()=>t.value.length>0),undoStack:o,redoStack:t,addToUndoStack:a,addToRedoStack:s,clearHistory:E}},Yo=e=>{const o={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-nodes")??"[]"),set:f=>{const g=f.filter(y=>!e.settings.value.persistentBlacklist.has(y.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-nodes",JSON.stringify(g))}},t={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-edges")??"[]"),set:f=>{const g=f.filter(y=>!e.settings.value.persistentBlacklist.has(y.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-edges",JSON.stringify(g))}},a=async()=>{await new Promise(f=>setTimeout(f,10)),o.set(e.nodes.value),t.set(e.edges.value)},s=()=>e.load({nodes:o.get(),edges:t.get()}),d=["onStructureChange","onNodeDrop","onGroupDrop"],b=()=>{d.forEach(f=>e.subscribe(f,a))},c=()=>{d.forEach(f=>e.unsubscribe(f,a))};return e.subscribe("onSettingsChange",f=>{if(c(),"persistent"in f&&!f.persistent)return;if("persistent"in f&&f.persistent){s(),b();return}"persistentStorageKey"in f&&s(),b()}),e.settings.value.persistent&&(queueMicrotask(s),b()),{trackGraphState:a}},Zo=(e,o={})=>{const t=wo(e,o),a=Ho(t),s=zo(t),d=Mo({...t,...a}),b=Ro({...t,...a}),c=_o({...t,...b}),f=Uo(t),g=Yo(t);ko({...t,...s,...a});const y=q((o==null?void 0:o.theme)??{});return Ze(t,y),{...t,...a,...s,...d,...c,...b,...f,...g,helpers:je(t)}},jo=Oe({__name:"Graph",props:{graph:{}},emits:["graphRef"],setup(e,{emit:o}){const t=e,a=o,s=c=>a("graphRef",c),d=w(t.graph.getTheme("graphBgPatternColor")),b=w(t.graph.getTheme("graphBgColor"));return t.graph.subscribe("onThemeChange",c=>{const{graphBgPatternColor:f,graphBgColor:g}=c;f&&(d.value=f),g&&(b.value=g)}),(c,f)=>(Ge(),Ue(qe,{onCanvasRef:s,color:b.value,"pattern-color":d.value},null,8,["color","pattern-color"]))}});export{Fo as B,Po as C,Co as L,ee as T,jo as _,No as g,so as i,Zo as u};
