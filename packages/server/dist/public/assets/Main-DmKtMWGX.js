import{e as C,o as i,c as g,a0 as P,v as L,x as ue,X as m,H as Q,r as N,F as E,f as T,M as s,a as p,b as u,w as r,d as f,t as k,E as S,g as R,y as ce,a1 as pe,a2 as ve,a3 as me,B as h,N as y,a4 as J,a5 as ee,a6 as fe,K as te,a7 as j,L as ge,a8 as _e,a9 as xe,aa as be,ab as he,_ as ye,G as oe,u as D,Q as se,ac as Ce,ad as X,ae as we}from"./index-D54qcSWh.js";import{u as ke}from"./Graph.vue_vue_type_script_setup_true_lang-CDlvTZTi.js";import{u as $e,p as F,T as z,a as A,b as H,c as Me,_ as Ae}from"./GraphProduct.vue_vue_type_script_setup_true_lang-tt5gevk1.js";import{u as Ie}from"./useGraphTutorial-YPZYqC2Q.js";import{d as ze}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-k-PFhbuS.js";import{_ as W}from"./Button.vue_vue_type_script_setup_true_lang-BqIn5GQy.js";import"./TutorialHint.vue_vue_type_script_setup_true_lang-CHwr5l46.js";const Ee={persistentStorageKey:"graph-sandbox"},q=C({__name:"GraphNode",props:{size:{default:60}},setup(d){return(e,n)=>(i(),g("div",{class:L(["flex","font-bold","items-center","justify-center","border-4","border-white","rounded-full",`h-[${e.size}px]`,`w-[${e.size}px]`])},[P(e.$slots,"default")],2))}}),Te={class:"flex flex-col gap-4"},Se={class:"text-xl mx-3"},Le={class:"overflow-auto"},Re={class:"flex flex-row gap-4"},Ne={class:"leading-[15px]"},Pe={key:0,class:"leading-[15px] text-[8px]"},De={key:0,class:"text-opacity-50 text-white text-xl font-bold"},Be=C({__name:"AdjacencyListDisplay",setup(d){const{weightedAdjacencyList:e}=ue(m.value),n=a=>{var t;return(t=m.value.getNode(a))==null?void 0:t.label},l=Q(()=>m.value.settings.value.displayEdgeLabels);return(a,t)=>{const c=N("v-icon");return i(),g("div",Te,[(i(!0),g(E,null,T(s(e),(b,_)=>(i(),g("div",{key:_,class:"flex items-center"},[p("div",null,[u(q,{class:"bg-gray-600"},{default:r(()=>[f(k(n(_)),1)]),_:2},1024)]),p("span",Se,[u(c,null,{default:r(()=>t[0]||(t[0]=[f("mdi-arrow-right")])),_:1})]),p("div",Le,[p("div",Re,[(i(!0),g(E,null,T(b,o=>(i(),g("div",null,[u(q,{class:"bg-gray-600 relative flex flex-col"},{default:r(()=>[p("span",Ne,k(o.label),1),l.value?(i(),g("span",Pe," Cost "+k(o.weight),1)):S("",!0)]),_:2},1024)]))),256)),b.length===0?(i(),g("h2",De," None ")):S("",!0)])])]))),128))])}}}),Ge=d=>{const e=d.nodes.value,n=e.length,l=pe(d),a=e.reduce((c,b,_)=>(c[b.id]=_,c),{}),t=Array.from({length:n},()=>Array(n).fill(0));for(const[c,b]of Object.entries(l)){const _=a[c];b.forEach(o=>{const v=ve(c,o,d).filter(M=>M.from===c&&M.to===o),w=a[o];if(v.length>0){const M=v.reduce((I,G)=>I+me(G,d),0);t[_][w]=M}})}return t},Ue=d=>{const e=R([]),n=()=>{e.value=Ge(d)};return d.subscribe("onStructureChange",n),ce(()=>{d.unsubscribe("onStructureChange",n)}),n(),{transitionMatrix:e}},Ve={class:"flex py-6 items-center"},je=C({__name:"TransitionMatrixDisplay",setup(d){const{transitionMatrix:e}=Ue(m.value),n={background:`
      linear-gradient(
        ${h.GRAY_700},
        ${h.GRAY_700}
      )
      50%
      50%/calc(100% - 10px)
      calc(100% - 10px) no-repeat,
      linear-gradient(
        90deg,
        ${h.WHITE}
        10%,
        ${h.TRANSPARENT}
        10%,
        ${h.TRANSPARENT}
        90%,
        ${h.WHITE}
        90%
      )
      188%
      0`};return(l,a)=>(i(),g("div",Ve,[a[0]||(a[0]=p("div",{class:"text-xl font-bold px-5 text-nowrap"},"T =",-1)),p("div",{style:n,class:"p-4 rounded"},[(i(!0),g(E,null,T(s(e),(t,c)=>(i(),g("div",{key:"row-"+c,class:"flex"},[(i(!0),g(E,null,T(t,(b,_)=>(i(),g("div",{key:"col-"+_,class:"text-gray-300 text-sm font-bold text-center flex items-center justify-center w-12 h-12",style:{overflow:"hidden"}},k(Math.round(b*10)/10),1))),128))]))),128))]),a[1]||(a[1]=p("div",{class:"text-gray-700"},"block",-1))]))}}),Fe={class:"bg-gray-800 flex flex-col text-white p-3 w-[400px] rounded-lg gap-2"},He={class:"bg-gray-700 p-4 rounded-lg max-h-[200px] overflow-auto"},We={class:"bg-gray-700 p-4 rounded-lg max-h-[300px] overflow-auto"},Ke=C({__name:"GraphInfoMenu",setup(d){return(e,n)=>{const l=N("v-menu");return i(),y(l,{offset:[10,0]},{activator:r(({props:a,isActive:t})=>[p("div",J(ee(a)),[P(e.$slots,"default",{isActive:t})],16)]),default:r(()=>[p("div",Fe,[n[0]||(n[0]=p("h1",{class:"text-2xl font-bold text-gray-200 mb-3"},"Graph Info",-1)),n[1]||(n[1]=p("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"Adjacency List",-1)),p("div",He,[u(Be)]),n[2]||(n[2]=p("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"Transition Matrix",-1)),p("div",We,[u(je)])])]),_:3})}}}),Oe={class:"bg-gray-800 flex flex-col text-white p-3 w-[400px] rounded-lg"},Xe={class:"rounded-lg mb-2"},qe=["disabled"],Ye={class:"w-full mt-2"},Ze={key:2},Qe={key:0,class:"mt-4 w-full"},Je={key:1},et={class:"text-xl font-bold text-gray-200 mt-4 mb-2"},tt={class:"flex flex-wrap items-center gap-2"},ot=["onClick"],st=C({__name:"CollaborativeSessionMenu",setup(d){const e=fe(),{navigate:n}=$e(),{connectToRoom:l,isConnected:a,connectedRoomId:t,disconnectFromRoom:c,collaborators:b,collaboratorCount:_,meAsACollaborator:o}=xe,v=Q(()=>`${window.location.origin}?rid=${t.value}`),w=R(!1),M=ze(()=>{w.value=!1},2e3),I=R(!1),G=()=>{try{navigator.clipboard.writeText(v.value),w.value=!0,M()}catch(U){console.error("Failed to copy link to clipboard",U)}},le=async()=>{I.value=!0,await l({roomId:be(),productId:he.productId,graph:m.value}),e.push({query:{rid:t.value}}),I.value=!1},ie=()=>{c(),e.push({query:{rid:void 0}})};return(U,x)=>{const V=N("v-icon"),K=N("v-tooltip"),de=N("v-menu");return i(),y(de,{offset:[10,0],"close-on-content-click":!1},{activator:r(({props:$,isActive:O})=>[p("div",J(ee($)),[P(U.$slots,"default",{isActive:O})],16)]),default:r(()=>[p("div",Oe,[x[7]||(x[7]=p("h1",{class:"text-2xl font-bold text-gray-200 mb-3"},"Collaborate",-1)),x[8]||(x[8]=p("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"My Name",-1)),p("div",Xe,[te(p("input",{"onUpdate:modelValue":x[0]||(x[0]=$=>s(j).name=$),disabled:s(a)||I.value,type:"text",id:"collab-name",class:"bg-gray-700 text-white w-full p-2 rounded-lg outline-none disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"The name you want others to see"},null,8,qe),[[ge,s(j).name]])]),p("div",Ye,[!s(a)&&!I.value?(i(),y(W,{key:0,onClick:le,disabled:!s(j).name,class:"w-full"},{default:r(()=>[x[2]||(x[2]=f(" Generate Link ")),u(V,{class:"ml-2"},{default:r(()=>x[1]||(x[1]=[f("mdi-link")])),_:1})]),_:1},8,["disabled"])):I.value?(i(),y(W,{key:1,disabled:"",class:"w-full"},{default:r(()=>x[3]||(x[3]=[f(" Preparing Room... ")])),_:1})):(i(),g("div",Ze,[p("div",{onClick:G,class:"group p-2 bg-gray-900 bg-opacity-50 hover:bg-opacity-100 text-gray-300 rounded-lg cursor-pointer flex justify-between items-center"},[p("span",null,k(v.value),1),w.value?S("",!0):(i(),y(V,{key:0,class:"text-gray-400 opacity-0 group-hover:opacity-100"},{default:r(()=>x[4]||(x[4]=[f(" mdi-content-copy ")])),_:1})),w.value?(i(),y(V,{key:1,class:"text-green-400 opacity-0 group-hover:opacity-100"},{default:r(()=>x[5]||(x[5]=[f(" mdi-check-underline ")])),_:1})):S("",!0)])]))]),s(a)?(i(),g("div",Qe,[u(W,{onClick:ie,color:s(h).RED_600,"text-color":s(h).WHITE,class:"w-full"},{default:r(()=>x[6]||(x[6]=[f(" Disconnect ")])),_:1},8,["color","text-color"])])):S("",!0),s(a)&&s(o)?(i(),g("div",Je,[p("h2",et," Collaborators ("+k(s(_))+") ",1),p("div",tt,[p("div",{class:L(`text-gray-300 bg-[${s(o).color}] font-bold rounded-md px-3 py-1`)},[f(k(s(o).name)+" (You) ",1),u(K,{activator:"parent",location:"bottom"},{default:r(()=>[f(" You are in "+k(s(F)[s(o).productId].name),1)]),_:1})],2),(i(!0),g(E,null,T(s(b),$=>(i(),g("button",{onClick:O=>s(n)(s(F)[$.productId]),key:$.id,class:L(`
              text-gray-300
              bg-[${$.color}]
              font-bold
              rounded-md
              px-3
              py-1
              hover:bg-[${s(_e)($.color,20)}]
            `)},[f(k($.name)+" ",1),u(K,{activator:"parent",location:"bottom"},{default:r(()=>[f(k($.name)+" is in "+k(s(F)[$.productId].name),1)]),_:2},1024)],10,ot))),128))])])):S("",!0)])]),_:3})}}}),nt=C({__name:"IslandToolbar",setup(d){const e=Ie(m.value,[{dismiss:"onNodeAdded",hint:"Double click on the canvas to add a node."},{dismiss:"onEdgeAdded",hint:"Hover node to show anchors, drag between them to add an edge."}]);e.start();const n=()=>{const a=[...m.value.focusedItemIds.value];m.value.bulkRemoveNode(a),m.value.bulkRemoveEdge(a)},l=()=>{const{activateAnnotation:a,deactivateAnnotation:t,annotationActive:c}=m.value;c.value?t():a()};return(a,t)=>(i(),y(Me,{hint:s(e)},{default:r(()=>[u(z,null,{default:r(()=>[u(A,{onClick:t[0]||(t[0]=c=>s(m).settings.value.displayEdgeLabels=!0),active:s(m).settings.value.displayEdgeLabels},{default:r(()=>t[6]||(t[6]=[f(" mdi-label-outline ")])),_:1},8,["active"]),u(H),u(A,{onClick:t[1]||(t[1]=c=>s(m).settings.value.displayEdgeLabels=!1),active:!s(m).settings.value.displayEdgeLabels},{default:r(()=>t[7]||(t[7]=[f(" mdi-label-off-outline ")])),_:1},8,["active"])]),_:1}),u(z,null,{default:r(()=>[u(A,{onClick:t[2]||(t[2]=c=>s(m).settings.value.isGraphDirected=!0),active:s(m).settings.value.isGraphDirected},{default:r(()=>t[8]||(t[8]=[f(" mdi-arrow-right-thin ")])),_:1},8,["active"]),u(H),u(A,{onClick:t[3]||(t[3]=c=>s(m).settings.value.isGraphDirected=!1),active:!s(m).settings.value.isGraphDirected},{default:r(()=>t[9]||(t[9]=[f(" mdi-minus ")])),_:1},8,["active"])]),_:1}),u(z,null,{default:r(()=>[u(A,{onClick:t[4]||(t[4]=c=>s(m).undo()),disabled:!s(m).canUndo.value},{default:r(()=>t[10]||(t[10]=[f(" mdi-undo ")])),_:1},8,["disabled"]),u(H),u(A,{onClick:t[5]||(t[5]=c=>s(m).redo()),disabled:!s(m).canRedo.value},{default:r(()=>t[11]||(t[11]=[f(" mdi-redo ")])),_:1},8,["disabled"])]),_:1}),u(z,null,{default:r(()=>[u(A,{onClick:n,disabled:s(m).focusedItemIds.value.size===0||s(m).annotationActive.value},{default:r(()=>t[12]||(t[12]=[f(" mdi-eraser ")])),_:1},8,["disabled"])]),_:1}),u(z,null,{default:r(()=>[u(A,{onClick:l,active:s(m).annotationActive.value},{default:r(()=>t[13]||(t[13]=[f(" mdi-pencil ")])),_:1},8,["active"])]),_:1}),u(z,null,{default:r(()=>[u(Ke,null,{default:r(({isActive:c})=>[u(A,{active:c},{default:r(()=>t[14]||(t[14]=[f(" mdi-information-outline ")])),_:2},1032,["active"])]),_:1})]),_:1}),u(z,null,{default:r(()=>[u(st,null,{default:r(({isActive:c})=>[u(A,{active:c},{default:r(()=>t[15]||(t[15]=[f("mdi-account-group")])),_:2},1032,["active"])]),_:1})]),_:1})]),_:1},8,["hint"]))}}),B="markup",at=["XS","SM","MD","LG","XL"],Y="MD",rt=[h.BLACK,h.BLUE_600,h.RED_600,h.GREEN_600,h.YELLOW_600],Z=h.BLACK,lt={XS:25,SM:30,MD:35,LG:40,XL:45},ne={XS:6,SM:8,MD:10,LG:12,XL:14},it={},dt={class:"flex flex-col gap-1"};function ut(d,e){return i(),g("div",dt,[P(d.$slots,"default")])}const ae=ye(it,[["render",ut]]),re=C({__name:"Button",props:{active:{type:Boolean}},setup(d){return(e,n)=>(i(),g("button",{class:L(["cursor-pointer","rounded-xl","p-1","border-2",e.active?"border-white":"border-transparent",e.active?"hover:border-white":"hover:border-gray-400"])},[p("div",{class:L(["relative","w-8","h-8","rounded-md","flex","items-center","justify-center","text-white","text-sm",e.active?"bg-gray-800":"bg-gray-700"])},[P(e.$slots,"default")],2)],2))}}),ct=C({__name:"InputColor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(d){const e=oe(d,"modelValue");return(n,l)=>(i(),y(ae,null,{default:r(()=>[(i(!0),g(E,null,T(s(rt),a=>(i(),y(re,{onClick:t=>e.value=a,key:a,active:e.value===a},{default:r(()=>[p("div",{class:L([`bg-[${a}]`,"w-full","h-full","rounded-md"])},null,2)]),_:2},1032,["onClick","active"]))),128))]),_:1}))}}),pt=C({__name:"NodeEdgeColorInput",props:{graph:{},colorMap:{}},setup(d){const e=d,n=()=>{const o=Array.from(e.graph.focusedItemIds.value),v=new Set(o.map(M=>e.colorMap.get(M)));if(v.has(void 0)||v.size!==1)return;const w=v.values().next().value;return w||Z},l=R(n()),a=o=>{for(const v of e.graph.focusedItemIds.value)e.colorMap.set(v,o);l.value=o},t=({id:o})=>{l.value&&e.colorMap.set(o,l.value)},c=async()=>{e.graph.focusedItemIds.value.size!==0&&(await new Promise(o=>setTimeout(o,0)),l.value=n())};e.graph.subscribe("onNodeAdded",t),e.graph.subscribe("onEdgeAdded",t),e.graph.subscribe("onFocusChange",c);const{setTheme:b}=D(e.graph,B+"-preview");return b("linkPreviewColor",()=>l.value??Z),(o,v)=>(i(),y(ct,{"onUpdate:modelValue":a,"model-value":l.value},null,8,["model-value"]))}}),vt=C({__name:"InputSize",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(d){const e=oe(d,"modelValue");return(n,l)=>(i(),y(ae,null,{default:r(()=>[(i(!0),g(E,null,T(s(at),a=>(i(),y(re,{onClick:t=>e.value=a,key:a,active:e.value===a},{default:r(()=>[f(k(a),1)]),_:2},1032,["onClick","active"]))),128))]),_:1}))}}),mt=C({__name:"NodeEdgeSizeInput",props:{graph:{},sizeMap:{}},setup(d){const e=d,n=()=>{const o=Array.from(e.graph.focusedItemIds.value),v=new Set(o.map(M=>e.sizeMap.get(M)));if(v.has(void 0)||v.size!==1)return;const w=v.values().next().value;return w||Y},l=R(n()),a=o=>{for(const v of e.graph.focusedItemIds.value)e.sizeMap.set(v,o);l.value=o,e.graph.updateEncapsulatedNodeBox()},t=({id:o})=>{l.value&&e.sizeMap.set(o,l.value)},c=async()=>{e.graph.focusedItemIds.value.size!==0&&(await new Promise(o=>setTimeout(o,0)),l.value=n())};e.graph.subscribe("onNodeAdded",t),e.graph.subscribe("onEdgeAdded",t),e.graph.subscribe("onFocusChange",c);const{setTheme:b}=D(e.graph,B+"-preview");return b("linkPreviewWidth",()=>ne[l.value??Y]),(o,v)=>(i(),y(vt,{"onUpdate:modelValue":a,"model-value":l.value},null,8,["model-value"]))}}),ft={class:"flex flex-col gap-3"},gt={class:"p-2 bg-gray-800 rounded-xl"},_t={class:"p-2 bg-gray-800 rounded-xl"},xt=C({__name:"IslandMarkup",props:{graph:{},sizeMap:{},colorMap:{}},setup(d){const e=d;return(n,l)=>(i(),g("div",ft,[p("div",gt,[u(pt,{graph:e.graph,colorMap:n.colorMap},null,8,["graph","colorMap"])]),p("div",_t,[u(mt,{graph:e.graph,sizeMap:n.sizeMap},null,8,["graph","sizeMap"])])]))}}),bt=d=>{const{setTheme:e,removeAllThemes:n}=D(d,B),l=se("markup-color-map",new Map),a=o=>{if(l.value.get(o.id))return Ce(d.theme.value.nodeColor,o)},t=o=>{const v=l.value.get(o.id);if(v)return d.isFocused(o.id)?X(v,30):v},c=o=>{const v=l.value.get(o.id);if(v)return d.isFocused(o.id)?X(v,30):v};return{colorize:()=>{e("nodeColor",a),e("nodeBorderColor",t),e("nodeFocusBorderColor",t),e("nodeAnchorColor",t),e("nodeAnchorColorWhenParentFocused",t),e("edgeColor",c),e("marqueeSelectionBoxColor",h.TRANSPARENT),e("marqueeEncapsulatedNodeBoxBorderColor",h.WHITE+"80"),e("marqueeEncapsulatedNodeBoxColor",h.TRANSPARENT)},decolorize:()=>{n()},colorMap:l}},ht=d=>{const{setTheme:e,removeAllThemes:n}=D(d,B),l=se("markup-size-map",new Map),a=_=>{const o=l.value.get(_.id);if(o)return lt[o]},t=_=>{const o=l.value.get(_.id);if(o)return ne[o]};return{size:()=>{e("nodeSize",a),e("edgeWidth",t)},desize:()=>{n()},sizeMap:l}},It=C({__name:"Main",setup(d){const e=R(),n=ke(e,{settings:Ee}),{colorize:l,colorMap:a}=bt(n);l();const{size:t,sizeMap:c}=ht(n);return t(),(b,_)=>(i(),y(Ae,{onGraphRef:_[0]||(_[0]=o=>e.value=o),graph:s(n)},{"top-center":r(()=>[u(nt)]),"center-left":r(()=>[te(u(xt,{graph:s(n),sizeMap:s(c),colorMap:s(a)},null,8,["graph","sizeMap","colorMap"]),[[we,!s(n).annotationActive.value]])]),_:1},8,["graph"]))}});export{It as default};
