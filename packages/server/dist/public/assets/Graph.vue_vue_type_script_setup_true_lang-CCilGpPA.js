var xe=Object.defineProperty;var we=(e,o,t)=>o in e?xe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var j=(e,o,t)=>we(e,typeof o!="symbol"?o+"":o,t);import{O as Ie,L as Me,J as z,b3 as X,b4 as fe,b5 as Be,b6 as De,b7 as _e,b8 as Re,b9 as ve,ba as Le,bb as ke,x as E,bc as Oe,C as B,g as M,X as he,a9 as J,bd as Fe,an as Pe,ao as Ue,be as Ge,bf as me,u as ge,bg as Q,Z as We,$ as He,d as qe,y as Ke,o as ze}from"./index-8e-9kjYV.js";import{c as be,a as je,b as Ye,l as ye,e as Ve,g as Se,r as ne,s as V,_ as Je}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-CchNFnjx.js";const Ze="auto",$e=e=>{const o=Ie(),t=Me("preferred-theme",Ze);return z(o,()=>{t.value==="auto"&&(e.themeName.value=o.value?"dark":"light")},{immediate:!0}),z(t,()=>{t.value==="auto"?e.themeName.value=o.value?"dark":"light":e.themeName.value=t.value},{immediate:!0}),{preferredTheme:t}},Xe=e=>({getConnectedNodes:o=>X(o,e),getConnectedEdges:o=>fe(o,e),getInboundEdges:o=>Be(o,e),getOutboundEdges:o=>De(o,e),isEdgeFlowingIntoNode:(o,t)=>_e(o,t,e),isEdgeFlowingOutOfNode:(o,t)=>Re(o,t,e),getEdgesAlongPath:(o,t)=>ve(o,t,e),getEdgeWeight:o=>Le(o,e),getWeightBetweenNodes:(o,t)=>ke(o,t,e)}),Qe=(e,o)=>{const t=o("nodeColor",e),s=o("nodeBorderColor",e),r=o("nodeSize",e),n=o("nodeBorderWidth",e),d=o("nodeText",e),i=o("nodeTextSize",e),l=o("nodeTextColor",e),u=o("nodeShape",e),g=be({at:{x:e.x,y:e.y},radius:r,color:t,stroke:{color:s,width:n},textArea:{text:{content:d,fontSize:i,fontWeight:"bold",color:l},color:E.TRANSPARENT}}),p=je({at:{x:e.x-r,y:e.y-r},size:r*2,color:t,stroke:{color:s,width:n},textArea:{text:{content:d,fontSize:i,fontWeight:"bold",color:l},color:E.TRANSPARENT}});return{shape:u==="circle"?g:p,id:e.id,graphType:"node"}},eo=1.618,yt=e=>o=>Math.round(o/e)*e,se=2,oo=(e,o)=>{const{displayEdgeLabels:t,isGraphDirected:s}=o.settings.value,[r,n]=X(e.id,o),i=ve(r.id,n.id,o).length>1,l=n===r,u=o.getTheme("nodeBorderWidth",r),g=o.getTheme("nodeBorderWidth",n),p=o.getTheme("nodeSize",r),a=o.getTheme("nodeSize",n),c=Math.atan2(n.y-r.y,n.x-r.x),h=g/2+se,A={x:(a+h)*Math.cos(c),y:(a+h)*Math.sin(c)},T={x:r.x,y:r.y},m={x:n.x-(s?A.x:0),y:n.y-(s?A.y:0)},f=o.getTheme("edgeWidth",e),b=f*1.2;i&&(T.x+=Math.cos(c+Math.PI/2)*b,T.y+=Math.sin(c+Math.PI/2)*b,m.x+=Math.cos(c+Math.PI/2)*b,m.y+=Math.sin(c+Math.PI/2)*b);const C=Oe(T,o.edges.value.filter(k=>(k.from===r.id||k.to===n.id)&&k.from!==k.to).map(k=>{const[H,K]=X(k.id,o);return r.id===H.id?{x:K.x,y:K.y}:{x:H.x,y:H.y}}).filter((k,H,K)=>H===K.findIndex(W=>W.x===k.x&&W.y===k.y))),I=o.getTheme("edgeColor",e),v=o.getTheme("edgeTextColor",e),S=o.getTheme("graphBgColor"),y=o.getTheme("edgeText",e),N=o.getTheme("edgeTextSize",e),w=o.getTheme("edgeTextFontWeight",e),_=t?{color:S,activeColor:S,text:{content:y,color:v,fontSize:N,fontWeight:w}}:void 0,L=(p+u)*eo,P=L-(p+u/2)-se;if(l)return{shape:Ye({spacing:f*1.2,at:{x:r.x,y:r.y},upDistance:L,downDistance:P,rotation:C,lineWidth:f,color:I,textArea:_}),id:e.id,graphType:"edge"};const F=p+u/2+a+g/2,G=(r.x-n.x)**2+(r.y-n.y)**2;return F**2>G?void 0:s?{shape:Ve({start:T,end:m,width:f,textOffsetFromCenter:(p+u/2)/2,color:I,textArea:_}),id:e.id,graphType:"edge"}:{shape:ye({start:T,end:m,width:f,color:I,textArea:_}),id:e.id,graphType:"edge"}},oe={nodeShape:"circle",nodeSize:35,nodeBorderWidth:8,nodeTextSize:24,nodeAnchorRadius:Math.ceil(Math.sqrt(35)*2),edgeWidth:10,edgeTextSize:20,nodeText:({label:e})=>e,edgeText:({label:e})=>e,edgeTextFontWeight:"bold",linkPreviewWidth:10},to="rgb(100, 60, 70)",no={nodeBorderColor:E.BLACK,nodeColor:E.STONE_600,nodeTextColor:E.WHITE,nodeFocusBorderColor:E.RED_700,nodeFocusColor:to,nodeFocusTextColor:E.WHITE,edgeColor:E.STONE_900,edgeFocusColor:E.RED_700,edgeFocusTextColor:E.WHITE,edgeTextColor:E.WHITE,graphBgColor:E.GRAY_600,graphBgPatternColor:E.WHITE+"15",nodeAnchorColorWhenParentFocused:E.RED_800,nodeAnchorColor:E.GRAY_900,linkPreviewColor:E.BLACK,marqueeSelectionBoxColor:E.WHITE+"15",marqueeSelectionBoxBorderColor:E.WHITE,marqueeEncapsulatedNodeBoxBorderColor:E.RED_700,marqueeEncapsulatedNodeBoxColor:E.RED_700+"20",...oe},so={nodeColor:E.GRAY_50,nodeBorderColor:E.GRAY_800,nodeFocusBorderColor:E.BLUE_600,nodeFocusColor:E.BLUE_100,nodeTextColor:E.GRAY_900,nodeFocusTextColor:E.GRAY_900,edgeColor:E.GRAY_800,edgeTextColor:E.GRAY_900,edgeFocusColor:E.BLUE_600,edgeFocusTextColor:E.BLACK,graphBgColor:E.GRAY_200,graphBgPatternColor:E.BLACK+"15",nodeAnchorColor:E.BLACK,nodeAnchorColorWhenParentFocused:E.BLUE_900,linkPreviewColor:E.BLACK,marqueeSelectionBoxColor:E.BLUE_300+"15",marqueeSelectionBoxBorderColor:E.BLUE_500,marqueeEncapsulatedNodeBoxBorderColor:E.BLUE_700,marqueeEncapsulatedNodeBoxColor:E.BLUE_700+"05",...oe},ro={nodeColor:E.PINK_100,nodeBorderColor:E.PINK_400,nodeFocusBorderColor:E.PURPLE_600,nodeFocusColor:E.PURPLE_200,nodeTextColor:E.PINK_600,nodeFocusTextColor:E.PURPLE_900,edgeColor:E.PINK_600,edgeTextColor:E.PINK_600,edgeFocusColor:E.PURPLE_600,edgeFocusTextColor:E.PURPLE_600,graphBgColor:E.PINK_300,graphBgPatternColor:E.WHITE+"50",nodeAnchorColor:E.PINK_500,nodeAnchorColorWhenParentFocused:E.PURPLE_700,linkPreviewColor:E.PINK_900,marqueeSelectionBoxColor:E.PINK_300+"15",marqueeSelectionBoxBorderColor:E.PINK_500,marqueeEncapsulatedNodeBoxBorderColor:E.PINK_700,marqueeEncapsulatedNodeBoxColor:E.PINK_700+"05",...oe},Ee={light:so,dark:no,girl:ro},St=(e,o)=>({nodeSize:e("nodeSize",o),nodeBorderWidth:e("nodeBorderWidth",o),nodeColor:e("nodeColor",o),nodeBorderColor:e("nodeBorderColor",o),nodeTextSize:e("nodeTextSize",o),nodeTextColor:e("nodeTextColor",o),nodeText:e("nodeText",o),nodeShape:e("nodeShape",o)}),ao=()=>({nodeSize:[],nodeBorderWidth:[],nodeColor:[],nodeBorderColor:[],nodeFocusColor:[],nodeFocusBorderColor:[],nodeText:[],nodeFocusTextColor:[],nodeTextSize:[],nodeTextColor:[],nodeShape:[],edgeColor:[],edgeWidth:[],edgeText:[],edgeTextSize:[],edgeTextColor:[],edgeFocusTextColor:[],edgeTextFontWeight:[],edgeFocusColor:[],graphBgColor:[],graphBgPatternColor:[],nodeAnchorRadius:[],nodeAnchorColor:[],nodeAnchorColorWhenParentFocused:[],linkPreviewColor:[],linkPreviewWidth:[],marqueeSelectionBoxColor:[],marqueeSelectionBoxBorderColor:[],marqueeEncapsulatedNodeBoxColor:[],marqueeEncapsulatedNodeBoxBorderColor:[]}),co=e=>Object.prototype.toString.call(e)==="[object Object]",pe=(e,o)=>{const t={};if(!e)return o;if(!o)return null;const s=Object.keys(e),r=Object.keys(o);for(const n of r)s.includes(n)||(t[n]=o[n]);for(const n of s){if(co(e[n])){const d=pe(e[n],o[n]);d&&(t[n]=d);continue}if(Array.isArray(e[n])){JSON.stringify(e[n])!==JSON.stringify(o[n])&&(t[n]=o[n]);continue}else e[n]!==o[n]&&(t[n]=o[n])}return Object.keys(t).length?t:null},ee=e=>{const o={...e};for(const t in o)typeof o[t]=="object"&&(o[t]=ee(o[t]));return o},io=e=>({subscribe:(o,t)=>e[o].add(t),unsubscribe:(o,t)=>e[o].delete(t),emit:(o,...t)=>{for(const s of e[o])s(...t)}}),uo=()=>({onStructureChange:new Set,onNodeAdded:new Set,onBulkNodeAdded:new Set,onNodeRemoved:new Set,onBulkNodeRemoved:new Set,onNodeMoved:new Set,onBulkNodeMoved:new Set,onEdgeAdded:new Set,onBulkEdgeAdded:new Set,onEdgeRemoved:new Set,onBulkEdgeRemoved:new Set,onEdgeLabelEdited:new Set,onRepaint:new Set,onNodeHoverChange:new Set,onGraphLoaded:new Set,onGraphReset:new Set,onClick:new Set,onMouseDown:new Set,onMouseUp:new Set,onMouseMove:new Set,onDblClick:new Set,onContextMenu:new Set,onKeyDown:new Set,onKeyUp:new Set,onThemeChange:new Set,onSettingsChange:new Set,onUndo:new Set,onRedo:new Set,onFocusChange:new Set,onNodeDragStart:new Set,onNodeDrop:new Set,onNodeAnchorDragStart:new Set,onNodeAnchorDrop:new Set,onGroupDragStart:new Set,onGroupDrop:new Set}),re=e=>e==null,lo=e=>{const o=e.trim().split("/").filter(Boolean);if(o.length!==2)return!1;const[t,s]=o.map(Number);return!(re(t)||re(s))},fo=e=>{if(!lo(e))return;const o=e.split("/"),[t,s]=o.map(Number);return t/s},vo={displayEdgeLabels:!0,edgeLabelsEditable:!0,edgeInputToLabel:e=>{var s;const o=e.trim();if(!o)return;const t=(s=fo(o))==null?void 0:s.toFixed(2);return t==="Infinity"?"∞":t==="-Infinity"?"-∞":t===void 0&&isNaN(Number(o))?void 0:t??o},newNodeLabelGetter:null,isGraphDirected:!0},ho={focusable:!0,focusBlacklist:[]},mo={draggable:!0},go={nodeAnchors:!0},bo={marquee:!0,marqueeSelectableGraphTypes:["node","edge"]},yo={interactive:!0,userAddedEdgeLabel:"1",userAddedEdgeRuleNoSelfLoops:!1,userAddedEdgeRuleOneEdgePerPath:!1},So={persistent:!0,persistentStorageKey:"graph",persistentBlacklist:new Set},Eo={shortcuts:!0,shortcutUndo:!0,shortcutRedo:!0,shortcutSelectAll:!0,shortcutDelete:!0,shortcutEscape:!0},po={...vo,...ho,...mo,...go,...bo,...yo,...So,...Eo},ae=(e,...o)=>typeof e=="function"?e(...o):e,To=(e,o)=>(t,...s)=>{const r=o[t].findLast(d=>{const i=d.value;return ae(i,...s)!==void 0}),n=(r==null?void 0:r.value)??Ee[e.value][t];if(!n)throw new Error(`Theme property "${t}" not found`);return ae(n,...s)},Co=(e,o)=>{const t=B(()=>{const r=new Map;for(const n of e.value)r.set(n.id,n);return r}),s=B(()=>{const r=new Map;for(const n of o.value)r.set(n.id,n);return r});return{nodeIdToNodeMap:t,edgeIdToEdgeMap:s}},Ao=({canvas:e,emit:o})=>{const t=M([]),s=[],r=()=>{var a,c,h,A;if(!e.value)return;const i=e.value.getContext("2d");if(!i)return;i.clearRect(0,0,e.value.width,e.value.height);const l=s.reduce((T,m)=>m(T),[]);t.value=[...l.sort((T,m)=>T.priority-m.priority)];const u=t.value.findLastIndex(T=>T.graphType==="edge"),g=t.value.slice(0,u+1),p=t.value.slice(u+1);for(const T of g)T.shape.drawShape(i);for(const T of g)(c=(a=T.shape).drawTextAreaMatte)==null||c.call(a,i);for(const T of g)(A=(h=T.shape).drawText)==null||A.call(h,i);for(const T of p)T.shape.draw(i);o("onRepaint",i,"loop")},n=setInterval(r,1e3/60);return he(()=>{clearInterval(n)}),setTimeout(r,1e3),{aggregator:t,updateAggregator:s,getSchemaItemsByCoordinates:i=>t.value.sort((l,u)=>l.priority-u.priority).filter(l=>{var u,g;return l.shape.shapeHitbox(i)||((g=(u=l.shape).textHitbox)==null?void 0:g.call(u,i))})}},No={broadcast:!0,focus:!0,history:!0},xo={broadcast:!0,focus:!1,history:!0},ce={broadcast:!0,history:!0},$={broadcast:!0,focus:!1,history:!0},ie={broadcast:!0,history:!0},wo={broadcast:!0},Io={label:""},Mo="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");Array.from({length:999},(e,o)=>(o+1).toString());const Bo=(e,o)=>()=>{let t=e.value.map(({label:i})=>i),s=0,r=0,n;const d=()=>s===0?"":o[(s-1)%o.length];for(;!n;){r>=o.length&&(t=t.slice(o.length),r=0,s++);const l=d()+o[r];t.includes(l)||(n=l),r++}return n},Do=e=>Bo(e.nodes,Mo),_o=({nodes:e,edges:o,nodeMap:t,edgeMap:s,emit:r,settings:n})=>{const d=f=>t.value.get(f),i=f=>s.value.get(f),l=(f,b={})=>{if(f!=null&&f.id&&d(f.id)){console.warn("prevented adding a node with an existing id, this shouldn't happen");return}const C={...No,...b},I=n.value.newNodeLabelGetter??Do({nodes:e}),v={id:f.id??J(),label:f.label??I(),x:f.x??0,y:f.y??0};return e.value.push(v),r("onNodeAdded",v,C),r("onStructureChange"),v},u=(f,b={})=>{if(f.length===0)return;const C={...xo,...b},I=[];for(const v of f){const S=l(v,{focus:!1,broadcast:!1,history:!1});S&&I.push(S)}I.length!==0&&r("onBulkNodeAdded",I,C)},g=(f,b={})=>{const C={...$,...b},{isGraphDirected:I}=n.value,[v,S]=[d(f.from),d(f.to)];if(!v||!S)return;if(I){if(o.value.find(w=>w.from===f.from&&w.to===f.to))return}else if(o.value.find(w=>w.from===f.from&&w.to===f.to||w.from===f.to&&w.to===f.from))return;const y={...Io,id:J(),...f};return o.value.push(y),r("onEdgeAdded",y,C),r("onStructureChange"),y},p=(f,b={})=>{if(f.length===0)return;const C={...$,...b},I=[];for(const v of f){const S=g(v,{broadcast:!1,history:!1});S&&I.push(S)}I.length!==0&&r("onBulkEdgeAdded",I,C)},a=(f,b,C={})=>{const I=d(f);if(!I)return;const v={...wo,...C};I.x=b.x,I.y=b.y,r("onNodeMoved",I,v)},c=(f,b,C={})=>{const I={...$,...C},v=i(f);if(!v)return;const S=v.label;v.label=b,r("onEdgeLabelEdited",v,S,I),r("onStructureChange")},h=(f,b={})=>{const C=d(f);if(!C)return;const I={...ce,...b},S=fe(C.id,{edges:o,getEdge:i,settings:n}).map(y=>T(y.id,{broadcast:!1,history:!1})).filter(Boolean);return e.value=e.value.filter(y=>y.id!==C.id),r("onNodeRemoved",C,S,I),r("onStructureChange"),[C,S]},A=(f,b={})=>{if(f.length===0)return;const C={...ce,...b},I=[],v=[];for(const S of f){const y=h(S,{broadcast:!1,history:!1});if(!y)continue;const[N,w]=y;I.push(N),v.push(...w)}I.length!==0&&r("onBulkNodeRemoved",I,v,C)},T=(f,b={})=>{const C=i(f);if(!C)return;const I={...ie,...b};return o.value=o.value.filter(v=>v.id!==C.id),r("onEdgeRemoved",C,I),r("onStructureChange"),C};return{getNode:d,getEdge:i,addNode:l,addEdge:g,moveNode:a,editEdgeLabel:c,removeNode:h,removeEdge:T,bulkAddNode:u,bulkRemoveNode:A,bulkAddEdge:p,bulkRemoveEdge:(f,b={})=>{if(f.length===0)return;const C={...ie,...b},I=[];for(const v of f){const S=T(v,{broadcast:!1,history:!1});S&&I.push(S)}if(I.length!==0)return r("onBulkEdgeRemoved",I,C),I}}},Ro=({subscribe:e,canvas:o,graphAtMousePosition:t})=>{const s=M(!1),r=M(!1),n=M({node:"grab",edge:"pointer","node-anchor":"grab","encapsulated-node-box":"move"}),d=M(),i=B(()=>!!d.value),l=a=>{d.value=a},u=()=>{d.value=void 0},g=a=>{var h;if(!a)return"default";if(i.value)return((h=d.value)==null?void 0:h.call(d,a))??!1?"pointer":"default";const c=n.value[a.graphType]??"default";return c==="grab"&&s.value?"grabbing":c},p=({items:a})=>{if(!o.value||r.value)return;const c=a.at(-1);o.value.style.cursor=g(c)};return e("onMouseDown",a=>{s.value=!0,p(a)}),e("onMouseUp",a=>{s.value=!1,p(a)}),e("onMouseMove",p),z(n,()=>{p({items:t.value.items})},{deep:!0}),{graphToCursorMap:n,activateCursorSelectMode:l,deactivateCursorSelectMode:u,graphCursorDisabled:r}},Lo=(e,o={})=>{const t=M("light"),s=ao(),r=To(t,s),n=M({...po,...o}),d=uo(),{subscribe:i,unsubscribe:l,emit:u}=io(d),g=M(!0);Fe(e,()=>{g.value=!1}),i("onMouseDown",()=>{g.value=!0});const p=M([]),a=M([]),c=M({coords:{x:0,y:0},items:[]}),h=Ro({canvas:e,subscribe:i,graphAtMousePosition:c}),A=x=>{const R=Se(e),O=Ge(x,R);c.value={coords:O,items:I(O)}},T=x=>({...c.value,event:x}),m={click:x=>{x.preventDefault(),u("onClick",T(x))},mousemove:x=>{x.preventDefault(),u("onMouseMove",T(x))},mousedown:x=>{x.preventDefault(),u("onMouseDown",T(x))},mouseup:x=>{x.preventDefault(),u("onMouseUp",T(x))},dblclick:x=>{x.preventDefault(),u("onDblClick",T(x))},contextmenu:x=>{u("onContextMenu",T(x))}},f={keydown:x=>u("onKeyDown",x),keyup:x=>u("onKeyUp",x)},{aggregator:b,updateAggregator:C,getSchemaItemsByCoordinates:I}=Ao({canvas:e,emit:u}),v=x=>{const R={edges:a,getNode:N,getEdge:w,getTheme:r,settings:n},O=a.value.map(q=>oo(q,R)).filter(Boolean).map((q,Z)=>({...q,priority:Z*10})),Ne=p.value.map(q=>Qe(q,r)).filter(Boolean).map((q,Z)=>({...q,priority:Z*10+1e3}));return x.push(...O),x.push(...Ne),x};C.push(v),Pe(()=>{if(!e.value)throw new Error("canvas element not found");e.value.addEventListener("mousemove",A);for(const[x,R]of Object.entries(m))e.value.addEventListener(x,R);for(const[x,R]of Object.entries(f))document.addEventListener(x,R)}),Ue(()=>{if(!e.value)throw new Error("Canvas element not found");e.value.removeEventListener("mousemove",A);for(const[x,R]of Object.entries(m))e.value.removeEventListener(x,R);for(const[x,R]of Object.entries(f))document.removeEventListener(x,R)});const{nodeIdToNodeMap:S,edgeIdToEdgeMap:y}=Co(p,a),{getNode:N,getEdge:w,addNode:D,addEdge:_,moveNode:L,editEdgeLabel:P,removeNode:F,removeEdge:G,bulkAddNode:U,bulkRemoveNode:Y,bulkAddEdge:k,bulkRemoveEdge:H}=_o({nodes:p,edges:a,nodeMap:S,edgeMap:y,emit:u,settings:n}),K=(x,R)=>{const O=I({x,y:R}).pop();if(O&&O.graphType==="node")return N(O.id)};let W;i("onMouseMove",({items:x})=>{const R=x.at(-1);if(!R||R.graphType!=="node")return;const O=N(R.id);O!==W&&(u("onNodeHoverChange",O,W),W=O)});const Te=x=>(W&&me(W.id,x),x);C.push(Te);const Ce=x=>{p.value=x.nodes,a.value=x.edges,u("onGraphLoaded"),u("onStructureChange")},Ae=()=>{p.value=[],a.value=[],u("onGraphReset"),u("onStructureChange")};z(t,async(x,R)=>{u("onThemeChange",x,R)});const te=M(ee(n.value));return z(n,x=>{const R=pe(te.value,x);R&&(te.value=ee(n.value),u("onSettingsChange",R))},{deep:!0}),{nodes:p,edges:a,getNode:N,getEdge:w,addNode:D,addEdge:_,moveNode:L,editEdgeLabel:P,removeNode:F,removeEdge:G,bulkAddNode:U,bulkRemoveNode:Y,bulkAddEdge:k,bulkRemoveEdge:H,getSchemaItemsByCoordinates:I,getNodeByCoordinates:K,eventBus:d,subscribe:i,unsubscribe:l,emit:u,updateAggregator:C,aggregator:b,baseTheme:B(()=>Ee[t.value]),themeName:t,getTheme:r,themeMap:s,settings:n,load:Ce,reset:Ae,canvas:e,canvasFocused:g,graphAtMousePosition:c,updateGraphAtMousePosition:A,...h}},ko="use-marquee-graph",Oo={THEME_ID:ko},Fo=e=>{const o=M(),t=M(),s=M(),{setTheme:r,removeTheme:n}=ge(e,Oo.THEME_ID),d=()=>r("nodeAnchorColor",E.TRANSPARENT),i=()=>n("nodeAnchorColor"),l=y=>{const{width:N,height:w}=y;return Math.abs(N*w)},u=({items:y,coords:N})=>{const w=y.at(-1);(w==null?void 0:w.graphType)!=="encapsulated-node-box"&&i(),w||c(N)},g=({items:y,coords:N})=>{if(!s.value)return;const w=y.at(-1);if((w==null?void 0:w.graphType)!=="encapsulated-node-box")return;const D=N.x-s.value.x,_=N.y-s.value.y;s.value=N;for(const L of e.focusedNodes.value)e.moveNode(L.id,{x:L.x+D,y:L.y+_});T()},p=({items:y,coords:N})=>{if(o.value)return;const w=y.at(-1);(w==null?void 0:w.graphType)==="encapsulated-node-box"&&(s.value=N,e.emit("onGroupDragStart",e.focusedNodes.value,N))},a=()=>{s.value&&(e.emit("onGroupDrop",e.focusedNodes.value,s.value),s.value=void 0)},c=y=>{d(),e.graphCursorDisabled.value=!0,o.value={at:y,width:0,height:0}},h=()=>{o.value&&(o.value=void 0,e.graphCursorDisabled.value=!1,i())},A=y=>{if(l(y)<100)return;const w=[];for(const{id:D,shape:_,graphType:L}of e.aggregator.value){const{marqueeSelectableGraphTypes:P}=e.settings.value;if(!P.includes(L))continue;_.efficientHitbox(y)&&w.push(D)}e.setFocus(w)},T=()=>{if(t.value={at:{x:1/0,y:1/0},width:0,height:0},e.focusedNodes.value.length<2)return;let y=1/0,N=1/0,w=-1/0,D=-1/0;for(const _ of e.focusedNodes.value){const L=e.getTheme("nodeSize",_),P=e.getTheme("nodeBorderWidth",_),F=L+P/2,{x:G,y:U}=_;y=Math.min(y,G-F),N=Math.min(N,U-F),w=Math.max(w,G+F),D=Math.max(D,U+F)}y<1/0&&N<1/0&&w>-1/0&&D>-1/0?(t.value.at.x=y,t.value.at.y=N,t.value.width=w-y,t.value.height=D-N):(t.value.width=0,t.value.height=0)},m=({coords:y})=>{if(!o.value)return;const{x:N,y:w}=y;o.value.width=N-o.value.at.x,o.value.height=w-o.value.at.y,A(o.value)},f=y=>({id:"marquee-box",graphType:"marquee-box",shape:ne({...y,color:e.getTheme("marqueeSelectionBoxColor"),stroke:{color:e.getTheme("marqueeSelectionBoxBorderColor"),width:2}}),priority:1/0}),b=y=>{if(!o.value)return y;const N=f(o.value);return y.push(N),y},C=y=>({id:"encapsulated-node-box",graphType:"encapsulated-node-box",shape:ne({...y,color:e.getTheme("marqueeEncapsulatedNodeBoxColor"),stroke:{color:e.getTheme("marqueeEncapsulatedNodeBoxBorderColor"),width:2}}),priority:1/0}),I=y=>{if(!t.value)return y;const N=C(t.value);return y.push(N),y};e.updateAggregator.push(I),e.updateAggregator.push(b);const v=()=>{e.subscribe("onFocusChange",T),e.subscribe("onMouseDown",u),e.subscribe("onMouseUp",h),e.subscribe("onContextMenu",h),e.subscribe("onMouseMove",m),e.subscribe("onMouseDown",p),e.subscribe("onMouseUp",a),e.subscribe("onMouseMove",g),e.subscribe("onUndo",T),e.subscribe("onRedo",T)},S=()=>{e.unsubscribe("onFocusChange",T),e.unsubscribe("onMouseDown",u),e.unsubscribe("onMouseUp",h),e.unsubscribe("onContextMenu",h),e.unsubscribe("onMouseMove",m),e.unsubscribe("onMouseDown",p),e.unsubscribe("onMouseUp",a),e.unsubscribe("onMouseMove",g),e.unsubscribe("onUndo",T),e.unsubscribe("onRedo",T),o.value&&h()};return e.subscribe("onSettingsChange",y=>{y.marquee===!0?v():y.marquee===!1&&S()}),e.settings.value.marquee&&v(),{updateEncapsulatedNodeBox:T}},Po=e=>{const o=M(),t=({items:i,coords:l})=>{const u=i.at(-1);if(!u||u.graphType!=="node")return;e.settings.value.nodeAnchors=!1;const g=e.getNode(u.id);g&&(o.value={node:g,coords:l},e.emit("onNodeDragStart",g))},s=()=>{o.value&&(e.emit("onNodeDrop",o.value.node),e.settings.value.nodeAnchors=!0,e.nodeAnchorSetParentNode(o.value.node.id),o.value=void 0)},r=({coords:i})=>{if(!o.value)return;const{node:l,coords:u}=o.value,g=i.x-u.x,p=i.y-u.y;e.moveNode(l.id,{x:l.x+g,y:l.y+p}),o.value.coords=i},n=()=>{e.subscribe("onMouseDown",t),e.subscribe("onMouseUp",s),e.subscribe("onMouseMove",r)},d=()=>{e.unsubscribe("onMouseDown",t),e.unsubscribe("onMouseUp",s),e.unsubscribe("onMouseMove",r),o.value&&s()};return e.subscribe("onSettingsChange",i=>{i.draggable===!1?d():i.draggable===!0&&n()}),e.settings.value.draggable&&n(),{activeDragNode:B(()=>{var i;return(i=o.value)==null?void 0:i.node})}},Uo=e=>{const o=M(),t=M(),s=v=>{const S=e.getNode(v);if(!S)throw new Error("node not found");o.value=S,u(S)},r=()=>{o.value=void 0,t.value=void 0},n=M(),d=({items:v})=>{const S=v.at(-1);if(!S)return n.value=void 0;n.value=S.id},i=v=>{const{getTheme:S}=e,y=S("nodeAnchorColor",v),N=S("nodeAnchorColorWhenParentFocused",v),w=S("nodeAnchorRadius",v),D=[];for(const _ of l.value){const{x:L,y:P,id:F}=_,G=F===n.value,U={at:{x:L,y:P},radius:w,color:G?N:y};t.value&&t.value.direction===_.direction&&(U.at.x=t.value.x,U.at.y=t.value.y);const Y=be(U);D.push({id:_.id,graphType:"node-anchor",shape:Y,priority:1/0})}return D},l=M([]),u=v=>{if(!v)return l.value=[];const{getTheme:S}=e,y=S("nodeAnchorRadius",v),N=S("nodeSize",v),w=S("nodeBorderWidth",v),D=N-y/3+w/2;l.value=[{x:v.x,y:v.y-D,direction:"north"},{x:v.x+D,y:v.y,direction:"east"},{x:v.x,y:v.y+D,direction:"south"},{x:v.x-D,y:v.y,direction:"west"}].map(_=>({..._,id:J()}))},g=({items:v})=>{const S=v.at(-1);if(!S||S.graphType!=="node-anchor")return;const{id:y}=S;return l.value.find(N=>N.id===y)},p=()=>{if(!o.value||!t.value)return;const{x:v,y:S}=t.value,y={x:o.value.x,y:o.value.y},N={x:v,y:S},{getTheme:w}=e,D=w("linkPreviewColor",o.value,t.value),_=w("linkPreviewWidth",o.value,t.value);return{id:"link-preview",graphType:"link-preview",shape:ye({start:y,end:N,color:D,width:_})}},a=({items:v})=>{if(t.value)return;const S=v.at(-1);if(!S)return r();if(S.graphType!=="node")return;const y=e.getNode(S.id);if(!y)throw new Error("node in aggregator but not in graph");const N=e.isFocused(y.id),w=e.focusedNodes.value.length>1;if(N&&w)return r();o.value=y,u(y)},c=v=>{if(!o.value)return;const S=g(v);S&&(t.value=S,e.emit("onNodeAnchorDragStart",o.value,S))},h=({coords:v})=>{if(!t.value)return;const{x:S,y}=v;t.value.x=S,t.value.y=y},A=()=>{if(t.value){if(!o.value)throw new Error("active anchor without parent node")}else return;e.emit("onNodeAnchorDrop",o.value,t.value),r()},T=v=>{if(!o.value)return v;const S=i(o.value);for(const y of S)v.push(y);return v},m=v=>{var D;if(!o.value||!t.value)return v;const{id:S}=o.value;me(S,v);const y=(D=v.find(_=>_.id===S))==null?void 0:D.priority;if(!y)return v;const N=p();if(!N)return v;const w={...N,priority:y-.1};return v.push(w),v};e.updateAggregator.push(T),e.updateAggregator.push(m);const f=v=>{var S;((S=o.value)==null?void 0:S.id)===v.id&&r()},b=()=>{if(!o.value)return;const v=e.isFocused(o.value.id),S=e.focusedNodes.value.length>1;v&&S&&r()},C=()=>{e.subscribe("onNodeRemoved",f),e.subscribe("onNodeMoved",r),e.subscribe("onNodeDrop",u),e.subscribe("onMouseMove",a),e.subscribe("onMouseMove",h),e.subscribe("onMouseMove",d),e.subscribe("onMouseDown",c),e.subscribe("onMouseUp",A),e.subscribe("onFocusChange",b)},I=()=>{e.unsubscribe("onNodeRemoved",f),e.unsubscribe("onNodeMoved",r),e.unsubscribe("onNodeDrop",u),e.unsubscribe("onMouseMove",a),e.unsubscribe("onMouseMove",h),e.subscribe("onMouseMove",d),e.unsubscribe("onMouseDown",c),e.unsubscribe("onMouseUp",A),e.unsubscribe("onFocusChange",b),r()};return e.subscribe("onSettingsChange",v=>{v.nodeAnchors===!0?C():v.nodeAnchors===!1&&I()}),e.settings.value.nodeAnchors&&C(),{nodeAnchorActiveAnchor:Q(t),nodeAnchorParentNode:Q(o),nodeAnchorSetParentNode:s}},Go=(e=!1)=>{const o=i=>i.key===" "?"Space":i.key.length>1||e?i.key:i.key.toUpperCase(),t=M(""),s=B(()=>{let i;return t.value.split("+").filter(l=>{const u=l===i;return i=l,!u}).join("+")}),r=i=>{t.value.length>0&&(t.value+="+"),t.value+=o(i)},n=()=>{t.value=""},d=i=>s.value===i;return document.addEventListener("keydown",r),document.addEventListener("keyup",n),he(()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",n)}),{isPressed:d,currentKeyString:t}},Wo=window.navigator.userAgent.includes("Mac")?"Mac":"Windows",Ho=e=>{const{settings:o}=e,t=()=>{e.annotationActive.value&&e.undoAnnotation(),o.value.interactive&&e.undo()},s=()=>{e.annotationActive.value&&e.redoAnnotation(),o.value.interactive&&e.redo()},r=()=>e.resetFocus(),n=()=>e.focusAll(),d=()=>{o.value.interactive!==!1&&(e.bulkRemoveNode([...e.focusedItemIds.value]),e.bulkRemoveEdge([...e.focusedItemIds.value]))},i=(f,b)=>b===!1?()=>{}:typeof b=="function"?b:f,l=B(()=>i(s,o.value.shortcutRedo)),u=B(()=>i(t,o.value.shortcutUndo)),g=B(()=>i(r,o.value.shortcutEscape)),p=B(()=>i(n,o.value.shortcutSelectAll)),a=B(()=>i(d,o.value.shortcutDelete)),c=B(()=>({Mac:{"Meta+Z":u.value,"Shift+Meta+Z":l.value,"Meta+Shift+Z":l.value,Backspace:a.value,"Meta+A":p.value,Escape:g.value},Windows:{"Control+Z":u.value,"Shift+Control+Z":l.value,"Control+Shift+Z":l.value,Backspace:a.value,"Control+A":p.value,Escape:g.value}})),{isPressed:h}=Go(),A=f=>{if(e.canvasFocused.value===!1)return;const b=c.value[Wo];for(const C in b)if(h(C)){b[C](),f.preventDefault();return}},T=()=>{e.subscribe("onKeyDown",A)},m=()=>{e.unsubscribe("onKeyDown",A)};return o.value.shortcuts&&T(),e.subscribe("onSettingsChange",f=>{f.shortcuts===!0?T():f.shortcuts===!1&&m()}),{delete:a,selectAll:p,escape:g,redo:l,undo:u}},qo=[E.RED_600,E.BLUE_600,E.GREEN_600,E.YELLOW_600],Ko=[3,6,9,12],ue=100,zo=e=>{const o=M([]),t=M([]);return{clearHistory:()=>{o.value=[],t.value=[]},undo:()=>{const l=o.value.pop();if(!l)return;const{action:u,annotations:g}=l,p=g.map(({id:a})=>a);u==="add"?e.value=e.value.filter(({id:a})=>!p.includes(a)):u==="remove"&&e.value.push(...g),t.value.push(l)},redo:()=>{const l=t.value.pop();if(!l)return;const{action:u,annotations:g}=l,p=g.map(({id:a})=>a);u==="add"?e.value.push(...g):u==="remove"&&(e.value=e.value.filter(({id:a})=>!p.includes(a))),o.value.push(l)},addToUndoStack:l=>{o.value.push(l),o.value.length>ue&&o.value.shift()},addToRedoStack:l=>{t.value.push(l),t.value.length>ue&&t.value.shift()},canUndo:B(()=>o.value.length!==0),canRedo:B(()=>t.value.length!==0)}},jo=e=>{const o=M(qo[0]),t=M(Ko[1]),s=M(!1),r=M(new Set),n=M([]),d=M([]),i=M(!1),l=M(),u=M(!1),g=zo(d),p=()=>{d.value.length!==0&&(g.addToUndoStack({action:"remove",annotations:d.value}),d.value=[])},a=({coords:f})=>{i.value=!0,l.value=f,n.value=[f]},c=({coords:f})=>{if(!(!i.value||!l.value)){if(s.value){const b=d.value.filter(C=>V.scribble(C).hitbox(f));for(const C of b)r.value.add(C.id);return}l.value=f,n.value.push(f)}},h=()=>{if(!i.value||(i.value=!1,l.value=void 0,n.value.length===0))return;if(s.value){const b=d.value.filter(C=>r.value.has(C.id));g.addToUndoStack({action:"remove",annotations:b}),d.value=d.value.filter(C=>!r.value.has(C.id)),r.value.clear();return}const f={id:J(),type:"draw",points:n.value,color:o.value,brushWeight:t.value};d.value.push(f),g.addToUndoStack({action:"add",annotations:[f]}),n.value=[]};z(s,()=>{e.canvas.value&&(e.canvas.value.style.cursor=s.value?"none":"crosshair")});const A=f=>{if(!u.value)return f;if(s.value){const b=V.circle({at:e.graphAtMousePosition.value.coords,radius:10,color:E.TRANSPARENT,stroke:{color:E.WHITE+"60",width:2}});f.push({graphType:"annotation",id:b.id,shape:b,priority:5050})}else if(n.value.length>0){const b=V.scribble({type:"draw",points:n.value,color:o.value,brushWeight:t.value});f.push({graphType:"annotation",id:b.id,shape:b,priority:5001})}for(const b of d.value){const C=r.value.has(b.id);f.push({graphType:"annotation",id:b.id,shape:V.scribble({...b,color:b.color+(C?"50":"")}),priority:5e3})}return f};return e.updateAggregator.push(A),{clearAnnotations:p,annotationActive:u,annotationErasing:s,annotationColor:o,annotationBrushWeight:t,activateAnnotation:()=>{e.canvas.value&&(u.value=!0,e.settings.value.interactive=!1,e.settings.value.marquee=!1,e.settings.value.focusable=!1,e.settings.value.draggable=!1,e.graphCursorDisabled.value=!0,e.canvas.value.style.cursor="crosshair",e.subscribe("onMouseDown",a),e.subscribe("onMouseMove",c),e.subscribe("onMouseUp",h))},deactivateAnnotation:()=>{e.canvas.value&&(u.value=!1,s.value=!1,e.settings.value.interactive=!0,e.settings.value.marquee=!0,e.settings.value.focusable=!0,e.settings.value.draggable=!0,e.graphCursorDisabled.value=!1,e.canvas.value.style.cursor="default",e.unsubscribe("onMouseDown",a),e.unsubscribe("onMouseMove",c),e.unsubscribe("onMouseUp",h))},undoAnnotation:g.undo,redoAnnotation:g.redo,canUndoAnnotation:g.canUndo,canRedoAnnotation:g.canRedo}},Yo=["node","edge"],Vo="use-focus-graph",Jo=e=>{const{setTheme:o}=ge(e,Vo),t=M(new Set),s=M(!1),r=m=>{const f=m.filter(v=>!e.settings.value.focusBlacklist.includes(v));if(f.length===t.value.size&&f.every(v=>t.value.has(v)))return;const I=new Set([...t.value]);t.value=new Set(f),e.emit("onFocusChange",t.value,I)},n=m=>{if(t.value.has(m)||e.settings.value.focusBlacklist.includes(m))return;const C=new Set([...t.value]);t.value.add(m),e.emit("onFocusChange",t.value,C)},d=m=>{var b,C;const f=Se(e.canvas);(C=(b=m.shape).activateTextArea)==null||C.call(b,f,I=>{const v=e.getEdge(m.id);if(!v)throw new Error("textarea only implemented for edges");const S=e.settings.value.edgeInputToLabel(I);S===void 0||v.label===S||e.editEdgeLabel(v.id,S)})},i=()=>{const m=Array.from(t.value),f=m.filter(b=>e.getNode(b)||e.getEdge(b));f.length!==m.length&&r(f)},l=({items:m,coords:f})=>{var S,y;const b=m.at(-1);if(!b)return s.value?void 0:u();if(((y=(S=b.shape).textHitbox)==null?void 0:y.call(S,f))&&e.settings.value.edgeLabelsEditable&&b.graphType==="edge")return u(),d(b);Yo.some(N=>N===b.graphType)&&(s.value?n(b.id):r([b.id]))},u=()=>r([]),g=()=>{const m=e.nodes.value.map(b=>b.id),f=e.edges.value.map(b=>b.id);r([...m,...f])},p=({id:m},{focus:f})=>{f&&r([m])},a=m=>t.value.has(m);o("nodeColor",m=>{if(a(m.id))return e.getTheme("nodeFocusColor",m)}),o("nodeBorderColor",m=>{if(a(m.id))return e.getTheme("nodeFocusBorderColor",m)}),o("nodeTextColor",m=>{if(a(m.id))return e.getTheme("nodeFocusTextColor",m)}),o("edgeColor",m=>{if(a(m.id))return e.getTheme("edgeFocusColor",m)}),o("edgeTextColor",m=>{if(a(m.id))return e.getTheme("edgeFocusTextColor",m)}),o("nodeAnchorColor",m=>{if(a(m.id))return e.getTheme("nodeAnchorColorWhenParentFocused",m)});const c=m=>{m.key==="Shift"&&(s.value=!0)},h=m=>{m.key==="Shift"&&(s.value=!1)},A=()=>{e.subscribe("onNodeAdded",p),e.subscribe("onEdgeAdded",p),e.subscribe("onMouseDown",l),e.subscribe("onKeyDown",c),e.subscribe("onKeyUp",h),e.subscribe("onStructureChange",i)},T=()=>{e.unsubscribe("onNodeAdded",p),e.unsubscribe("onEdgeAdded",p),e.unsubscribe("onMouseDown",l),e.unsubscribe("onKeyDown",c),e.unsubscribe("onKeyUp",h),e.unsubscribe("onStructureChange",i),u()};return e.subscribe("onSettingsChange",m=>{m.focusable===!1?T():m.focusable===!0&&A()}),e.settings.value.focusable&&A(),{focusedItemIds:Q(t),setFocus:r,resetFocus:u,addToFocus:n,isFocused:a,focusAll:g,focusedNodes:B(()=>e.nodes.value.filter(m=>a(m.id))),focusedEdges:B(()=>e.edges.value.filter(m=>a(m.id)))}},Zo={focus:!0},$o={focus:!0},de=100,le=3,Xo=e=>{const o=M([]),t=M([]),s=a=>{o.value.push(a),o.value.length>de&&o.value.shift()},r=a=>{t.value.push(a),t.value.length>de&&t.value.shift()};e.subscribe("onNodeAdded",(a,{history:c})=>{c&&s({action:"add",affectedItems:[{graphType:"node",data:a}]})}),e.subscribe("onBulkNodeAdded",(a,{history:c})=>{c&&s({action:"add",affectedItems:a.map(h=>({graphType:"node",data:h}))})}),e.subscribe("onNodeRemoved",(a,c,{history:h})=>{if(!h)return;const A=c.map(T=>({graphType:"edge",data:T}));s({action:"remove",affectedItems:[{graphType:"node",data:a},...A]})}),e.subscribe("onBulkNodeRemoved",(a,c,{history:h})=>{if(!h)return;const A=a.map(m=>({graphType:"node",data:m})),T=c.map(m=>({graphType:"edge",data:m}));s({action:"remove",affectedItems:[...A,...T]})}),e.subscribe("onEdgeLabelEdited",(a,c,{history:h})=>{h&&s({action:"edit",affectedItems:[{graphType:"edge",data:{id:a.id,from:c,to:a.label}}]})}),e.subscribe("onEdgeAdded",(a,{history:c})=>{c&&s({action:"add",affectedItems:[{graphType:"edge",data:a}]})}),e.subscribe("onBulkEdgeAdded",(a,{history:c})=>{c&&s({action:"add",affectedItems:a.map(h=>({graphType:"edge",data:h}))})}),e.subscribe("onEdgeRemoved",(a,{history:c})=>{c&&s({action:"remove",affectedItems:[{graphType:"edge",data:a}]})}),e.subscribe("onBulkEdgeRemoved",(a,{history:c})=>{c&&s({action:"remove",affectedItems:a.map(h=>({graphType:"edge",data:h}))})});const n=M();e.subscribe("onGroupDragStart",(a,c)=>{n.value={startingCoordinates:c,nodes:a}}),e.subscribe("onGroupDrop",(a,c)=>{if(!n.value)throw new Error("dropped a group we didn't know was being dragged");if(n.value.nodes.length!==a.length)throw new Error("group size mismatch");const h=n.value.startingCoordinates.y-c.y,A=n.value.startingCoordinates.x-c.x;Math.sqrt(h**2+A**2)<le||s({action:"move",affectedItems:n.value.nodes.map(m=>({graphType:"node",data:{id:m.id,from:{x:m.x+A,y:m.y+h},to:{x:m.x,y:m.y}}}))})});const d=M();e.subscribe("onNodeDragStart",a=>{d.value={id:a.id,from:{x:a.x,y:a.y},to:{x:a.x,y:a.y}}}),e.subscribe("onNodeDrop",a=>{if(!d.value)throw new Error("dropped a node we didn't know was being dragged");if(d.value.id!==a.id)throw new Error("node ID mismatch");d.value.to={x:a.x,y:a.y};const c=d.value.from.y-d.value.to.y,h=d.value.from.x-d.value.to.x;Math.sqrt(c**2+h**2)<le||s({action:"move",affectedItems:[{graphType:"node",data:d.value}]})});const i=(a={})=>{const c=o.value.pop();if(c)return r(c),u(c),e.emit("onUndo",c,{...Zo,...a}),c},l=(a={})=>{const c=t.value.pop();if(c)return s(c),g(c),e.emit("onRedo",c,{...$o,...a}),c},u=a=>{if(a.action==="add")for(const c of a.affectedItems)c.graphType==="node"?e.removeNode(c.data.id,{history:!1}):c.graphType==="edge"&&e.removeEdge(c.data.id,{history:!1});else if(a.action==="remove")for(const c of a.affectedItems)c.graphType==="node"?e.addNode(c.data,{history:!1,focus:!1}):c.graphType==="edge"&&e.addEdge(c.data,{history:!1,focus:!1});else if(a.action==="move"){for(const c of a.affectedItems)if(c.graphType==="node"){const{from:h,id:A}=c.data;e.moveNode(A,{x:h.x,y:h.y})}}else if(a.action==="edit")for(const c of a.affectedItems)e.editEdgeLabel(c.data.id,c.data.from,{history:!1})},g=a=>{if(a.action==="add")for(const c of a.affectedItems)c.graphType==="node"?e.addNode(c.data,{history:!1,focus:!1}):c.graphType==="edge"&&e.addEdge(c.data,{history:!1,focus:!1});else if(a.action==="remove")for(const c of a.affectedItems)c.graphType==="node"?e.removeNode(c.data.id,{history:!1}):c.graphType==="edge"&&e.removeEdge(c.data.id,{history:!1});else if(a.action==="move"){for(const c of a.affectedItems)if(c.graphType==="node"){const{to:h,id:A}=c.data;e.moveNode(A,{x:h.x,y:h.y})}}else if(a.action==="edit")for(const c of a.affectedItems)e.editEdgeLabel(c.data.id,c.data.to,{history:!1})},p=()=>{o.value=[],t.value=[]};return{undo:i,redo:l,canUndo:B(()=>o.value.length>0),canRedo:B(()=>t.value.length>0),undoStack:o,redoStack:t,addToUndoStack:s,addToRedoStack:r,clearHistory:p}},Qo=e=>{const o={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-nodes")??"[]"),set:l=>{const u=l.filter(g=>!e.settings.value.persistentBlacklist.has(g.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-nodes",JSON.stringify(u))}},t={get:()=>JSON.parse(localStorage.getItem(e.settings.value.persistentStorageKey+"-edges")??"[]"),set:l=>{const u=l.filter(g=>!e.settings.value.persistentBlacklist.has(g.id));localStorage.setItem(e.settings.value.persistentStorageKey+"-edges",JSON.stringify(u))}},s=async()=>{await new Promise(l=>setTimeout(l,10)),o.set(e.nodes.value),t.set(e.edges.value)},r=()=>e.load({nodes:o.get(),edges:t.get()}),n=["onStructureChange","onNodeDrop","onGroupDrop"],d=()=>{n.forEach(l=>e.subscribe(l,s))},i=()=>{n.forEach(l=>e.unsubscribe(l,s))};return e.subscribe("onSettingsChange",l=>{if(i(),"persistent"in l&&!l.persistent)return;if("persistent"in l&&l.persistent){r(),d();return}"persistentStorageKey"in l&&r(),d()}),e.settings.value.persistent&&(queueMicrotask(r),d()),{trackGraphState:s}},et=(e,o)=>{const t=e/1e3;return Math.floor(o*t)},ot={linear:e=>e,in:e=>e*e,out:e=>e*(2-e),"in-out":e=>e<.5?2*e*e:-1+(4-2*e)*e},tt={easeFn:"in-out"},nt=e=>{const{start:o,end:t,numberOfSteps:s,easeFn:r}={...tt,...e};if(s<1)throw new Error(`numberOfSteps must be greater than 0, got ${s}`);if(!Number.isInteger(s))throw new Error(`numberOfSteps must be an integer, got ${s}`);const n=[],d=typeof r=="string"?ot[r]:r;for(let i=1;i<=s;i++){const l=i/s,u=d(l),g=Math.round(o.x+(t.x-o.x)*u),p=Math.round(o.y+(t.y-o.y)*u);n.push({x:g,y:p})}return n},st={durationMs:1e3,frameRate:60},rt=e=>{const{durationMs:o,frameRate:t}={...st,...e},s=nt({...e,numberOfSteps:et(o,t)});return{coords:s,timePerFrameMs:Math.floor(o/s.length)}},at={durationMs:300,broadcast:!0,history:!0,persist:!0},ct=e=>({node:async t=>{const{nodeId:s,endCoords:r,durationMs:n,history:d,broadcast:i,persist:l}={...at,...t};if(n<100)throw new Error(`durationMs must be greater than 100, got ${n}`);const u=e.getNode(s);if(!u)throw new Error(`Node with id ${s} not found`);const g={x:u.x,y:u.y},{coords:p,timePerFrameMs:a}=rt({start:g,end:r,durationMs:n});for(let c=0;c<p.length;c++)await new Promise(h=>setTimeout(h,a)),e.moveNode(u.id,p[c],{broadcast:i}),e.isFocused(u.id)&&e.updateEncapsulatedNodeBox();d&&e.addToUndoStack({action:"move",affectedItems:[{graphType:"node",data:{id:t.nodeId,from:g,to:t.endCoords}}]}),l&&await e.trackGraphState()}}),it=e=>{const o=({coords:n,event:d})=>{e.addNode(n),setTimeout(()=>e.updateGraphAtMousePosition(d),10)},t=(n,d)=>{const l=e.getSchemaItemsByCoordinates(d).findLast(g=>g.graphType==="node");if(!l)return;const u=e.getNode(l.id);if(u&&!(e.settings.value.userAddedEdgeRuleNoSelfLoops&&n.id===u.id)){if(e.settings.value.userAddedEdgeRuleOneEdgePerPath){const g=e.edges.value.find(c=>c.from===n.id&&c.to===u.id),p=e.edges.value.find(c=>c.from===u.id&&c.to===n.id);if(g||p)return}e.addEdge({from:n.id,to:u.id,label:e.settings.value.userAddedEdgeLabel})}},s=()=>{e.subscribe("onDblClick",o),e.subscribe("onNodeAnchorDrop",t),e.settings.value.nodeAnchors=!0,e.settings.value.edgeLabelsEditable=!0},r=()=>{e.unsubscribe("onDblClick",o),e.unsubscribe("onNodeAnchorDrop",t),e.settings.value.nodeAnchors=!1,e.settings.value.edgeLabelsEditable=!1};e.settings.value.interactive&&s(),e.subscribe("onSettingsChange",n=>{n.interactive===!0?s():n.interactive===!1&&r()})},ut=({adjacencyList:e,undirectedAdjacencyList:o})=>{const t=(d,i)=>{const l=new Set,u=[];for(u.push(i);u.length>0;){const g=u.shift();if(!g)break;l.add(g),d[g].forEach(a=>{l.has(a)||u.push(a)})}return l},s=d=>Object.keys(d).every(i=>t(d,i).size===Object.keys(d).length),r=B(()=>s(e.value)),n=B(()=>s(o.value));return{isConnected:r,isWeaklyConnected:n}};class dt{constructor(o){j(this,"V");j(this,"adj");j(this,"Time");j(this,"SCCs",[]);this.V=o,this.adj=new Array(o).fill(0).map(()=>[]),this.Time=0}addEdge(o,t){this.adj[o].push(t)}SCCUtil(o,t,s,r,n){s[o]=this.Time,t[o]=this.Time,this.Time+=1,r[o]=!0,n.push(o);for(const d of this.adj[o])s[d]===-1?(this.SCCUtil(d,t,s,r,n),t[o]=Math.min(t[o],t[d])):r[d]&&(t[o]=Math.min(t[o],s[d]));if(t[o]===s[o]){let d;const i=[];do d=n.pop(),i.push(d),r[d]=!1;while(d!==o);this.SCCs.push(i)}}SCC(){const o=new Array(this.V).fill(-1),t=new Array(this.V).fill(-1),s=new Array(this.V).fill(!1),r=[];for(let n=0;n<this.V;n++)o[n]===-1&&this.SCCUtil(n,t,o,s,r);return this.SCCs}}const lt=(e,o)=>{const t=new dt(e.length),s=e.map(n=>n.id);for(const n of o)t.addEdge(s.indexOf(n.from),s.indexOf(n.to));return t.SCC().map(n=>n.map(d=>e[d]))},ft=e=>{const o={},t=[[],[]],s={...e};Object.keys(e).forEach(d=>{s[d]||(s[d]=[])});const r={};Object.entries(s).forEach(([d,i])=>{i.forEach(l=>{r[l]||(r[l]=[]),r[l].push(d)})});const n=d=>{const i=[d];for(o[d]=0,t[0].push(d);i.length>0;){const l=i.shift(),u=o[l],g=u===0?1:0,p=s[l]||[],a=r[l]||[],c=[...new Set([...p,...a])];for(const h of c)if(o[h]===void 0)o[h]=g,t[g].push(h),i.push(h);else if(o[h]===u)return!1}return!0};for(const d of Object.keys(s))if(o[d]===void 0&&!n(d))return;return t},vt=e=>{const o=new Set,t=[],s=[],r=new Set,n=(i,l)=>{o.add(i),s.push(i),r.add(i);for(const u of e[i]||[])if(!o.has(u))n(u,i);else if(u!==l&&r.has(u)){const g=s.indexOf(u),a=[...s.slice(g)].sort();t.some(c=>d(c,a))||t.push(a)}s.pop(),r.delete(i)},d=(i,l)=>i.length!==l.length?!1:i.every(u=>l.includes(u));for(const i in e)o.has(i)||n(i,null);return t},ht=e=>{const o=ut(e.adjacencyList),t=B(()=>{const c=e.edges.value;return c.filter(h=>c.some(A=>h.from===A.to&&h.to===A.from))}),s=B(()=>lt(e.nodes.value,e.edges.value)),r=B(()=>s.value.reduce((h,A,T)=>{for(const{id:m}of A)h.set(m,T);return h},new Map)),n=B(()=>t.value.length>0),d=B(()=>{const c=e.adjacencyList.adjacencyList.value;return ft(c)}),i=B(()=>{const c=d.value,h=new Map;if(!c)return h;const[A,T]=c;for(const m of A)h.set(m,0);for(const m of T)h.set(m,1);return h}),l=B(()=>e.settings.value.isGraphDirected?s.value.filter(h=>h.length>1).map(h=>h.map(A=>A.id)):vt(e.adjacencyList.adjacencyList.value).sort((A,T)=>A.length-T.length)),u=B(()=>l.value.reduce((c,h,A)=>{for(const T of h)c.set(T,A);return c},new Map)),g=B(()=>l.value.length===0),p=B(()=>{const c=e.settings.value.isGraphDirected,h=e.nodes.value.length;return e.edges.value.length===(c?h*(h-1):h*(h-1)/2)}),a=B(()=>!!d.value);return{bidirectionalEdges:t,hasBidirectionalEdges:n,stronglyConnectedComponents:s,nodeIdToStronglyConnectedComponent:r,bipartitePartition:d,nodeIdToBipartitePartition:i,isBipartite:a,cycles:l,nodeIdToCycle:u,isAcyclic:g,isComplete:p,...o}},Et=(e,o={})=>{const t=Lo(e,o),s=Jo(t),r=Xo(t),n=Fo({...t,...s}),d=Uo({...t,...s}),i=Po({...t,...d}),l=jo(t),u=Qo(t),g=$e(t),p=Ho({...t,...r,...s,...l}),a=We(t),c=He(t),h=ht({...t,adjacencyList:a}),A=ct({...t,...r,...s,...n,...u});return it(t),{...t,focus:s,history:r,marquee:n,nodeDrag:i,nodeAnchor:d,annotation:l,persistent:u,animate:A,...g,adjacencyList:a,transitionMatrix:c,characteristics:h,shortcutActions:p,helpers:Xe(t)}},pt=qe({__name:"Graph",props:{graph:{}},emits:["graphRef"],setup(e,{emit:o}){const t=e,s=o,r=l=>s("graphRef",l),n=M(t.graph.getTheme("graphBgPatternColor")),d=M(t.graph.getTheme("graphBgColor")),i=async()=>{n.value=t.graph.getTheme("graphBgPatternColor"),d.value=t.graph.getTheme("graphBgColor")};return t.graph.subscribe("onThemeChange",i),(l,u)=>(ze(),Ke(Je,{onCanvasRef:r,color:d.value,"pattern-color":n.value},null,8,["color","pattern-color"]))}});export{Ko as B,qo as C,Mo as L,Ee as T,pt as _,yt as a,Bo as g,lo as i,St as r,Et as u};
