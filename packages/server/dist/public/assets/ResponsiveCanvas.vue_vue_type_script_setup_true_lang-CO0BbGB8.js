import{bf as X,bg as C,bh as V,bi as E,bj as K,bk as Q,bl as q,bm as xt,bn as P,a8 as I,bo as tt,bp as A,bq as gt,br as N,bs as ft,bt as wt,bu as bt,bv as vt,bw as yt,bx as mt,by as Tt,bz as At,bA as Ct,G as z,g as T,al as et,y as nt,N as U,d as Et,bB as pt,z as M,bC as Ht,c as J,W as Z,D as Lt,a as j,J as $,o as G}from"./index-BauKbB-4.js";const St=t=>{const n=X({width:t.size,height:t.size,...t});return e=>n(e)},R=t=>{const{at:n,size:e,textArea:a}=t;if(!a)throw new Error("no text area provided");const{text:s}=a,{fontSize:o}={...Q,...s},r=n.x+e/2,i=n.y+e/2;return{x:r-o,y:i-o}},Mt=t=>{if(!t.textArea)return;const n=R(t),e=C(t.textArea,n),{width:a,height:s}=V(e),o=E({at:e.at,width:a,height:s});return r=>o(r)},at=t=>{if(!t.textArea)return;const n=R(t),e=C(t.textArea,n),a=K(e);return s=>a(s)},ot=t=>{if(!t.textArea)return;const n=R(t),e=C(t.textArea,n),a=q(e);return s=>a(s)},Wt=t=>{const n=at(t),e=ot(t);if(!(!n||!e))return a=>{n(a),e(a)}},Bt=t=>{const n=E({at:t.at,width:t.size,height:t.size,borderRadius:t.borderRadius,rotation:t.rotation,stroke:t.stroke});return e=>n(e)},zt=t=>xt({at:t.at,width:t.size,height:t.size}),Pt=t=>{const n=P({at:t.at,width:t.size,height:t.size});return e=>n(e)},It=t=>{const n=St(t),e=Bt(t),a=Mt(t),s=Pt(t),o=u=>(a==null?void 0:a(u))||e(u),r=zt(t),i=Wt(t),l=at(t),c=ot(t),h=u=>{n(u),i==null||i(u)},g=(u,b)=>{if(!t.textArea)return;const w=R(t),x=C(t.textArea,w);tt(u,x,b)};return{id:t.id??I(),name:"square",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:e,textHitbox:a,efficientHitbox:s,getBoundingBox:r,activateTextArea:g}},Rt=t=>{const{spacing:n,at:e,upDistance:a,downDistance:s,rotation:o,lineWidth:r,color:i}={...ct,...t},l=r*2.5,c=l/1.75,h=A({x:e.x,y:e.y-n},e,o),g=A({x:e.x+a,y:e.y-n},e,o),u=A({x:e.x+a,y:e.y+n},e,o),b=A({x:e.x+a-s+l,y:e.y+n},e,o),w=A({x:e.x+a,y:e.y},e,o),x=b,p={x:x.x-l*Math.cos(o),y:x.y-l*Math.sin(o)},k={x:x.x-c*Math.cos(o+Math.PI/2+.01),y:x.y-c*Math.sin(o+Math.PI/2+.01)},H={x:x.x+c*Math.cos(o+Math.PI/2-.01),y:x.y+c*Math.sin(o+Math.PI/2-.01)},B=gt({point1:p,point2:k,point3:H,color:i}),D=N({start:h,end:g,width:r,color:i}),y=N({start:u,end:b,width:r,color:i});return v=>{D(v),B(v),y(v),v.beginPath(),v.arc(w.x,w.y,n,Math.PI/2+o+.01,-Math.PI/2+o-.01,!0),v.strokeStyle=i,v.stroke(),v.closePath()}},_t=t=>{const{spacing:n,at:e,upDistance:a,lineWidth:s,rotation:o}=t,r=A({x:e.x+a,y:e.y},e,o),i=ft({start:e,end:r,width:2*n+s});return l=>i(l)},st=t=>()=>{const{spacing:n,at:e,upDistance:a,rotation:s,lineWidth:o}=t,r=A({x:e.x+a,y:e.y},e,s),i=Math.min(e.x,r.x)-o/2-n,l=Math.min(e.y,r.y)-o/2-n,c=Math.max(e.x,r.x)+o/2+n,h=Math.max(e.y,r.y)+o/2+n;return{topLeft:{x:i,y:l},bottomRight:{x:c,y:h}}},kt=t=>{const{topLeft:n,bottomRight:e}=st(t)(),a=e.x-n.x,s=e.y-n.y,o=P({at:{x:n.x,y:n.y},width:a,height:s});return r=>o(r)},_=t=>{const{at:n,upDistance:e,rotation:a,textArea:s,spacing:o,lineWidth:r}={...ct,...t};if(!s)throw new Error("no text area provided");const{text:i}=s,{fontSize:l}={...Q,...i},c=A({x:n.x+e+o+r/2,y:n.y},n,a);return{x:c.x-l+Math.cos(a)*15,y:c.y-l+Math.sin(a)*15}},Dt=t=>{if(!t.textArea)return;const n=_(t),e=C(t.textArea,n),{width:a,height:s}=V(e),o=E({at:e.at,width:a,height:s});return r=>o(r)},rt=t=>{if(!t.textArea)return;const n=_(t),e=C(t.textArea,n),a=K(e);return s=>a(s)},it=t=>{if(!t.textArea)return;const n=_(t),e=C(t.textArea,n),a=q(e);return s=>a(s)},Ut=t=>{const n=rt(t),e=it(t);if(!(!n||!e))return a=>{n(a),e(a)}},ct={color:"black"},$t=t=>{if(t.downDistance<0)throw new Error("downDistance must be positive");if(t.upDistance<0)throw new Error("upDistance must be positive");const n=Rt(t),e=_t(t),a=Dt(t),s=kt(t),o=u=>(a==null?void 0:a(u))||e(u),r=st(t),i=Ut(t),l=rt(t),c=it(t),h=u=>{n(u),i==null||i(u)},g=(u,b)=>{if(!t.textArea)return;const w=_(t),x=C(t.textArea,w);tt(u,x,b)};return{id:t.id??I(),name:"uturn",draw:h,drawShape:n,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:e,textHitbox:a,efficientHitbox:s,getBoundingBox:r,activateTextArea:g}},Ot=t=>{const{at:n,size:e,rotation:a,lineWidth:s,borderRadius:o}={...lt,...t},r=s/2,i=E({at:{x:n.x-e/2,y:n.y-r},width:e,height:s,rotation:a,borderRadius:o}),l=E({at:{x:n.x-r,y:n.y-e/2},width:s,height:e,rotation:a,borderRadius:o});return c=>i(c)||l(c)},Xt=t=>()=>{const{at:n,size:e}=t;return{topLeft:{x:n.x-e/2,y:n.y-e/2},bottomRight:{x:n.x+e/2,y:n.y+e/2}}},Yt=t=>{const{at:n,size:e}=t,a=P({at:{x:n.x-e/2,y:n.y-e/2},width:e,height:e});return s=>a(s)},Ft=t=>{const{at:n,size:e,rotation:a,color:s,lineWidth:o,borderRadius:r}={...lt,...t},i=o/2;return l=>{X({at:{x:n.x-i,y:n.y-e/2},width:o,height:e,color:s,borderRadius:r,rotation:a})(l),X({at:{x:n.x-e/2,y:n.y-i},width:e,height:o,color:s,borderRadius:r,rotation:a})(l)}},lt={rotation:0,color:"black",lineWidth:wt.width,borderRadius:0},Nt=t=>{if(t.lineWidth&&t.lineWidth<0)throw new Error("lineWidth must be positive");const n=Ft(t),e=Ot(t),a=Yt(t),s=i=>e(i),o=Xt(t),r=i=>{n(i)};return{id:t.id??I(),name:"cross",draw:r,drawShape:n,shapeHitbox:e,hitbox:s,efficientHitbox:a,getBoundingBox:o}},Jt=t=>n=>{const{type:e,color:a,brushWeight:s,points:o}={...Gt,...t};e==="draw"?(()=>{n.strokeStyle=a,n.lineCap="round",n.lineJoin="round",n.lineWidth=s,n.beginPath();const[l,...c]=o;n.moveTo(l.x,l.y),c.forEach(({x:h,y:g})=>n.lineTo(h,g)),n.stroke()})():(()=>{n.globalCompositeOperation="destination-out",n.lineWidth=O;for(let l=0;l<o.length-1;l++){const c=o[l],h=o[l+1],g=Math.pow(h.x-c.x,2)+Math.pow(h.y-c.y,2),u=Math.sqrt(g),b=Math.ceil(u/O);for(let w=0;w<=b;w++){const x=c.x+w/b*(h.x-c.x),p=c.y+w/b*(h.y-c.y);n.beginPath(),n.arc(x,p,O,0,Math.PI*2),n.fill()}}n.globalCompositeOperation="source-over"})(),n.lineCap="butt",n.lineJoin="miter"},Zt=t=>n=>{const{type:e,points:a}=t;if(e==="erase")return!1;const{topLeft:s,bottomRight:o}=Y(t)(),r=o.x-s.x,i=o.y-s.y;if(!E({at:{x:s.x,y:s.y},width:Math.max(r,10),height:Math.max(i,10)})(n))return!1;for(let c=0;c<a.length-1;c++){const h={start:a[c],end:a[c+1]};if(bt(h)({at:n,width:1,height:1}))return!0}return!1},Y=t=>()=>{const{points:n}=t;let e=n[0].x,a=n[0].y,s=n[0].x,o=n[0].y;for(const r of n)r.x<e&&(e=r.x),r.y<a&&(a=r.y),r.x>s&&(s=r.x),r.y>o&&(o=r.y);return{topLeft:{x:e,y:a},bottomRight:{x:s,y:o}}},jt=t=>{if(t.type==="erase")return r=>!1;const{topLeft:n,bottomRight:e}=Y(t)(),a=e.x-n.x,s=e.y-n.y,o=P({at:{x:n.x,y:n.y},width:Math.max(a,10),height:Math.max(s,10)});return r=>o(r)},Gt={color:"red",brushWeight:3},O=50,Vt=t=>{if(t.points.length<1)throw new Error("not enough points to draw scribble");if(t.brushWeight&&t.brushWeight<1)throw new Error('brushWeight must be at least "1"');const n=Zt(t),e=jt(t),a=i=>n(i),s=Y(t),o=Jt(t),r=i=>{o(i)};return{id:t.id??I(),name:"scribble",drawShape:o,draw:r,hitbox:a,shapeHitbox:n,efficientHitbox:e,getBoundingBox:s}},Kt=vt,Qt=yt,qt=mt,te=Tt,ee=It,ne=At,ae=$t,ht=Nt,oe=Vt,fe={arrow:Qt,circle:qt,line:Kt,rect:te,square:ee,triangle:ne,uturn:ae,cross:ht,scribble:oe},W=t=>{if(!t)throw new Error("canvas not found");const n="value"in t?t.value:t;if(!n)throw new Error("canvas not found");const e=n.getContext("2d");if(!e)throw new Error("2d context not found");return e},se=()=>{const{class:t}=Ct();return z(()=>{if(!t)return[];if(typeof t!="string")throw new Error("class attribute must be a string");return t.split(" ")})},re=(t,n)=>{let e;return()=>{clearTimeout(e),e=setTimeout(t,n)}},ie=.5,ce=5;function le(t){const n=T(1),e=T({x:0,y:0}),a=o=>{if(!o.ctrlKey)return;o.preventDefault();const r=t.value;if(!r)return;const i=r.getBoundingClientRect(),l=o.clientX-i.left,c=o.clientY-i.top,h=o.deltaY<0?1.03:.97,g=Math.min(ce,Math.max(ie,n.value*h));e.value.x=l-(l-e.value.x)*(g/n.value),e.value.y=c-(c-e.value.y)*(g/n.value),n.value=g,s()},s=()=>{const o=W(t);o.resetTransform(),o.translate(e.value.x,e.value.y),o.scale(n.value,n.value)};return et(()=>{const o=t.value;if(!o)throw new Error("Canvas ref is not defined");o.addEventListener("wheel",a,{passive:!1})}),nt(()=>{const o=t.value;o&&o.removeEventListener("wheel",a)}),{scale:n,origin:e}}const he=t=>{const n=U("pan-zoom-scale",0),e=U("pan-zoom-pan-x",0),a=U("pan-zoom-pan-y",0),s=()=>{const r=W(t),{a:i,e:l,f:c}=r.getTransform();n.value=i,e.value=l,a.value=c},o=()=>{W(t)};return et(()=>{t.value&&(t.value.addEventListener("wheel",s),t.value.addEventListener("mousedown",s),t.value.addEventListener("mouseup",s),setTimeout(()=>o(),0))}),nt(()=>{t.value&&(t.value.removeEventListener("wheel",s),t.value.removeEventListener("mousedown",s),t.value.removeEventListener("mouseup",s))}),{track:s,apply:o,scale:n,panX:e,panY:a}},ue=["width","height"],de=["width","height"],we=Et({__name:"ResponsiveCanvas",props:{color:{},patternColor:{},canvasWidth:{},canvasHeight:{}},emits:["canvasRef","widthChange","heightChange"],setup(t,{emit:n}){const e=T(0),a=T(0),s=T(!0),o=T(),r=T(),i=t,l=z(()=>(i==null?void 0:i.canvasWidth)??5e3),c=z(()=>(i==null?void 0:i.canvasHeight)??3e3),h=n,g=["w-full","h-full","relative","overflow-auto"],u=se(),b=z(()=>[...g,...u.value]),w=d=>{o.value=d,h("canvasRef",d)},x=T(),{height:p,width:k}=pt(x),H=()=>{e.value=l.value,a.value=c.value},B=async()=>x.value??new Promise(d=>{const f=setInterval(()=>{x.value&&(clearInterval(f),d(x.value))},100)}),D=async()=>new Promise(d=>{const f=setInterval(()=>{r.value&&(d(W(r.value)),clearInterval(f))},100)}),y=async()=>{const d=await D();d.clearRect(0,0,e.value,a.value);const f=75,m=(L,S)=>{ht({at:{x:L,y:S},size:2,color:i.patternColor}).draw(d)},ut=e.value,dt=a.value;for(let L=f/2;L<ut;L+=f)for(let S=f/2;S<dt;S+=f)m(L,S)},v=re(y,250);(async()=>{y();const d=await B(),f=a.value/2-d.clientHeight/2;d.scrollTop=f;const m=e.value/2-d.clientWidth/2;d.scrollLeft=m,s.value=!1})(),M(p,()=>{H(),y(),h("widthChange",e.value)}),M(k,()=>{H(),y(),h("heightChange",a.value)}),M([l,c],()=>{H(),y(),h("widthChange",e.value),h("heightChange",a.value)}),M(()=>i.patternColor,y),Ht({canvasWidth:e,canvasHeight:a,getParentEl:B});const F=le(o);return he(o),M(F.scale,()=>{const{scale:d,origin:f}=F,m=W(r.value);m.clearRect(0,0,e.value,a.value),m.resetTransform(),m.translate(f.value.x,f.value.y),m.scale(d.value,d.value),v()}),(d,f)=>(G(),J("div",{ref_key:"parentEl",ref:x,class:$(b.value),id:"responsive-canvas-container"},[s.value?(G(),J("div",{key:0,style:Z({backgroundColor:d.color}),class:"absolute top-0 left-0 w-full h-full"},null,4)):Lt("",!0),j("canvas",{ref:w,width:e.value,height:a.value,class:$([`w-[${e.value}px]`,`h-[${a.value}px]`]),id:"responsive-canvas"},null,10,ue),j("canvas",{ref_key:"bgCanvas",ref:r,width:e.value,height:a.value,style:Z({backgroundColor:d.color}),class:$([`w-[${e.value}px]`,`h-[${a.value}px]`,"absolute","top-0","-z-10","pointer-events-none"])},null,14,de)],2))}});export{we as _,ee as a,ae as b,qt as c,re as d,Qt as e,W as g,Kt as l,te as r,fe as s,se as u};
