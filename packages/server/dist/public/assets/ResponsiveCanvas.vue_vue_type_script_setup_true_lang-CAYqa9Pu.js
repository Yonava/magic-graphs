import{bI as A,bJ as Y,bK as M,bL as F,bM as G,bN as k,bO as _,bP as R,ai as I,bQ as bt,bR as st,bS as it,bT as ae,bU as re,bV as mt,bW as Tt,bX as $,bY as q,bZ as Et,b_ as St,b$ as m,c0 as wt,c1 as Lt,c2 as Ht,c3 as oe,c4 as Mt,c5 as se,c6 as ie,c7 as ce,c8 as le,c9 as ue,ca as de,z as he,cb as xe,cc as fe,g as L,ap as ct,al as lt,L as p,O as X,bi as we,E as U,N as tt,bu as ge,d as ye,cd as ve,ce as Ae,c as gt,Z as yt,C as be,a as vt,I as et,o as At}from"./index-BBtyRjRC.js";const ut=t=>{const{pointA:e,pointB:n,pointC:a,textArea:r}={...zt,...t};if(!r)throw new Error("no text area provided");const{text:o}=r,{fontSize:s}={...G,...o},i=(e.x+n.x+a.x)/3,l=(e.y+n.y+a.y)/3;return{x:i-s,y:l-s}},me=t=>{if(!t.textArea)return;const e=ut(t),n=A(t.textArea,e),{width:a,height:r}=Y(n),o=M({at:n.at,width:a,height:r});return s=>o(s)},Ct=t=>{if(!t.textArea)return;const e=ut(t),n=A(t.textArea,e),a=F(n);return r=>a(r)},Bt=t=>{if(!t.textArea)return;const e=ut(t),n=A(t.textArea,e),a=k(n);return r=>a(r)},Te=t=>{const e=Ct(t),n=Bt(t);if(!(!e||!n))return a=>{e(a),n(a)}},It=t=>e=>{const{pointA:n,pointB:a,pointC:r,stroke:o}=t;if(o){const d={start:n,end:a,width:o.width},f={start:a,end:r,width:o.width},w={start:r,end:n,width:o.width};return _(d)(e)||_(f)(e)||_(w)(e)}const{x:s,y:i}=e,l=.5*(-a.y*r.x+n.y*(-a.x+r.x)+n.x*(a.y-r.y)+a.x*r.y),c=1/(2*l)*(n.y*r.x-n.x*r.y+(r.y-n.y)*s+(n.x-r.x)*i),u=1/(2*l)*(n.x*a.y-n.y*a.x+(n.y-a.y)*s+(a.x-n.x)*i);return c>0&&u>0&&1-c-u>0},Pt=t=>()=>{const{pointA:e,pointB:n,pointC:a}=t,r=Math.min(e.x,n.x,a.x),o=Math.min(e.y,n.y,a.y),s=Math.max(e.x,n.x,a.x),i=Math.max(e.y,n.y,a.y);return{at:{x:r,y:o},width:s-r,height:i-o}},Wt=t=>{const e=Pt(t)(),n=R(e);return a=>n(a)},zt={color:"black"},Ee=t=>{const e=Rt(t),n=It(t),a=me(t),r=Wt(t),o=h=>n(h),s=Pt(t),i=Te(t),l=Ct(t),c=Bt(t),u=h=>{e(h),i==null||i(h)};return{id:t.id??I(),name:"triangle",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s}},Rt=t=>e=>{const{pointA:n,pointB:a,pointC:r,color:o,stroke:s,gradientStops:i}={...zt,...t};if(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.lineTo(r.x,r.y),i&&i.length>=2){const l={x:(a.x+r.x)/2,y:(a.y+r.y)/2},c=e.createLinearGradient(l.x,l.y,n.x,n.y);i.forEach(({offset:u,color:h})=>{c.addColorStop(u,h)}),e.fillStyle=c}else e.fillStyle=o;e.fill(),e.closePath(),s&&(e.lineWidth=s.width,e.strokeStyle=s.color,s.dash?e.setLineDash(s.dash):e.setLineDash([]),e.stroke(),e.setLineDash([]))},pt=t=>{var E;const{start:e,end:n,width:a,color:r,dash:o,gradientStops:s,arrowHeadSize:i,arrowHeadShape:l}={...j,...t},c=Math.atan2(n.y-e.y,n.x-e.x),{arrowHeadHeight:u,perpLineLength:h}=i(a),d={x:n.x-u*Math.cos(c),y:n.y-u*Math.sin(c)},f={start:e,end:{x:d.x+Math.cos(c),y:d.y+Math.sin(c)},width:a,color:r,dash:o,gradientStops:s},w=bt(f),x=n,H={x:d.x+h*Math.cos(c+Math.PI/2),y:d.y+h*Math.sin(c+Math.PI/2)},C={x:d.x-h*Math.cos(c+Math.PI/2),y:d.y-h*Math.sin(c+Math.PI/2)},T=l?l(n,u,h).draw:Rt({pointA:x,pointB:H,pointC:C,color:s&&s.length?(E=s.at(-1))==null?void 0:E.color:r});return B=>{w(B),T(B)}},Ot=t=>{const{start:e,end:n,width:a,arrowHeadSize:r,arrowHeadShape:o}={...j,...t},s=_(t),{arrowHeadHeight:i,perpLineLength:l}=r(a),c=st({start:e,end:n,width:a,arrowHeadSize:r}),u=o?o(n,i,l).hitbox:It(c);return h=>s(h)||u(h)},Se=t=>()=>{const{at:e,width:n,height:a}=ae(t)(),r={x:e.x,y:e.y},o={x:e.x+n,y:e.y+a},{start:s,end:i,width:l,arrowHeadSize:c}={...j,...t},u=st({start:s,end:i,width:l,arrowHeadSize:c}),h=Math.min(r.x,u.pointA.x,u.pointB.x,u.pointC.x),d=Math.max(r.x,u.pointA.x,u.pointB.x,u.pointC.x),f=Math.min(o.y,u.pointA.y,u.pointB.y,u.pointC.y),w=Math.max(o.y,u.pointA.y,u.pointB.y,u.pointC.y);return{at:{x:h,y:f},width:d-h,height:w-f}},Le=t=>{const e=it(t),{start:n,end:a,width:r,arrowHeadSize:o}={...j,...t},s=st({start:n,end:a,width:r,arrowHeadSize:o}),i=Wt(s);return l=>e(l)||i(l)},Z=t=>{const{textArea:e}=t;if(!e)throw new Error("no text area provided");return re(t)},He=t=>{if(!t.textArea)return;const e=Z(t),n=A(t.textArea,e),{width:a,height:r}=Y(n),o=M({at:n.at,width:a,height:r});return s=>o(s)},Dt=t=>{if(!t.textArea)return;const e=Z(t),n=A(t.textArea,e),a=F(n);return r=>a(r)},_t=t=>{if(!t.textArea)return;const e=Z(t),n=A(t.textArea,e),a=k(n);return r=>a(r)},Me=t=>{const e=Dt(t),n=_t(t);if(!(!e||!n))return a=>{e(a),n(a)}},j={...mt,arrowHeadSize:Tt},Ce=t=>{if(t.width&&t.width<0)throw new Error("width must be positive");const e=pt(t),n=Ot(t),a=He(t),r=Le(t),o=d=>(a==null?void 0:a(d))||n(d),s=Se(t),i=Me(t),l=Dt(t),c=_t(t),u=d=>{e(d),i==null||i(d)},h=(d,f)=>{if(!t.textArea)return;const w=Z(t),x=A(t.textArea,w);$(d,x,f)};return{id:t.id??I(),name:"arrow",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},Be=t=>{const e=q({width:t.size,height:t.size,...t});return n=>e(n)},J=t=>{const{at:e,size:n,textArea:a}=t;if(!a)throw new Error("no text area provided");const{text:r}=a,{fontSize:o}={...G,...r},s=e.x+n/2,i=e.y+n/2;return{x:s-o,y:i-o}},Ie=t=>{if(!t.textArea)return;const e=J(t),n=A(t.textArea,e),{width:a,height:r}=Y(n),o=M({at:n.at,width:a,height:r});return s=>o(s)},Ut=t=>{if(!t.textArea)return;const e=J(t),n=A(t.textArea,e),a=F(n);return r=>a(r)},Xt=t=>{if(!t.textArea)return;const e=J(t),n=A(t.textArea,e),a=k(n);return r=>a(r)},Pe=t=>{const e=Ut(t),n=Xt(t);if(!(!e||!n))return a=>{e(a),n(a)}},We=t=>{const{at:e,size:n,borderRadius:a,rotation:r,stroke:o}={...pe,...t},s=M({at:e,width:n,height:n,borderRadius:a,rotation:r,stroke:o});return i=>s(i)},ze=t=>Et({at:t.at,width:t.size,height:t.size}),Re=t=>{const e=R({at:t.at,width:t.size,height:t.size});return n=>e(n)},pe=St,Oe=t=>{const e=Be(t),n=We(t),a=Ie(t),r=Re(t),o=d=>(a==null?void 0:a(d))||n(d),s=ze(t),i=Pe(t),l=Ut(t),c=Xt(t),u=d=>{e(d),i==null||i(d)},h=(d,f)=>{if(!t.textArea)return;const w=J(t),x=A(t.textArea,w);$(d,x,f)};return{id:t.id??I(),name:"square",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},De=t=>{const{spacing:e,at:n,upDistance:a,downDistance:r,rotation:o,lineWidth:s,color:i,arrowHeadShape:l,arrowHeadSize:c,gradientStops:u}={...$t,...t},h=m({x:n.x,y:n.y-e},n,o),d=m({x:n.x+a,y:n.y-e},n,o),f=m({x:n.x+a,y:n.y+e},n,o),w=m({x:n.x+a-r,y:n.y+e},n,o),x=m({x:n.x+a,y:n.y},n,o);let H=[],C=[],T=[];if(u.length>=2){const g=a+r+Math.PI*e,P=wt(u,a/g),z=wt(u,(g-r)/g);H=[...u.filter(v=>v.offset<=a/g),{offset:1,color:P}],C=[{offset:0,color:P},...u.filter(v=>v.offset>=a/g&&v.offset<=(g-r)/g).map(v=>({offset:(v.offset-a/g)/(Math.PI*e/g),color:v.color})),{offset:1,color:z}],T=[{offset:0,color:z},...u.filter(v=>v.offset>=(g-r)/g).map(v=>({offset:(v.offset-(g-r)/g)/(r/g),color:v.color}))]}const E=bt({start:h,end:d,width:s,color:i,gradientStops:H}),B=pt({start:f,end:w,width:s,color:i,arrowHeadSize:c,arrowHeadShape:l,gradientStops:T});return g=>{if(E(g),B(g),g.beginPath(),g.strokeStyle=i,C.length>=2){const P=Math.PI/2+o+.01,z=-Math.PI/2+o-.01,v=x.x+Math.cos(P)*e,Q=x.y+Math.sin(P)*e,ft=x.x+Math.cos(z)*e,N=x.y+Math.sin(z)*e,y=g.createLinearGradient(ft,N,v,Q);for(const b of C)y.addColorStop(b.offset,b.color);g.strokeStyle=y}g.arc(x.x,x.y,e,Math.PI/2+o+.01,-Math.PI/2+o-.01,!0),g.lineWidth=s,g.stroke(),g.closePath()}},_e=t=>{const{spacing:e,at:n,downDistance:a,upDistance:r,lineWidth:o,rotation:s}=t,i=m({x:n.x,y:n.y-e},n,s),l=m({x:n.x+r,y:n.y-e},n,s),c=m({x:n.x+r,y:n.y+e},n,s),u=m({x:n.x+r-a,y:n.y+e},n,s),h=m({x:n.x+r,y:n.y},n,s),d=_({start:i,end:l,width:o}),f=Ot({start:c,end:u,width:o}),w=Lt({at:h,radius:e+o/2});return x=>d(x)||f(x)||w(x)},Yt=t=>()=>{const{spacing:e,at:n,upDistance:a,rotation:r,lineWidth:o}=t,s=m({x:n.x+a,y:n.y},n,r),i=Math.min(n.x,s.x)-o/2-e,l=Math.min(n.y,s.y)-o/2-e,c=Math.max(n.x,s.x)+o/2+e,u=Math.max(n.y,s.y)+o/2+e;return{at:{x:i,y:l},width:c-i,height:u-l}},Ue=t=>{const e=Yt(t)(),n=R(e);return a=>n(a)},K=t=>{const{at:e,upDistance:n,rotation:a,textArea:r,spacing:o,lineWidth:s}={...$t,...t};if(!r)throw new Error("no text area provided");const{text:i}=r,{fontSize:l}={...G,...i},c=m({x:e.x+n+o+s/2,y:e.y},e,a);return{x:c.x-l+Math.cos(a)*15,y:c.y-l+Math.sin(a)*15}},Xe=t=>{if(!t.textArea)return;const e=K(t),n=A(t.textArea,e),{width:a,height:r}=Y(n),o=M({at:n.at,width:a,height:r});return s=>o(s)},Ft=t=>{if(!t.textArea)return;const e=K(t),n=A(t.textArea,e),a=F(n);return r=>a(r)},kt=t=>{if(!t.textArea)return;const e=K(t),n=A(t.textArea,e),a=k(n);return r=>a(r)},Ye=t=>{const e=Ft(t),n=kt(t);if(!(!e||!n))return a=>{e(a),n(a)}},$t={color:"black",arrowHeadSize:Tt,gradientStops:[]},Fe=t=>{if(t.downDistance<0)throw new Error("downDistance must be positive");if(t.upDistance<0)throw new Error("upDistance must be positive");const e=De(t),n=_e(t),a=Xe(t),r=Ue(t),o=d=>(a==null?void 0:a(d))||n(d),s=Yt(t),i=Ye(t),l=Ft(t),c=kt(t),u=d=>{e(d),i==null||i(d)},h=(d,f)=>{if(!t.textArea)return;const w=K(t),x=A(t.textArea,w);$(d,x,f)};return{id:t.id??I(),name:"uturn",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},ke=t=>{const{at:e,size:n,rotation:a,lineWidth:r,borderRadius:o}={...qt,...t},s=r/2,i=M({at:{x:e.x-n/2,y:e.y-s},width:n,height:r,rotation:a,borderRadius:o}),l=M({at:{x:e.x-s,y:e.y-n/2},width:r,height:n,rotation:a,borderRadius:o});return c=>i(c)||l(c)},Nt=t=>()=>{const{at:e,size:n}=t;return{at:{x:e.x-n/2,y:e.y-n/2},width:n,height:n}},$e=t=>{const e=Nt(t)(),n=R(e);return a=>n(a)},Ne=t=>{const{at:e,size:n,rotation:a,color:r,lineWidth:o,borderRadius:s}={...qt,...t},i=o/2;return l=>{q({at:{x:e.x-i,y:e.y-n/2},width:o,height:n,color:r,borderRadius:s,rotation:a})(l),q({at:{x:e.x-n/2,y:e.y-i},width:n,height:o,color:r,borderRadius:s,rotation:a})(l)}},qt={rotation:0,color:"black",lineWidth:mt.width,borderRadius:0},qe=t=>{if(t.lineWidth&&t.lineWidth<0)throw new Error("lineWidth must be positive");const e=Ne(t),n=ke(t),a=$e(t),r=i=>n(i),o=Nt(t),s=i=>{e(i)};return{id:t.id??I(),name:"cross",draw:s,drawShape:e,shapeHitbox:n,hitbox:r,efficientHitbox:a,getBoundingBox:o}},Ge=t=>e=>{const{type:n,color:a,brushWeight:r,points:o}={...ht,...t};n==="draw"?(()=>{if(o.length===1){Ht({at:o[0],radius:r/2,color:a}).draw(e);return}e.strokeStyle=a,e.lineCap="round",e.lineJoin="round",e.lineWidth=r,e.beginPath();const[l,...c]=o;e.moveTo(l.x,l.y),c.forEach(({x:u,y:h})=>e.lineTo(u,h)),e.stroke()})():(()=>{e.globalCompositeOperation="destination-out",e.lineWidth=nt;for(let l=0;l<o.length-1;l++){const c=o[l],u=o[l+1],h=Math.pow(u.x-c.x,2)+Math.pow(u.y-c.y,2),d=Math.sqrt(h),f=Math.ceil(d/nt);for(let w=0;w<=f;w++){const x=c.x+w/f*(u.x-c.x),H=c.y+w/f*(u.y-c.y);e.beginPath(),e.arc(x,H,nt,0,Math.PI*2),e.fill()}}e.globalCompositeOperation="source-over"})(),e.lineCap="butt",e.lineJoin="miter"},Ze=t=>e=>{const{type:n,points:a,brushWeight:r}={...ht,...t};if(n==="erase")return!1;const{at:o,width:s,height:i}=dt(t)();if(!M({at:o,width:Math.max(s,10),height:Math.max(i,10)})(e))return!1;if(a.length===1&&Lt({at:a[0],radius:r})(e))return!0;for(let c=0;c<a.length-1;c++){const u={start:a[c],end:a[c+1]};if(it(u)({at:e,width:1,height:1}))return!0}return!1},dt=t=>()=>{const{points:e}=t;let n=e[0].x,a=e[0].y,r=e[0].x,o=e[0].y;for(const s of e)s.x<n&&(n=s.x),s.y<a&&(a=s.y),s.x>r&&(r=s.x),s.y>o&&(o=s.y);return{at:{x:n,y:a},width:r-n,height:o-a}},je=t=>e=>{if(t.type==="erase")return!1;const{at:n,width:a,height:r}=dt(t)(),o=R({at:n,width:Math.max(a,10),height:Math.max(r,10)}),{points:s,brushWeight:i}={...ht,...t};if(s.length===1&&oe({at:s[0],radius:i})(e))return!0;if(!o(e))return!1;for(let l=0;l<s.length-1;l++){const c={start:s[l],end:s[l+1]};if(it(c)(e))return!0}return!1},ht={color:"red",brushWeight:3},nt=50,Je=t=>{if(t.points.length<1)throw new Error("not enough points to draw scribble");if(t.brushWeight&&t.brushWeight<1)throw new Error('brushWeight must be at least "1"');const e=Ze(t),n=je(t),a=i=>e(i),r=dt(t),o=Ge(t),s=i=>{o(i)};return{id:t.id??I(),name:"scribble",drawShape:o,draw:s,hitbox:a,shapeHitbox:e,efficientHitbox:n,getBoundingBox:r}},Ke=t=>e=>{const{at:n,radiusX:a,radiusY:r,color:o,stroke:s}={...Jt,...t};if(e.beginPath(),e.ellipse(n.x,n.y,a,r,0,0,2*Math.PI),e.fillStyle=o,e.fill(),s){const{color:i,width:l,dash:c}=s;e.strokeStyle=i,e.lineWidth=l,e.setLineDash(c||[]),e.stroke(),e.setLineDash([])}e.closePath()},Ve=t=>e=>{const n=e.x-t.at.x,a=e.y-t.at.y,r={...Mt,...t.stroke},o=t.radiusX+r.width/2,s=t.radiusY+r.width/2;return n*n/(o*o)+a*a/(s*s)<=1},Gt=t=>()=>{const{at:e,radiusX:n,radiusY:a}=t,{width:r}={...Mt,...t.stroke};return{at:{x:e.x-(n+r/2),y:e.y-(a+r/2)},width:2*n+r,height:2*a+r}},Qe=t=>{const e=Gt(t)(),n=R(e);return a=>n(a)},V=t=>{const{at:e,textArea:n}={...Jt,...t};if(!n)throw new Error("no text area provided");const{text:a}=n,{fontSize:r}={...G,...a};return{x:e.x-r,y:e.y-r}},tn=t=>{if(!t.textArea)return;const e=V(t),n=A(t.textArea,e),{width:a,height:r}=Y(n),o=M({at:n.at,width:a,height:r});return s=>o(s)},Zt=t=>{if(!t.textArea)return;const e=V(t),n=A(t.textArea,e),a=F(n);return r=>a(r)},jt=t=>{if(!t.textArea)return;const e=V(t),n=A(t.textArea,e),a=k(n);return r=>a(r)},en=t=>{const e=Zt(t),n=jt(t);if(!(!e||!n))return a=>{e(a),n(a)}},Jt=se,nn=t=>{if(t.radiusX<0||t.radiusY<0)throw new Error("radius must be positive");const e=Ke(t),n=Ve(t),a=tn(t),r=Qe(t),o=d=>(a==null?void 0:a(d))||n(d),s=Gt(t),i=en(t),l=Zt(t),c=jt(t),u=d=>{e(d),i==null||i(d)},h=(d,f)=>{if(!t.textArea)return;const w=V(t),x=A(t.textArea,w);$(d,x,f)};return{id:I(),name:"ellipse",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},an=t=>{const{at:e,innerRadius:n,outerRadius:a,points:r=5,rotation:o=0}=t,s=[];for(let i=0;i<r*2;i++){const l=i%2===0?a:n,c=i*Math.PI/r,u=Math.cos(c)*l,h=Math.sin(c)*l,d=m({x:u,y:h},{x:0,y:0},o);s.push({x:d.x+e.x,y:d.y+e.y})}return s},rn=(t,e)=>{let n=!1;for(let a=0,r=e.length-1;a<e.length;r=a++){const o=e[a].x,s=e[a].y,i=e[r].x,l=e[r].y;s>t.y!=l>t.y&&(l-s!==0?t.x<(i-o)*(t.y-s)/(l-s)+o:t.x<o)&&(n=!n)}return n},on=t=>e=>{const n=an(t);return rn(e,n)},Kt=t=>()=>{const{at:e,outerRadius:n}=t,a=n*2;return{at:{x:e.x-n,y:e.y-n},width:a,height:a}},sn=t=>e=>{const n=Kt(t)();return e.at.x<n.at.x+n.width&&e.at.x+e.width>n.at.x&&e.at.y<n.at.y+n.height&&e.at.y+e.height>n.at.y},cn=t=>{const{at:e,color:n,innerRadius:a,outerRadius:r,rotation:o,points:s}={...ln,...t};if(s<3)throw new Error("star must have at least 3 points");if(a>=r)throw new Error("inner radius must be less than outer radius");if(a<0||r<0)throw new Error("radius values must be positive");return i=>{i.save(),i.beginPath(),i.translate(e.x,e.y),i.rotate(o);for(let l=0;l<s*2;l++){const c=l%2===0?r:a,u=l*Math.PI/s,h=Math.cos(u)*c,d=Math.sin(u)*c;l===0?i.moveTo(h,d):i.lineTo(h,d)}i.closePath(),i.fillStyle=n,i.fill(),i.restore()}},ln={color:"black",points:5,rotation:0},un=t=>{const e=cn(t),n=on(t),a=n,r=sn(t),o=Kt(t);return{id:t.id??I(),name:"star",draw:e,drawShape:e,hitbox:a,shapeHitbox:n,efficientHitbox:r,getBoundingBox:o}},at=new Map,dn=(t,e)=>{if(at.has(t))return at.get(t);const n={image:null,loading:!0,error:!1};at.set(t,n);const a=new Image;return a.onload=()=>{var r;n.image=a,n.loading=!1,(r=e==null?void 0:e.onLoad)==null||r.call(e)},a.onerror=()=>{var r;n.loading=!1,n.error=!0,(r=e==null?void 0:e.onLoadError)==null||r.call(e)},a.src=t,n},hn=t=>{const{src:e,onLoad:n,onLoadError:a,...r}={...Vt,...t},{width:o,height:s,at:i,rotation:l}=r;return c=>{const{image:u,loading:h,error:d}=dn(e,{onLoad:n,onLoadError:a});q(r)(c),c.save();const f=i.x+o/2,w=i.y+s/2;if(c.translate(f,w),l&&c.rotate(l),h)c.fillStyle="#888888",c.textAlign="center",c.textBaseline="middle",c.fillText("Loading...",0,0);else if(d){const H=-o/2,C=-s/2;for(let T=0;T<Math.ceil(s/10);T++)for(let E=0;E<Math.ceil(o/10);E++)c.fillStyle=(E+T)%2===0?"#FF00DC":"#000000",c.fillRect(H+E*10,C+T*10,10,10)}else u&&c.drawImage(u,-o/2,-s/2,o,s);c.restore()}},xn=t=>{const{at:e,width:n,height:a,rotation:r}={...Vt,...t},o=M({at:e,width:n,height:a,rotation:r});return s=>o(s)},fn=t=>{const{at:e,width:n,height:a}=t;return Et({at:e,width:n,height:a})},wn=t=>{const{at:e,width:n,height:a}=t,r=R({at:e,width:n,height:a});return o=>r(o)},gn=t=>de(t),yn=t=>{if(t.textArea)return ie(t)},vn=t=>{if(t.textArea)return ce(t)},An=t=>{if(t.textArea)return le(t)},bn=t=>{if(t.textArea)return ue(t)},Vt={...St,color:he.TRANSPARENT},mn=t=>{if(t.width<0||t.height<0)throw new Error("width and height must be positive");const e=hn(t),n=xn(t),a=yn(t),r=wn(t),o=d=>(a==null?void 0:a(d))||n(d),s=fn(t),i=bn(t),l=vn(t),c=An(t),u=d=>{e(d),i==null||i(d)},h=(d,f)=>{if(!t.textArea)return;const w=gn(t),x=A(t.textArea,w);$(d,x,f)};return{id:t.id??I(),name:"image",draw:u,drawShape:e,drawTextArea:i,drawTextAreaMatte:l,drawText:c,hitbox:o,shapeHitbox:n,textHitbox:a,efficientHitbox:r,getBoundingBox:s,activateTextArea:h}},Tn=xe,En=Ce,Sn=Ht,Ln=fe,Hn=Oe,Mn=Ee,Cn=Fe,Qt=qe,Bn=Je,In=nn,Pn=un,Wn=mn,Yn={arrow:En,circle:Sn,line:Tn,rect:Ln,square:Hn,triangle:Mn,uturn:Cn,cross:Qt,scribble:Bn,ellipse:In,star:Pn,image:Wn},rt=.5,ot=5,S=L(1),xt=.1,te=(t=xt)=>{S.value=Math.max(Math.min(Math.round((S.value+t)*1e3)/1e3,ot),rt)},Fn=(t=xt)=>{te(t)},kn=(t=-xt)=>{te(t)},zn=t=>{const e=L({x:0,y:0});let n=!1;const a=o=>{if(!o.ctrlKey)return;o.preventDefault(),n=!0;const s=t.value;if(!s)return;const i=s.getBoundingClientRect(),l=o.clientX-i.left,c=o.clientY-i.top,u=o.deltaY<0?1.03:.97,h=Math.min(ot,Math.max(rt,S.value*u));h<=rt||h>=ot||(e.value.x=l-(l-e.value.x)*(h/S.value),e.value.y=c-(c-e.value.y)*(h/S.value),S.value=h)},r=()=>{const o=X(t);o.resetTransform(),o.translate(e.value.x,e.value.y),o.scale(S.value,S.value)};return ct(()=>{const o=t.value;if(!o)throw new Error("Canvas ref is not defined");o.addEventListener("wheel",a,{passive:!1})}),lt(()=>{const o=t.value;o&&o.removeEventListener("wheel",a)}),p(S,(o,s)=>{const i=t.value;if(i){if(!n){const l=i.getBoundingClientRect(),c=window.innerWidth/2,u=window.innerHeight/2,h=c-l.left,d=u-l.top;e.value.x=h-(h-e.value.x)*(S.value/s),e.value.y=d-(d-e.value.y)*(S.value/s)}r(),n=!1}}),{scale:S,origin:e}},Rn=(t,e)=>{let n;return()=>{clearTimeout(n),n=setTimeout(t,e)}},pn=()=>{const{class:t}=we();return U(()=>{if(!t)return[];if(typeof t!="string")throw new Error("class attribute must be a string");return t.split(" ")})},On=t=>{const e=tt("pan-zoom-scale",0),n=tt("pan-zoom-pan-x",0),a=tt("pan-zoom-pan-y",0),r=()=>{const s=X(t),{a:i,e:l,f:c}=s.getTransform();e.value=i,n.value=l,a.value=c},o=()=>{X(t)};return ct(()=>{t.value&&(t.value.addEventListener("wheel",r),t.value.addEventListener("mousedown",r),t.value.addEventListener("mouseup",r),setTimeout(()=>o(),0))}),lt(()=>{t.value&&(t.value.removeEventListener("wheel",r),t.value.removeEventListener("mousedown",r),t.value.removeEventListener("mouseup",r))}),{track:r,apply:o,scale:e,panX:n,panY:a}},Dn=t=>{const e=L(!0),n=L(!1),a=L({x:0,y:0}),r=L({x:0,y:0}),o=c=>{e.value&&t.value&&c.button===ge.middle&&(c.preventDefault(),n.value=!0,a.value={x:c.clientX,y:c.clientY},r.value={x:t.value.scrollLeft,y:t.value.scrollTop})},s=c=>{if(!n.value||!t.value)return;const u=a.value.x-c.clientX,h=a.value.y-c.clientY;t.value.scrollLeft=r.value.x+u,t.value.scrollTop=r.value.y+h},i=()=>{n.value=!1},l=c=>{if(!t.value)return;const{left:u=0,top:h=0,behavior:d}=c,f=u-window.screen.width/2,w=h-window.screen.height/2;t.value.scrollTo({left:f,top:w,behavior:d})};return{allowPanning:e,isPanning:U(()=>n.value),teleportTo:l,startPan:o,pan:s,endPan:i}},_n=["width","height"],Un=["width","height"],$n=ye({__name:"ResponsiveCanvas",props:{color:{},patternColor:{},canvasWidth:{},canvasHeight:{}},emits:["canvasRef","widthChange","heightChange"],setup(t,{emit:e}){const n=L(0),a=L(0),r=L(!0),o=L(),s=L(),i=t,l=U(()=>(i==null?void 0:i.canvasWidth)??5e3),c=U(()=>(i==null?void 0:i.canvasHeight)??3e3),u=e,h=["w-full","h-full","relative","overflow-auto"],d=pn(),f=U(()=>[...h,...d.value]),w=y=>{o.value=y,u("canvasRef",y)},x=L(),{height:H,width:C}=ve(x),{startPan:T,pan:E,endPan:B}=Dn(x),g=()=>{n.value=l.value,a.value=c.value},P=async()=>x.value??new Promise(y=>{const b=setInterval(()=>{x.value&&(clearInterval(b),y(x.value))},100)}),z=async()=>new Promise(y=>{const b=setInterval(()=>{s.value&&(y(X(s.value)),clearInterval(b))},100)}),v=async()=>{const y=await z();y.clearRect(0,0,n.value,a.value);const b=75,W=(O,D)=>{Qt({at:{x:O,y:D},size:2,color:i.patternColor}).draw(y)},ee=n.value,ne=a.value;for(let O=b/2;O<ee;O+=b)for(let D=b/2;D<ne;D+=b)W(O,D)},Q=Rn(v,250);(async()=>{v();const y=await P(),b=a.value/2-y.clientHeight/2;y.scrollTop=b;const W=n.value/2-y.clientWidth/2;y.scrollLeft=W,r.value=!1})(),p(H,()=>{g(),v(),u("widthChange",n.value)}),p(C,()=>{g(),v(),u("heightChange",a.value)}),p([l,c],()=>{g(),v(),u("widthChange",n.value),u("heightChange",a.value)}),p(()=>i.patternColor,v),Ae({canvasWidth:n,canvasHeight:a,getParentEl:P});const N=zn(o);return On(o),p(N.scale,()=>{const{scale:y,origin:b}=N,W=X(s.value);W.clearRect(0,0,n.value,a.value),W.resetTransform(),W.translate(b.value.x,b.value.y),W.scale(y.value,y.value),Q()}),ct(()=>{x.value&&(x.value.addEventListener("mousedown",T),x.value.addEventListener("mousemove",E),x.value.addEventListener("mouseup",B),x.value.addEventListener("mouseleave",B),x.value.addEventListener("contextmenu",y=>y.preventDefault()))}),lt(()=>{x.value&&(x.value.removeEventListener("mousedown",T),x.value.removeEventListener("mousemove",E),x.value.removeEventListener("mouseup",B),x.value.removeEventListener("mouseleave",B),x.value.removeEventListener("contextmenu",y=>y.preventDefault()))}),(y,b)=>(At(),gt("div",{ref_key:"parentEl",ref:x,id:"responsive-canvas-container",class:et(f.value)},[r.value?(At(),gt("div",{key:0,style:yt({backgroundColor:y.color}),class:"absolute top-0 left-0 w-full h-full"},null,4)):be("",!0),vt("canvas",{ref:w,id:"responsive-canvas",width:n.value,height:a.value,class:et([`w-[${n.value}px]`,`h-[${a.value}px]`])},null,10,_n),vt("canvas",{ref_key:"bgCanvas",ref:s,width:n.value,height:a.value,style:yt({backgroundColor:y.color}),class:et([`w-[${n.value}px]`,`h-[${a.value}px]`,"absolute","top-0","-z-10","pointer-events-none"])},null,14,Un)],2))}});export{xt as D,rt as M,$n as _,S as a,Fn as b,Sn as c,Rn as d,ot as e,Hn as f,En as g,Cn as h,te as i,Tn as l,Ln as r,Yn as s,pn as u,kn as z};
