"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@codemirror/state"),o=require("@codemirror/view"),r=function(){return r=Object.assign||function(t){for(var o,r=1,n=arguments.length;r<n;r++)for(var e in o=arguments[r])Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e]);return t},r.apply(this,arguments)};function n(t,o,r){if(r||2===arguments.length)for(var n,e=0,f=o.length;e<f;e++)!n&&e in o||(n||(n=Array.prototype.slice.call(o,0,e)),n[e]=o[e]);return t.concat(n||Array.prototype.slice.call(o))}var e=function(t){return/^-?\d+$/.test(t)},f=function(t,o,f){void 0===f&&(f={from:void 0,to:void 0});var i=t.map((function(t){if(t.from=e(t.from)?t.from:void 0,t.to=e(t.to)?t.to:void 0,e(t.from)&&e(t.to)){var o=r({},t);t.from=Math.min(o.from,o.to),t.to=Math.max(o.from,o.to)}return t})),m={from:e(null==o?void 0:o.from)?null==o?void 0:o.from:void 0,to:e(null==o?void 0:o.to)?null==o?void 0:o.to:void 0};if(e(m.from)&&e(m.to)){var u=r({},m);m.from=Math.min(u.from,u.to),m.to=Math.max(u.from,u.to)}var l={from:e(null==f?void 0:f.from)?null==f?void 0:f.from:void 0,to:e(null==f?void 0:f.to)?null==f?void 0:f.to:void 0};if(e(l.from)&&e(l.to)){var s=r({},l);l.from=Math.min(s.from,s.to),l.to=Math.max(s.from,s.to)}var c=n(n([],i.map((function(t){return t.from})),!0),[null==m?void 0:m.from,null==l?void 0:l.from],!1).filter((function(t){return void 0!==t})),v=n(n([],i.map((function(t){return t.to})),!0),[null==m?void 0:m.to,null==l?void 0:l.to],!1).filter((function(t){return void 0!==t})),d=n(n([],c,!0),v,!0),p=0,h=0;d.length>0&&(p=Math.max.apply(Math,d),h=Math.min.apply(Math,d));var g=Math.abs(p),M=Math.abs(h),y=Math.max(g,M)+1,x=-y;return i=i.map((function(t){return t.from=e(t.from)?t.from:x,t.to=e(t.to)?t.to:y,t})),m={from:e(m.from)?m.from:x,to:e(m.to)?m.to:y},l={from:e(l.from)?l.from:x,to:e(l.to)?l.to:y},i=i.slice().sort((function(t,o){var r=t.to-t.from,n=o.to-o.from;if(t.from>o.from)return 1;if(t.from===o.from){if(t.from+r>o.from+n)return-1;if(t.from+r===o.from+n)return 0;if(t.from+r<o.from+n)return 1}return-1})),a(i,m,[],l).map((function(t){return{from:t.from===x?void 0:t.from,to:t.to===y?void 0:t.to}}))},a=function(t,o,r,n){var e=r;if(null===o||0===t.length)return null===o||r.some((function(t){return t.from===(null==o?void 0:o.from)&&t.to===(null==o?void 0:o.to)}))||e.push(o),(e=e.filter((function(t){return t.from<=n.to&&t.to>=n.from}))).map((function(t){return function(t,o){return{from:t.from<o.from?o.from:t.from,to:t.to>o.to?o.to:t.to}}(t,n)}));var f=o.to-o.from;if(o.from>=t[0].from&&o.from<=t[0].to)o.from+f<=t[0].to?o=null:o.from=t[0].to+1;else if(o.from<t[0].from&&o.from+f>=t[0].from){var i=o.to,m={from:o.from,to:t[0].from-1};r.push(m),i>t[0].to?o.from=t[0].to+1:o=null}return t.shift(),a(t,o,r,n)},i=function(o){return t.EditorState.transactionFilter.of((function(r){if(r.isUserEvent("delete.selection")&&!r.isUserEvent("delete.selection.smart")){var n=r.startState.selection.ranges.map((function(t){return{from:t.from,to:t.to}}));if(n.length>0){var e=o(r.startState);return f(e,n[0],{from:0,to:r.startState.doc.line(r.startState.doc.lines).to}).map((function(o){return r.startState.update({changes:{from:o.from,to:o.to},annotations:t.Transaction.userEvent.of("".concat(r.annotation(t.Transaction.userEvent),".smart"))})}))}}return r}))},m=function(o){return t.EditorState.changeFilter.of((function(t){var r,n,e,f;try{for(var a=o(t.startState),i=o(t.state),m=0;m<a.length;m++){var u=null!==(r=a[m].from)&&void 0!==r?r:0,l=null!==(n=a[m].to)&&void 0!==n?n:t.startState.doc.line(t.startState.doc.lines).to,s=null!==(e=i[m].from)&&void 0!==e?e:0,c=null!==(f=i[m].to)&&void 0!==f?f:t.state.doc.line(t.state.doc.lines).to;if(t.startState.sliceDoc(u,l)!==t.state.sliceDoc(s,c))return!1}}catch(t){return!1}return!0}))},u=function(r){return o.EditorView.domEventHandlers({paste:function(o,n){var e=(o.clipboardData||window.clipboardData).getData("Text"),a=n.state.selection.ranges.map((function(t){return{from:t.from,to:t.to}}));if(a.length>0){var i=r(n.state),m=f(i,a[0],{from:0,to:n.state.doc.line(n.state.doc.lines).to});m.length>0&&n.dispatch({changes:{from:m[0].from,to:m[0].to,insert:e},annotations:t.Transaction.userEvent.of("input.paste.smart")})}return!0}})};exports.default=function(t){return[u(t),i(t),m(t)]},exports.preventModifyTargetRanges=m,exports.smartDelete=i,exports.smartPaste=u;
//# sourceMappingURL=index.js.map
