import{L as z,d as X,u as G,b as Y,_ as Z}from"./Graph.vue_vue_type_script_setup_true_lang-DdgI9LHN.js";import{c as S,i as q}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-8dwR3Anj.js";import{f as _,d as $,u as I,o as b,c as R,E as C,w as h,x as L,C as v,B as H,D as y,y as J,z as Q,a as B,t as ee,e as A}from"./index-GBEZEBPp.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-YJnh9s4C.js";import{g as te}from"./useAdjacencyList-c5JYbv7X.js";import{_ as se}from"./SimulationPlaybackControls.vue_vue_type_script_setup_true_lang-Bm5g_GwP.js";import{b as oe}from"./CollabControls.vue_vue_type_script_setup_true_lang-Vc6atrdj.js";const x="S",F="T",ne=z.filter(e=>e!==x&&e!==F),O=e=>X(e.nodes,ne),le=e=>{const{setTheme:r}=G(e,"flow"),l=O(e),u=t=>i=>{const{offsetX:g,offsetY:E}=i,m=e.getNodeByCoordinates(g,E);m&&t(m)},s=async()=>{e.settings.value.userEditable=!1,e.settings.value.focusable=!1;let t;const i=await new Promise(g=>{t=u(g),e.subscribe("onClick",t)});return t&&e.unsubscribe("onClick",t),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,i},d=_(!1),o=async()=>{d.value=!0;const t=await s();e.nodes.value.forEach(i=>{i.label===x&&(i.label=l())}),t.label=x,e.trackGraphState(),d.value=!1},a=_(!1),n=async()=>{a.value=!0;const t=await s();e.nodes.value.forEach(i=>{i.label===F&&(i.label=l())}),t.label=F,e.trackGraphState(),a.value=!1},c=t=>{if(e.isHighlighted(t.id))return;const i=t.label===x,g=t.label===F;if(i)return S.BLUE_600;if(g)return S.RED_600};return r("nodeBorderColor",c),r("nodeAnchorColor",c),{makeSource:o,makeSink:n,makingSource:d,makingSink:a}},ae={class:"flex gap-3"},ie={key:2,class:"flex gap-3"},re=$({__name:"SourceSinkControls",props:{simControls:{},controls:{}},setup(e){const r=e,l=I(()=>r.simControls.isActive.value);return(u,s)=>(b(),R("div",ae,[l.value?(b(),C(N,{key:1,style:L({backgroundColor:v(S).RED_600,color:v(S).WHITE}),onClick:u.simControls.stop},{default:h(()=>s[1]||(s[1]=[y(" Stop Simulation ")])),_:1},8,["style","onClick"])):(b(),C(N,{key:0,style:L({backgroundColor:v(S).BLUE_500,color:v(S).WHITE}),onClick:u.simControls.start},{default:h(()=>s[0]||(s[0]=[y(" Run Flow Simulation ")])),_:1},8,["style","onClick"])),l.value?H("",!0):(b(),R("div",ie,[u.controls.makingSource.value?(b(),C(N,{key:1,style:L({backgroundColor:v(S).RED_500,color:v(S).WHITE})},{default:h(()=>s[3]||(s[3]=[y(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:0,onClick:u.controls.makeSource},{default:h(()=>s[2]||(s[2]=[y(" Switch Source ")])),_:1},8,["onClick"])),u.controls.makingSink.value?(b(),C(N,{key:3,style:L({backgroundColor:v(S).RED_500,color:v(S).WHITE})},{default:h(()=>s[5]||(s[5]=[y(" Cancel ")])),_:1},8,["style"])):(b(),C(N,{key:2,onClick:u.controls.makeSink},{default:h(()=>s[4]||(s[4]=[y(" Switch Sink ")])),_:1},8,["onClick"]))]))]))}}),ue="edge-thickener",W=5,M=25,ce=3,de=e=>{const{setTheme:r,removeAllThemes:l}=G(e,ue),u=o=>{const a=Number(o.label);if(isNaN(a))return;if(a===0)return ce;const c=(a*2-W)/(M-W),t=Math.min(1,Math.max(0,c));return(M-W)*t+W},s=()=>r("edgeWidth",u),d=()=>l();return J(d),s(),{activate:s,deactivate:d}},fe={persistent:!0,persistentStorageKey:"network-flow",userAddedEdgeLabel:"5",userAddedEdgeRuleNoSelfLoops:!0,userAddedEdgeRuleOneEdgePerPath:!0,edgeInputToLabel:e=>{const r=Number(e);return!isNaN(r)&&r>=0&&r<100?e:void 0}},ve=(e,r,l)=>{const u=e.edges.value.reduce((n,c)=>(n[c.id]=Number(c.label),n),{}),s=[],d=te(e),o=(n,c,t=void 0,i=void 0)=>{if(i===void 0&&(i=[]),t===void 0&&(t=new Set),t.add(n),i.push(n),n===c)return i;const g=d[n];for(const E of g){const m=e.edges.value.find(f=>f.from===n&&f.to===E);if(!m)throw"the adj list must be wrong! 1";if(u[m.id]>0&&!t.has(E)){const f=o(E,c,t,[...i]);if(f)return f}}};return{maxFlow:(()=>{let n=0,c=o(r,l);for(;c;){let t=1/0;for(let i=0;i<c.length-1;i++){const g=c[i],E=c[i+1],m=e.edges.value.find(f=>f.from===g&&f.to===E);if(!m)throw"the adj list must be wrong! 2";const k=u[m.id];t=Math.min(t,k)}for(let i=0;i<c.length-1;i++){const g=c[i],E=c[i+1],m=e.edges.value.find(f=>f.from===g&&f.to===E),k=e.edges.value.find(f=>f.from===E&&f.to===g);if(!m||!k)throw"the adj list must be wrong! 3";u[m.id]-=t,u[k.id]+=t,s.push({[m.id]:u[m.id],[k.id]:u[k.id]})}n+=t,c=o(r,l)}return n})(),trace:s}},T="residual",V=e=>{const r=o=>o.startsWith(T),l=o=>o.split("-")[1],u=o=>`${T}-${o}`;return{cleanupResidualEdges:()=>{for(const o of e.edges.value){if(!r(o.id))continue;const a=l(o.id),n=e.getEdge(a);if(!n)throw"big oopsie";const c=Number(n.label),t=Number(o.label);n.label=(c+t).toString()}e.edges.value=e.edges.value.filter(o=>!o.id.startsWith(T))},createResidualEdges:()=>{if(e.edges.value.some(n=>n.id.startsWith(T)))return;const a=e.edges.value.map(n=>({...n,to:n.from,from:n.to,label:"0",id:u(n.id)}));e.edges.value.push(...a)},isResidual:r,getIdFromResidual:l,getResidualId:u}},P=e=>{const r=_([]),l=_(0),{createResidualEdges:u,cleanupResidualEdges:s}=V(e),d=()=>{const o=e.nodes.value.find(t=>t.label===x),a=e.nodes.value.find(t=>t.label===F);if(!o||!a)return r.value=[];u();const{maxFlow:n,trace:c}=ve(e,o.id,a.id);r.value=c,l.value=n,s()};return e.subscribe("onEdgeLabelChange",d),e.subscribe("onStructureChange",d),e.subscribe("onGraphReset",d),{maxFlow:l,trace:r,update:d}},me=e=>{const{maxFlow:r}=P(e);return{maxFlow:Q(r)}},ge={class:"flex gap-3"},Ee={class:"font-bold text-xl"},be=$({__name:"NetworkFlowStats",props:{graph:{}},setup(e){const r=e,{maxFlow:l}=me(r.graph);return(u,s)=>(b(),R("div",ge,[B("span",Ee,"Max Flow: "+ee(v(l)??"N/A"),1)]))}}),Se=e=>{const{setTheme:r}=G(e,"flow"),{createResidualEdges:l,cleanupResidualEdges:u}=V(e),{trace:s}=P(e),d=_(!1),o=_([]),a=_(0),n=_(null),c=_(!1),t=_(1500),i=I(()=>a.value===s.value.length),g=I(()=>a.value>-1),E=()=>{c.value||i.value||f()},m=()=>{a.value=-1,e.settings.value.userEditable=!1,e.settings.value.focusable=!1,d.value=!0,c.value=!1,l(),n.value=setInterval(E,t.value),e.repaint("flow-simulation/start-simulation")()},k=()=>{u(),e.settings.value.userEditable=!0,e.settings.value.focusable=!0,o.value=[],d.value=!1,n.value&&clearInterval(n.value),e.repaint("flow-simulation/stop-simulation")()},f=()=>{if(a.value===s.value.length)return;if(a.value++,a.value===s.value.length){o.value=[],e.repaint("flow-simulation/next-step")();return}const p=s.value[a.value];o.value=Object.keys(p);const[w,j]=o.value,D=e.getEdge(w),U=e.getEdge(j);if(!D||!U)throw"this is all wrong!";D.label=p[w].toString(),U.label=p[j].toString(),e.repaint("flow-simulation/next-step")()},K=()=>{if(a.value<-1)return;if(a.value--,a.value===-1){o.value=[],e.repaint("flow-simulation/prev-step")();return}const p=a.value;k(),m();for(let w=0;w<p+1;w++)f()};return r("edgeColor",p=>{if(o.value.includes(p.id))return q(e.theme.value.edgeFocusColor,p);if(p.id.startsWith(T))return S.ORANGE_400}),{nextStep:f,prevStep:K,setStep:()=>{throw"setStep not implemented"},trace:I(()=>s.value),step:I(()=>a.value),start:m,stop:k,paused:c,playbackSpeed:t,isOver:i,hasBegun:g,isActive:I(()=>d.value)}},_e={class:"w-full h-full relative"},ke={class:"absolute w-full h-full"},pe={class:"absolute top-0 p-3"},we={class:"absolute top-0 right-0 p-3 text-white flex gap-3"},Ce={key:0,class:"absolute bottom-8 w-full flex justify-center items-center p-3"},he={key:1,class:"absolute right-0 p-3 h-14 flex gap-3 bottom-0"},Le=$({__name:"Main",setup(e){const r=_(),l=Y(r,{settings:fe});l.settings.value.newNodeLabelGetter=O(l),de(l);const u=le(l),s=Se(l);return(d,o)=>(b(),R("div",_e,[B("div",ke,[A(Z,{onGraphRef:o[0]||(o[0]=a=>r.value=a),graph:v(l)},null,8,["graph"])]),B("div",pe,[A(re,{controls:v(u),"sim-controls":v(s)},null,8,["controls","sim-controls"])]),B("div",we,[A(be,{graph:v(l)},null,8,["graph"])]),v(s).isActive.value?(b(),R("div",Ce,[A(se,{controls:v(s)},null,8,["controls"])])):H("",!0),v(s).isActive.value?H("",!0):(b(),R("div",he,[A(oe,{graph:v(l)},null,8,["graph"])]))]))}});export{Le as default};
