import{d as b,v as h,H as D,c as v,$ as E,K as G,X as U,o as r,x as ce,W as g,F as I,f as S,s as a,a as c,b as d,w as u,e as M,t as C,E as T,g as R,y as ue,a0 as pe,C as x,a1 as se,a2 as ne,a3 as ve,a4 as fe,L as B,M as _e,a5 as K,a6 as ge,a7 as me,a8 as he,a9 as xe,G as ae,u as j,O as re,aa as be,ab as Q,ac as ye}from"./index-D9-peFBB.js";import{u as $e}from"./Graph.vue_vue_type_script_setup_true_lang-D8mlc9uE.js";import{a as Z,u as Ce,p as X,b as w,T as q,c as L,d as ke,_ as we}from"./GraphProduct.vue_vue_type_script_setup_true_lang-C0RRbIss.js";import{u as Me}from"./useGraphTutorial-B1mo9pHX.js";import{_ as P}from"./Icon.vue_vue_type_script_setup_true_lang-B64LiHyd.js";import{d as Ae}from"./ResponsiveCanvas.vue_vue_type_script_setup_true_lang-Zj62QpuQ.js";import{C as Y}from"./Button-Cy0dbwOj.js";import"./TutorialHint.vue_vue_type_script_setup_true_lang-C3s_gShm.js";const ze={persistentStorageKey:"graph-sandbox"},V=b({__name:"GraphNode",props:{size:{default:60},borderSize:{},color:{default:h.WHITE}},setup(i){const e=i,l=D(()=>Math.round(Math.max(1,Math.log(e.size))));return(t,o)=>(r(),v("div",{class:G(["flex","font-bold","items-center","justify-center","rounded-full"]),style:U({color:t.color,border:`${l.value}px solid ${t.color}`,height:`${t.size}px`,width:`${t.size}px`})},[E(t.$slots,"default")],4))}}),Te={class:"flex flex-col gap-4"},Ee={class:"text-xl mx-3"},Ie={class:"overflow-auto"},Se={class:"flex flex-row gap-4"},Ne={class:"leading-[15px]"},Le={key:0,class:"leading-[15px] text-[8px]"},Re={key:0,class:"text-opacity-50 text-white text-xl font-bold"},Pe=b({__name:"AdjacencyListDisplay",setup(i){const{weightedAdjacencyList:e}=ce(g.value),l=o=>{var n;return(n=g.value.getNode(o))==null?void 0:n.label},t=D(()=>g.value.settings.value.displayEdgeLabels);return(o,n)=>(r(),v("div",Te,[(r(!0),v(I,null,S(a(e),(_,m)=>(r(),v("div",{key:m,class:"flex items-center"},[c("div",null,[d(V,{class:"bg-gray-600"},{default:u(()=>[M(C(l(m)),1)]),_:2},1024)]),c("span",Ee,[d(P,{icon:"arrow_right"})]),c("div",Ie,[c("div",Se,[(r(!0),v(I,null,S(_,f=>(r(),v("div",null,[d(V,{class:"bg-gray-600 relative flex flex-col"},{default:u(()=>[c("span",Ne,C(f.label),1),t.value?(r(),v("span",Le," Cost "+C(f.weight),1)):T("",!0)]),_:2},1024)]))),256)),_.length===0?(r(),v("h2",Re," None ")):T("",!0)])])]))),128))]))}}),ee=i=>{const e=i.nodes.value,l=e.length,t=pe(i),{getEdgesAlongPath:o,getEdgeWeight:n}=i.helpers,_=e.reduce((f,s,p)=>(f[s.id]=p,f),{}),m=Array.from({length:l},()=>Array(l).fill(0));for(const[f,s]of Object.entries(t)){const p=_[f];s.forEach(y=>{const A=o(f,y).filter(N=>N.from===f&&N.to===y),z=_[y];if(A.length>0){const N=A.reduce((W,H)=>W+n(H.id),0);m[p][z]=N}})}return m},De=i=>{const e=R(ee(i)),l=()=>{e.value=ee(i)};return i.subscribe("onStructureChange",l),ue(()=>{i.unsubscribe("onStructureChange",l)}),{transitionMatrix:e}},Be=["onMouseenter","onMouseleave"],Ge=b({__name:"PopoverTooltip",props:{offset:{default:4}},setup(i){return(e,l)=>(r(),x(Z,{offset:e.offset},{activator:u(({toggle:t})=>[c("div",{onMouseenter:t,onMouseleave:t},[E(e.$slots,"default")],40,Be)]),default:u(()=>[E(e.$slots,"content")]),_:3},8,["offset"]))}}),Ue={class:"text-gray-200 text-xl font-bold text-center flex items-center justify-center overflow-hidden p-[3px]"},Ve={class:"hover:bg-gray-800 h-10 w-10 cursor-default grid place-items-center rounded-md"},je={class:"flex items-center bg-gray-800 py-2 px-3 rounded-md"},Fe=b({__name:"TransitionMatrixLabel",props:{toNode:{},fromNode:{},weight:{}},setup(i){return(e,l)=>(r(),v("div",Ue,[d(Ge,null,{content:u(()=>[c("div",je,[d(V,{size:30},{default:u(()=>[M(C(e.toNode.label),1)]),_:1}),d(P,{class:"text-2xl text-white",icon:"arrow_right"}),d(V,{size:30},{default:u(()=>[M(C(e.fromNode.label),1)]),_:1})])]),default:u(()=>[c("div",Ve,C(e.weight),1)]),_:1})]))}}),We={key:0,class:"flex py-6 items-center"},He=b({__name:"TransitionMatrixDisplay",setup(i){const{transitionMatrix:e}=De(g.value),l={background:`
      linear-gradient(
        ${h.GRAY_700},
        ${h.GRAY_700}
      )
      50%
      50%/calc(100% - 10px)
      calc(100% - 10px) no-repeat,
      linear-gradient(
        90deg,
        ${h.WHITE}
        10%,
        ${h.TRANSPARENT}
        10%,
        ${h.TRANSPARENT}
        90%,
        ${h.WHITE}
        90%
      )
      188%
      0`},t=D(()=>g.value.nodes.value);return(o,n)=>a(e).length!==0?(r(),v("div",We,[n[0]||(n[0]=c("div",{class:"text-xl font-bold px-5 text-nowrap"},"T =",-1)),c("div",{style:l,class:"p-4 rounded"},[(r(!0),v(I,null,S(a(e),(_,m)=>(r(),v("div",{key:"row-"+m,class:"flex"},[(r(!0),v(I,null,S(_,(f,s)=>(r(),v("div",{key:"col-"+s},[d(Fe,{toNode:t.value[m],fromNode:t.value[s],weight:f},null,8,["toNode","fromNode","weight"])]))),128))]))),128))]),n[1]||(n[1]=c("div",{class:"text-gray-700"},"block",-1))])):T("",!0)}}),Oe={class:"bg-gray-800 flex flex-col text-white p-3 w-[400px] rounded-lg gap-2"},Ke={key:0},Xe={class:"bg-gray-700 p-4 rounded-lg max-h-[200px] overflow-auto"},qe={class:"bg-gray-700 p-4 rounded-lg max-h-[300px] overflow-auto"},Ye={key:1},Ze=b({__name:"GraphInfoMenu",setup(i){const e=D(()=>g.value.nodes.value.length>0);return(l,t)=>(r(),x(Z,null,{activator:u(o=>[E(l.$slots,"default",se(ne(o)))]),default:u(()=>[c("div",Oe,[t[3]||(t[3]=c("h1",{class:"text-2xl font-bold text-gray-200 mb-3"},"Graph Info",-1)),e.value?(r(),v("div",Ke,[t[0]||(t[0]=c("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"Adjacency List",-1)),c("div",Xe,[d(Pe)]),t[1]||(t[1]=c("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"Transition Matrix",-1)),c("div",qe,[d(He)])])):(r(),v("div",Ye,t[2]||(t[2]=[c("h2",null,"Add some nodes to get started",-1)])))])]),_:3}))}}),Je={class:"bg-gray-800 flex flex-col text-white p-3 w-[400px] rounded-lg"},Qe={class:"rounded-lg mb-2"},et=["disabled"],tt={class:"w-full mt-2"},ot={key:2},st={key:0,class:"mt-4 w-full"},nt={key:1},at={class:"text-xl font-bold text-gray-200 mt-4 mb-2"},rt={class:"flex flex-wrap items-center gap-2"},lt=["onClick"],it=b({__name:"CollaborativeSessionMenu",setup(i){const e=ve(),{navigate:l}=Ce(),{connectToRoom:t,isConnected:o,connectedRoomId:n,disconnectFromRoom:_,collaborators:m,collaboratorCount:f,meAsACollaborator:s}=ge,p=D(()=>`${window.location.origin}?rid=${n.value}`),y=R(!1),A=Ae(()=>{y.value=!1},2e3),z=R(!1),N=()=>{try{navigator.clipboard.writeText(p.value),y.value=!0,A()}catch(O){console.error("Failed to copy link to clipboard",O)}},W=async()=>{z.value=!0,await t({roomId:me(),productId:he.productId,graph:g.value}),e.push({query:{rid:n.value}}),z.value=!1},H=()=>{_(),e.push({query:{rid:void 0}})};return(O,$)=>{const J=fe("tooltip");return r(),x(Z,null,{activator:u(k=>[E(O.$slots,"default",se(ne(k)))]),default:u(()=>[c("div",Je,[$[4]||($[4]=c("h1",{class:"text-2xl font-bold text-gray-200 mb-3"},"Collaborate",-1)),$[5]||($[5]=c("h2",{class:"text-xl font-bold text-gray-200 mb-2"},"My Name",-1)),c("div",Qe,[B(c("input",{"onUpdate:modelValue":$[0]||($[0]=k=>a(K).name=k),disabled:a(o)||z.value,type:"text",id:"collab-name",class:"bg-gray-700 text-white w-full p-2 rounded-lg outline-none disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"The name you want others to see"},null,8,et),[[_e,a(K).name]])]),c("div",tt,[!a(o)&&!z.value?(r(),x(Y,{key:0,onClick:W,disabled:!a(K).name,class:"w-full"},{default:u(()=>[$[1]||($[1]=M(" Generate Link ")),d(P,{icon:"link",class:"ml-2"})]),_:1},8,["disabled"])):z.value?(r(),x(Y,{key:1,disabled:"",class:"w-full"},{default:u(()=>$[2]||($[2]=[M(" Preparing Room... ")])),_:1})):(r(),v("div",ot,[c("div",{onClick:N,class:"group p-2 bg-gray-900 bg-opacity-50 hover:bg-opacity-100 text-gray-300 rounded-lg cursor-pointer flex justify-between items-center"},[c("span",null,C(p.value),1),y.value?T("",!0):(r(),x(P,{key:0,icon:"content_copy",class:"text-gray-400 opacity-0 group-hover:opacity-100"})),y.value?(r(),x(P,{key:1,icon:"check_underline",class:"text-green-400 opacity-0 group-hover:opacity-100"})):T("",!0)])]))]),a(o)?(r(),v("div",st,[d(Y,{onClick:H,color:a(h).RED_600,class:"w-full"},{default:u(()=>$[3]||($[3]=[M(" Disconnect ")])),_:1},8,["color"])])):T("",!0),a(o)&&a(s)?(r(),v("div",nt,[c("h2",at," Collaborators ("+C(a(f))+") ",1),c("div",rt,[B((r(),v("div",{style:U({backgroundColor:a(s).color}),class:"text-gray-300 font-bold rounded-md px-3 py-1"},[M(C(a(s).name)+" (You) ",1)],4)),[[J,{value:`You are in ${a(X)[a(s).productId].name}`,pt:{text:"bg-magic"}},void 0,{bottom:!0}]]),(r(!0),v(I,null,S(a(m),k=>B((r(),v("button",{onClick:Mt=>a(l)(a(X)[k.productId]),key:k.id,style:U({backgroundColor:k.color}),class:"text-gray-300 font-bold rounded-md px-3 py-1"},[M(C(k.name),1)],12,lt)),[[J,`${k.name} is in ${a(X)[k.productId].name}`]])),128))])])):T("",!0)])]),_:3})}}}),dt=b({__name:"IslandToolbar",setup(i){const e=Me(g.value,[{dismiss:"onNodeAdded",hint:"Double click on the canvas to add a node."},{dismiss:"onEdgeAdded",hint:"Hover node to show anchors, drag between them to add an edge."}]);e.start();const l=()=>{const{activateAnnotation:t,deactivateAnnotation:o,annotationActive:n}=g.value;n.value?o():t()};return(t,o)=>(r(),x(ke,{hint:a(e)},{default:u(()=>[d(L,null,{default:u(()=>[d(w,{onClick:o[0]||(o[0]=n=>a(g).settings.value.displayEdgeLabels=!0),active:a(g).settings.value.displayEdgeLabels,icon:"label_outline"},null,8,["active"]),d(q),d(w,{onClick:o[1]||(o[1]=n=>a(g).settings.value.displayEdgeLabels=!1),active:!a(g).settings.value.displayEdgeLabels,icon:"label_off_outline"},null,8,["active"])]),_:1}),d(L,null,{default:u(()=>[d(w,{onClick:o[2]||(o[2]=n=>a(g).settings.value.isGraphDirected=!0),active:a(g).settings.value.isGraphDirected,icon:"arrow_right_alt"},null,8,["active"]),d(q),d(w,{onClick:o[3]||(o[3]=n=>a(g).settings.value.isGraphDirected=!1),active:!a(g).settings.value.isGraphDirected,icon:"remove"},null,8,["active"])]),_:1}),d(L,null,{default:u(()=>[d(w,{onClick:o[4]||(o[4]=n=>a(g).undo()),disabled:!a(g).canUndo.value,icon:"undo"},null,8,["disabled"]),d(q),d(w,{onClick:o[5]||(o[5]=n=>a(g).redo()),disabled:!a(g).canRedo.value,icon:"redo"},null,8,["disabled"])]),_:1}),d(L,null,{default:u(()=>[d(w,{onClick:l,active:a(g).annotationActive.value,icon:"edit"},null,8,["active"])]),_:1}),d(L,null,{default:u(()=>[d(Ze,null,{default:u(({toggle:n,isOpen:_})=>[d(w,{onClick:n,active:_,icon:"info_outline"},null,8,["onClick","active"])]),_:1})]),_:1}),d(L,null,{default:u(()=>[d(it,null,{default:u(({toggle:n,isOpen:_})=>[d(w,{onClick:n,active:_,icon:"group"},null,8,["onClick","active"])]),_:1})]),_:1})]),_:1},8,["hint"]))}}),F="markup",ct=["XS","SM","MD","LG","XL"],te="MD",ut=[h.BLACK,h.BLUE_600,h.RED_600,h.GREEN_600,h.YELLOW_600],oe=h.BLACK,pt={XS:25,SM:30,MD:35,LG:40,XL:45},le={XS:6,SM:8,MD:10,LG:12,XL:14},vt={},ft={class:"flex flex-col gap-1"};function _t(i,e){return r(),v("div",ft,[E(i.$slots,"default")])}const ie=xe(vt,[["render",_t]]),de=b({__name:"Button",props:{active:{type:Boolean}},setup(i){return(e,l)=>(r(),v("button",{class:G(["cursor-pointer","rounded-xl","p-1","border-2",e.active?"border-white":"border-transparent",e.active?"hover:border-white":"hover:border-gray-400"])},[c("div",{class:G(["relative","w-8","h-8","rounded-md","flex","items-center","justify-center","text-white","text-sm",e.active?"bg-gray-800":"bg-gray-700"])},[E(e.$slots,"default")],2)],2))}}),gt=b({__name:"InputColor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const e=ae(i,"modelValue");return(l,t)=>(r(),x(ie,null,{default:u(()=>[(r(!0),v(I,null,S(a(ut),o=>(r(),x(de,{onClick:n=>e.value=o,key:o,active:e.value===o},{default:u(()=>[c("div",{style:U({backgroundColor:o}),class:G(["w-full","h-full","rounded-md"])},null,4)]),_:2},1032,["onClick","active"]))),128))]),_:1}))}}),mt=b({__name:"NodeEdgeColorInput",props:{graph:{},colorMap:{}},setup(i){const e=i,l=()=>{const s=Array.from(e.graph.focusedItemIds.value),p=new Set(s.map(A=>e.colorMap.get(A)));if(p.has(void 0)||p.size!==1)return;const y=p.values().next().value;return y||oe},t=R(l()),o=s=>{for(const p of e.graph.focusedItemIds.value)e.colorMap.set(p,s);t.value=s},n=({id:s})=>{t.value&&e.colorMap.set(s,t.value)},_=async()=>{e.graph.focusedItemIds.value.size!==0&&(await new Promise(s=>setTimeout(s,0)),t.value=l())};e.graph.subscribe("onNodeAdded",n),e.graph.subscribe("onEdgeAdded",n),e.graph.subscribe("onFocusChange",_);const{setTheme:m}=j(e.graph,F+"-preview");return m("linkPreviewColor",()=>t.value??oe),(s,p)=>(r(),x(gt,{"onUpdate:modelValue":o,"model-value":t.value},null,8,["model-value"]))}}),ht=b({__name:"InputSize",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const e=ae(i,"modelValue");return(l,t)=>(r(),x(ie,null,{default:u(()=>[(r(!0),v(I,null,S(a(ct),o=>(r(),x(de,{onClick:n=>e.value=o,key:o,active:e.value===o},{default:u(()=>[M(C(o),1)]),_:2},1032,["onClick","active"]))),128))]),_:1}))}}),xt=b({__name:"NodeEdgeSizeInput",props:{graph:{},sizeMap:{}},setup(i){const e=i,l=()=>{const s=Array.from(e.graph.focusedItemIds.value),p=new Set(s.map(A=>e.sizeMap.get(A)));if(p.has(void 0)||p.size!==1)return;const y=p.values().next().value;return y||te},t=R(l()),o=s=>{for(const p of e.graph.focusedItemIds.value)e.sizeMap.set(p,s);t.value=s,e.graph.updateEncapsulatedNodeBox()},n=({id:s})=>{t.value&&e.sizeMap.set(s,t.value)},_=async()=>{e.graph.focusedItemIds.value.size!==0&&(await new Promise(s=>setTimeout(s,0)),t.value=l())};e.graph.subscribe("onNodeAdded",n),e.graph.subscribe("onEdgeAdded",n),e.graph.subscribe("onFocusChange",_);const{setTheme:m}=j(e.graph,F+"-preview");return m("linkPreviewWidth",()=>le[t.value??te]),(s,p)=>(r(),x(ht,{"onUpdate:modelValue":o,"model-value":t.value},null,8,["model-value"]))}}),bt={class:"flex flex-col gap-3"},yt={class:"p-2 bg-gray-800 rounded-xl"},$t={class:"p-2 bg-gray-800 rounded-xl"},Ct=b({__name:"IslandMarkup",props:{graph:{},sizeMap:{},colorMap:{}},setup(i){const e=i;return(l,t)=>(r(),v("div",bt,[c("div",yt,[d(mt,{graph:e.graph,colorMap:l.colorMap},null,8,["graph","colorMap"])]),c("div",$t,[d(xt,{graph:e.graph,sizeMap:l.sizeMap},null,8,["graph","sizeMap"])])]))}}),kt=i=>{const{setTheme:e,removeAllThemes:l}=j(i,F),t=re("markup-color-map",new Map),o=s=>{if(t.value.get(s.id))return be(i.theme.value.nodeColor,s)},n=s=>{const p=t.value.get(s.id);if(p)return i.isFocused(s.id)?Q(p,30):p},_=s=>{const p=t.value.get(s.id);if(p)return i.isFocused(s.id)?Q(p,30):p};return{colorize:()=>{e("nodeColor",o),e("nodeBorderColor",n),e("nodeFocusBorderColor",n),e("nodeAnchorColor",n),e("nodeAnchorColorWhenParentFocused",n),e("edgeColor",_),e("marqueeSelectionBoxColor",h.TRANSPARENT),e("marqueeEncapsulatedNodeBoxBorderColor",h.WHITE+"80"),e("marqueeEncapsulatedNodeBoxColor",h.TRANSPARENT)},decolorize:()=>{l()},colorMap:t}},wt=i=>{const{setTheme:e,removeAllThemes:l}=j(i,F),t=re("markup-size-map",new Map),o=f=>{const s=t.value.get(f.id);if(s)return pt[s]},n=f=>{const s=t.value.get(f.id);if(s)return le[s]};return{size:()=>{e("nodeSize",o),e("edgeWidth",n)},desize:()=>{l()},sizeMap:t}},Rt=b({__name:"Main",setup(i){const e=R(),l=$e(e,{settings:ze}),{colorize:t,colorMap:o}=kt(l);t();const{size:n,sizeMap:_}=wt(l);return n(),(m,f)=>(r(),x(we,{onGraphRef:f[0]||(f[0]=s=>e.value=s),graph:a(l)},{"top-center":u(()=>[d(dt)]),"center-left":u(()=>[B(d(Ct,{graph:a(l),sizeMap:a(_),colorMap:a(o)},null,8,["graph","sizeMap","colorMap"]),[[ye,!a(l).annotationActive.value]])]),_:1},8,["graph"]))}});export{Rt as default};
